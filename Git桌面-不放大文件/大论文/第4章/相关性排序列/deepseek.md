令$\mathcal{F}^A_{al} = \{f^A_{1_{al}},...,f^A_{{m_A}_{al}}\}$表示Party A对齐部分的特征空间，$m_A$表示A方的特征维数，其中$f^A_{p_{al}} \in \mathbb{R}^{n_{al}}$为A方第$p$个特征在对齐样本集$\mathcal{D}^A_{al}$上的观测向量（$p=1,...,m_A$）。同理，Party B的特征空间为$\mathcal{F}^B_{al} = \{f^B_{1_{al}},...,f^A_{{m_A}_{al}}\}$，$f^A_{q_{al}} \in \mathbb{R}^{n_{al}}$（$q=1,...,m_B$）。

计算A方对齐部分第$p$个特征列和B方对齐部分第$q$个特征列之间的相关性系数${\rho _{f_{{p_{al}}}^A,f_{{q_{al}}}^B}}$的步骤如下:

循环遍历$f^A_{p_{al}}$中的每个属性值，并对其赋排名。排名从1开始，排名相同的值使用平均排名（即将相同值的排名求平均）。得到每个属性值，$$f_{{p_{al}}}^{A,i}$$，其中 $i = 1,2, \ldots ,{n_{al}}$排名$$



### 跨方特征相关性评估与排序机制

在纵向联邦学习框架中，为有效利用非对齐样本的特征信息，需量化跨参与方特征间的统计关联性。本节提出基于隐私保护的Spearman秩相关分析方法，构建跨方特征相关性排序体系。设协调方C作为可信第三方生成同态加密密钥对$\{\text{pk}, \text{sk}\}$，并向Party A、Party B分发公钥pk。具体计算流程如下：

**定义1（特征列秩向量）**：令$\mathcal{F}^A_{al} = \{f^A_{1_{al}},...,f^A_{{m_A}_{al}}\}$表示Party A对齐部分的特征空间，$m_A$表示A方的特征维数，其中$f^A_{p_{al}} \in \mathbb{R}^{n_{al}}$为A方第$p$个特征在对齐样本集$\mathcal{D}^A_{al}$上的观测向量（$p=1,...,m_A$）。

同理，Party B的特征空间为$\mathcal{F}^B_{al} = \{f^B_{1_{al}},...,f^A_{{m_A}_{al}}\}$，$f^A_{q_{al}} \in \mathbb{R}^{n_{al}}$（$q=1,...,m_B$）。对任意特征列$f^A_{p_{al}}$，计算其秩向量$R^A_p = [r^A_{p1},...,r^A_{pn}]$，其中$r^A_{pi}$为第$i$个特征在$f^A_{p_{al}}$上的秩次（采用平均秩处理同值情况）。

**步骤1（加密秩传输）**：Party A使用公钥pk对秩向量进行同态加密，生成$[R^A_p] = \{\text{Enc}(r^A_{p1}),...,\text{Enc}(r^A_{pn_{al}})\}$并发送至Party B。类似地，Party B生成加密秩向量$[R^B_q]$。

**步骤2（秩差计算）**：对于特征对$(X^A_p, X^B_q)$，Party B计算加密秩差向量：
$$
[D_{pq}] = \left[ \text{Enc}(r^A_{p1} - r^B_{q1}),...,\text{Enc}(r^A_{pn_{al}} - r^B_{qn_{al}}) \right]
$$

**步骤3（Spearman相关性计算）**：协调方C解密$[D_{pq}]$得到$d_{pq}^i = r^A_{pi} - r^B_{qi}$，计算特征对间的Spearman相关系数：
$$
\rho_{pq} = 1 - \frac{6\sum_{i=1}^{n_{al}} (d_{pq}^i)^2}{n_{al}(n_{al}^2 - 1)}
$$
其中$n_{al}$为对齐样本量。由此构建跨方相关性矩阵$\mathbf{M} \in \mathbb{R}^{m_A \times m_B}$，元素$\mathbf{M}(p,q) = \rho_{pq}$。

**定义2（特征关联强度）**：对Party B的每个特征$X^B_q$，计算其与Party A特征集的平均关联强度：
$$
\mu_q = \frac{1}{m_A} \sum_{p=1}^{m_A} \rho_{pq}, \quad q=1,...,m_B
$$
该指标量化了$X^B_q$对A方特征空间的综合依赖程度。

**步骤4（生成排序列表）**：构建特征重要性序列$\mathcal{L}_B = \{(\mu_q, X^B_q)\}_{q=1}^{m_B}$，按$\mu_q$升序排列得到$\mathcal{L}_B^{sorted}$。此列表将指导后续的非对齐样本特征生成，优先补充与对方特征关联性弱的维度。

---

**关键符号说明**  
- $m_A, m_B$: A/B方特征维度数  
- $n_{al}$: 对齐样本量（$\mathcal{D}_{al}$基数）  
- $R^A_p, R^B_q$: 特征列秩向量  
- $\rho_{pq}$: Spearman相关系数  
- $\mu_q$: B方特征$X^B_q$的跨方关联强度  
- $\mathcal{L}_B^{sorted}$: 按关联强度排序的特征列表  

该方法通过加密秩运算保护原始特征分布，利用统计相关性识别跨方特征依赖模式，为异构数据补全提供量化依据。排序机制可有效筛选出对方特征信息增益最大的维度进行优先生成，提升联邦学习效率。