以下是对原文的详细检查和补充，以确保每个数学符号都有清晰的解释，避免引起读者疑惑。

---

## **基于隐私保护的Spearman秩相关分析方法**

在纵向联邦学习（Vertical Federated Learning, VFL）框架中，不同参与方（Parties）拥有相同样本但不同特征的异构数据。为了有效利用对齐样本的特征信息，需要量化跨参与方特征之间的统计关联性。本节提出了一种基于**隐私保护的Spearman秩相关分析方法**，用于构建跨方特征相关性排序体系。

设**协调方**（Coordinator）$ C $ 作为**可信第三方**，负责生成**同态加密**（Homomorphic Encryption, HE）密钥对 $ \{\text{pk}, \text{sk}\} $，其中：
- $ \text{pk} $ 为**公钥**（Public Key），用于加密数据；
- $ \text{sk} $ 为**私钥**（Secret Key），用于解密数据。

协调方 $ C $ 将公钥 $ \text{pk} $ 分发给**参与方 A**（Party A）和**参与方 B**（Party B），以便它们对数据进行加密计算，而不直接暴露原始数据。

---

### **定义 1（特征列秩向量）**
设：
- **参与方 A** 的特征空间为 $ \mathcal{F}^A = \{f^A_1, f^A_2, ..., f^A_{m_A}\} $，其中：
  - $ m_A $ 表示 A 方的特征维数，即 A 方拥有 $ m_A $ 个特征；
  - $ f^A_p \in \mathbb{R}^{n_{al}} $ 表示 A 方第 $ p $ 个特征在**对齐样本集** $ \mathcal{D}^A_{al} $ 上的观测向量，其中：
    - $ n_{al} $ 为**对齐样本的数量**；
    - $ f^A_p = [f^A_{p1}, f^A_{p2}, ..., f^A_{pn_{al}}] $ 表示该特征在所有对齐样本上的取值。

- **参与方 B** 的特征空间为 $ \mathcal{F}^B = \{f^B_1, f^B_2, ..., f^B_{m_B}\} $，其中：
  - $ m_B $ 表示 B 方的特征维数；
  - $ f^B_q \in \mathbb{R}^{n_{al}} $ 表示 B 方第 $ q $ 个特征在对齐样本集上的观测向量。

对于任意特征列 $ f^A_p $，计算其**秩向量**（Rank Vector）：
$$
R^A_p = [r^A_{p1}, r^A_{p2}, ..., r^A_{pn_{al}}]
$$
其中：
- $ r^A_{pi} $ 表示样本 $ i $ 在特征 $ f^A_p $ 上的秩次（Rank），即该样本在该特征列中的排序位置；
- 若存在相同值，则采用**平均秩**（Average Rank）处理。

类似地，B 方的特征列 $ f^B_q $ 也可以计算出对应的秩向量：
$$
R^B_q = [r^B_{q1}, r^B_{q2}, ..., r^B_{qn_{al}}]
$$

---

### **步骤 1（加密秩传输）**
- **A 方** 使用公钥 $ \text{pk} $ 对秩向量 $ R^A_p $ 进行**同态加密**，得到：
  $$
  [R^A_p] = \{\text{Enc}(r^A_{p1}), \text{Enc}(r^A_{p2}), ..., \text{Enc}(r^A_{pn_{al}})\}
  $$
  并将加密后的秩向量发送给 B 方。

- **B 方** 也对自己的秩向量 $ R^B_q $ 进行同态加密，得到：
  $$
  [R^B_q] = \{\text{Enc}(r^B_{q1}), \text{Enc}(r^B_{q2}), ..., \text{Enc}(r^B_{qn_{al}})\}
  $$

---

### **步骤 2（秩差计算）**
对于任意特征对 $ (f^A_p, f^B_q) $，B 方计算**加密秩差向量**：
$$
[D_{pq}] = \left[ \text{Enc}(r^A_{p1} - r^B_{q1}), ..., \text{Enc}(r^A_{pn_{al}} - r^B_{qn_{al}}) \right]
$$
其中：
- $ d_{pq}^i = r^A_{pi} - r^B_{qi} $ 表示样本 $ i $ 在 A 方特征 $ f^A_p $ 和 B 方特征 $ f^B_q $ 上的秩次之差；
- 由于同态加密支持加法运算，B 方可以在加密状态下直接计算秩差，而无需解密。

B 方将加密秩差向量 $ [D_{pq}] $ 发送给协调方 $ C $。

---

### **步骤 3（Spearman相关性计算）**
协调方 $ C $ 解密 $ [D_{pq}] $，得到：
$$
d_{pq}^i = r^A_{pi} - r^B_{qi}, \quad i = 1, ..., n_{al}
$$
然后计算 Spearman 相关系数：
$$
\rho_{pq} = 1 - \frac{6\sum_{i=1}^{n_{al}} (d_{pq}^i)^2}{n_{al}(n_{al}^2 - 1)}
$$
其中：
- $ \rho_{pq} $ 表示 A 方特征 $ f^A_p $ 与 B 方特征 $ f^B_q $ 之间的 Spearman 相关系数；
- 该公式衡量两个特征的**秩相关性**，值域为 $ [-1,1] $：
  - $ \rho_{pq} = 1 $ 表示完全正相关；
  - $ \rho_{pq} = -1 $ 表示完全负相关；
  - $ \rho_{pq} = 0 $ 表示无相关性。

最终，构建**跨方相关性矩阵**：
$$
\mathbf{M} \in \mathbb{R}^{m_A \times m_B}, \quad \mathbf{M}(p,q) = \rho_{pq}
$$
其中，$ \mathbf{M}(p,q) $ 存储 A 方第 $ p $ 个特征与 B 方第 $ q $ 个特征的 Spearman 相关系数。

---

### **定义 2（特征关联强度）**
对于 B 方的每个特征 $ f^B_q $，计算其与 A 方所有特征的**平均关联强度**：
$$
\mu_q = \frac{1}{m_A} \sum_{p=1}^{m_A} \rho_{pq}, \quad q=1,...,m_B
$$
其中：
- $ \mu_q $ 表示 B 方特征 $ f^B_q $ 对 A 方特征空间的**综合依赖程度**。

---

### **步骤 4（生成排序列表）**
构建特征重要性序列：
$$
\mathcal{L}_B = \{(\mu_q, f^B_q)\}_{q=1}^{m_B}
$$
按 $ \mu_q $ 降序排列，得到排序后的特征列表：
$$
\mathcal{L}_B^{sorted}
$$
该列表用于指导**非对齐样本的特征补全**，优先补充与 A 方特征关联性强的维度，从而提升纵向联邦学习的效率和性能。

---

### **总结**
该方法通过**同态加密**保护秩向量运算，避免了原始特征分布的直接暴露，仅由可信协调方解密必要统计量，保障了隐私安全。同时，基于 Spearman 相关性量化跨方特征的统计依赖关系，为非对齐样本的异构数据补全提供了科学依据。