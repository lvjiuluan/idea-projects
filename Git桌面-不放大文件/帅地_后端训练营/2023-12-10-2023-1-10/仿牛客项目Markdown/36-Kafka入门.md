36-Kafka入门.mp4

这次课咱们来正式的学习卡夫卡，主要是带着大家入个门，然后让你了解一下什么是卡夫卡，然后卡夫卡有一些什么样的特点，它有哪些术语需要你去掌握。另外我们把这个卡夫卡就是安装好，然后的话演示一下它的一些常用的命令基本的操作是怎么样的。好首先我们先对这个卡夫卡做一个了解，做一个简介，那么这是官网上解出来的一句话，说卡夫卡它是一个分布式的流媒体平台，有人会问不是说它是消息队列吗？

怎么变成了流媒体平台，这也是它的一个发展历程，它早先只是一个消息队列，只是用来发消息的。

后来他不断的完善，不断的扩充自己的功能，慢慢的它的功能就不只是局限于消息队列了，也能做了一些校区队列之外的事儿，所以说那么现在它这个功能比较综合，因此说它是一个分布式的流媒体平台，是因为它功能比较综合，我们从精神上来说它都能干什么？

第一个它能开发这个消息系统，这是它消息队列的功能。

第二个它可以做日志的收集采集，能处理大批量的日志，而且通过日志它能够分析很多内容，尤其是比如说你想分析用户的行为，对用户的行为追踪做一些分析，它也是可以搞得定，最后他还能够做流式处理，就是说你的数据流，你不是普通的数据是数据流，那么交给他他也能够帮你进行处理。

总之它的功能比较综合，但是我们的项目中不会用这么多功能，我们只用到它的发消息的功能，这也是它核心的重中之重的内容。好，那么卡不卡就像我们说的是一个性能最好的消息队列，它是怎么做到这一点的？然后的话它有哪些特点才使得它性能高？这里我们也简单的介绍一下。

首先卡夫卡它具有高吞吐量的特点，就是它处理数据的能力强，可以处理tb级的海量数据，这是它的能力，那么它为什么具备这样的能力？那么其实这个消息持久化这个特点能够揭示这一点，持久化大家都理解，就是把数据永久的保存到某一个介质里，类似于硬盘这样的永久存储的介质里，也就是说它会把消息存到硬盘上，而不是简单的存到内存里。

其实很独整息队列，他们是像我们上课所写的 Block，q他数据就存在了，对这里，然后我消费完以后，他就出兑了就完了，他没有永久保存，但是卡夫卡它是长久保存消息存到硬盘里去了，那么硬盘大家都知道它的硬盘的价格要比内存要低，而且硬盘的空间要比内存要大很多，这是它能够处理海量数据的一个前提，它把数据存到硬盘里，所以说才能处理这么大规模的数据。

那么有人可能会质疑说你存在硬盘里的话，读取硬盘读写硬盘的速度要远远低于读读取内存是吧？他说是不是性能就低了，怎么还能保持高性能，其实这是我们大家很多人的一个误解，就是说读写读取硬盘读写硬盘的效率高与低取决于你对硬盘的使用。

其实实际上我们对硬盘顺序读写，不是随机读写顺序读写是性能是很高的，性能甚至高于对内存的随机读取。

所以那卡夫卡就利用了这一点，它对硬盘的读写都是按照这个顺序的方式来进行的，保证了一个很高的性能，同时硬盘的空间就足够大，所以它才能够保证它能处理海量的数据，保证高吞吐量。

然后第三个特点是它具有高可靠性，那是因为它是一个分布式的这个服务器，就是它可以做集群部署，你一台服务器挂了，还有另一台对吧？所以说它是靠分布式保证的高可靠性，有容错的这个能力。

然后第四个它是有高扩展性，就是说我这个集群如果说服务器不够用了，我想加一个服务器，它很方便简单的配一配就可以。

总之卡夫卡就有这么几个优点，因此它是目前最为流行性能最好的消息队列，所以我们就选择用它，然后你要想使用这个卡不卡，你需要理解卡不卡的一些术语，否则的话用的时候就会感觉很别扭。

首先第一个术语是broker，broker是什么意思？其实就是卡夫卡的服务器，那么卡夫卡集群当中的每一台服务器我们称其为一个博客，记住就好了。

第二个概念是组keep，即使组keep它并不是卡夫卡里的一个概念，它是一个独立的软件一个应用，那么它能够用来管理其他的集群，那卡夫卡因为也要做集群，所以说它可以用主people来管理它的集群，那么我们在使用卡夫卡的时候，我可以单独安一个主keep，或者我直接下载一个卡夫卡，它里边也可以内置主keep也是可以的，我们一会我们就直接下载一个卡夫卡，然后的话就使用它里面内置的主key本就方便一点。

然后再看术语叫topic。

主题说到这儿我先再多说一句，就是说消息队列实现的方式大致有两种，一种是点对点的方式，我们上次课写的 Block，q其实就是点对点的方式，就是生产者把数据放到了一个队列里，消费者就从队列里取值，消费者可能有多个，如果a消费者取到了这个数据，这数据就出对了。

那么b消费者取的是另外的数据，那么是不会产生冲突的，不会重复的。每个消费者每个数据只被一个消费者消费这种情况，这叫点对点。

那么还有一种实现方式叫发布订阅模式，就是说我生产者我把消息放到了某一个位置，然后可以有很多个消费者同时关注这个位置，订阅这个位置，然后读取消息，这个时候这个消息可以被多个消费者同时读到，或者先后读到，是这样的。

好，那么这个卡夫卡采用的是发布订阅模式是第二种方式，这种方式其实比较灵活，也比较方便，那么他把生产者把消息发布到的位置，那个空间就叫topic就叫主题，你就理解为是一个文件夹，用来存放消息的一个位置好。

然后 partition是分区的意思，是对主题这个位置的一个分区，你看右边这个图，那么总体来说，比如说我这么这个空间是一个主题，可以用来存放消息，那为了增强这个并发能力，为了增强这个服务器处理能力，他对 topic这个位置又做了一个分区，又把它分为了012，当然可以任意多个区域，这里画的图是三个区域，这个图是来源于官网，然后这个时候就可以产生多线程的方式，同时向这多个区域多个分区里写数据，这样并发能力就强了，所以一个主题又可以分为多个分区，然后每一个分区它是从前往后按照顺序往里追加数据的，追加写入数据的，可能是一条消息两条消息三条消息不断的会堆到分区里。

然后比如说你看后面这个图，这个是一个宏观，这是一个微观，针对某一个分区而言，那我生产者是往队尾添加数据追加数据，如果你消费者读数据的时候，这里有很多条消息，你就需要按照顺序按照索引去读。

比如说9~10，这两部分是合起来是一个消息，我就从9读到10就读到这个消息。所以说这个off site是什么意思？ Off site其实就是这个消息在分区内存放的索引序列。

好，那么另外还有两个概念，还有一个概念叫replica，remake副本。什么叫副本？副本其实就是对数据做备份的，因为卡夫卡是一个分布式的这个消息引擎，那么为了让数据更可靠，他不是把数据只存一份，它是通过副本的形式对这个数据其实每一个分区有多个副本，存多份，万一某一个分某一个副本坏了对吧？我还有备份这个意思。

所以分区是为了提高容错率，冗余的多存几份数据，然后副本是分为leader、副本和 follow副本、主副本和随从副本。

那么主副本他的能力比较强，当你像从分区读数据的时候，或尝试从分区获取数据的时候，消费者那么主副本可以给你，这个数据可以给你做出响应，它能够处理你的请求，而从副本他只是从主副本备份数据，然后他不负责做响应。

那么万一说某一个时刻主副本挂掉了，这个时候集群就会从众多的重复本中选一个新的作为主副本作为leader，这是分布式的时候它的一个玩法。

好了，总之这些概念我们先普及一下，要然后我们用的时候好知道这什么是博客，什么是组批本，什么是topic等等，好不是那么陌生。

好了，那么了解了这些概念以后，接下来我们就去下载安装卡夫卡，然后来看一下它的一些基本的操作，那么卡夫卡是阿帕奇推出的一个软件，所以说非常的流行，那么它的官网是卡夫卡，点阿帕奇点org我已经提前把这个网站打开了，然后如果你想下载的话，这不有个登录的对吧？我点登录的。

然后这里目前最新的版本是2.3.0，然后这是带源码的，就是不带源码的。

然后不带源码有两个版本，一个是斯卡拉2.11，一个是二点12，它的底层是由斯卡拉来开发的，这个是斯卡拉的版本，然后他推荐的是2.12，他建议是我们就点这个，有人说它是tgj这样的一个格式，这不是Linux下的压缩包吗？能用吗？可以的。

卡夫卡它部分操作系统，反正它都是一个包，然后你下载完以后，解压缩它包里既有支持Linux的命令，又有windows的命令，它一个包就搞定了，挺省事的。

然后这里有很多链接你都可以点，然后它顶上给你推荐，根据我们的 Ip它可以推荐你访问网址，这是一个镜像网址，国内的速度会比较快一点，你可以点这个。

好，我已经提前下载好了，所以说我就不点了，我下载的位置在这。

那么安装的话就很简单，就把它解压缩就可以了，我把它解压缩到某一个地方去解压缩，我的放到d盘 work的下面，解压做完以后看d盘work在这儿，卡夫卡下划线2.12-2.3.0，然后那么安装完以后，这个卡夫卡你需要做一些配置，配什么？看一下配置主要是在 Conflict里。然后另外我们要启动卡夫卡，访问卡夫塔需要用它的里面带的命令都在变，一下默认的是Linux命令sh结尾，然后这里又有windows命令 bat结尾。

好，我退回去先配着 can figure，首先我要配一下主keep，就是管理集群的工具，这个是它的配置文件配一下配什么？其实主要是配 Data dir那么主keep在运行的时候会产生一些数据，这个数据要存在，你看它的默认的存放的路径是Linux系统的路径，我们没有这样的路径，这你得改，我改一下，我改成c c盘，然后work，然后data，比如说我要把这个数据放到目录下，然后主题本目录下我看一下work， data目录有了，但主keep没有没关系，一会运行的时候它会自动创建就这样了，然后再配，另外一个是 server点process也是打开，这里其实也有很多配置项，我们不用都配，这个是必须要配的。

Log点dirs就是卡不卡？

它日志文件存放的位置，它默认的路径也是不符合我们 windows系统的需求，我改一下c盘，冒号，work data，然后data下放到这个目录下就行了，其他的就不用动了，好这样的话这个组keep我就已经这个卡夫卡我就已经装好了，那么装好以后咱们要试一下，当我们试的时候其实是要访问并一下 windows下面的这些命令我给你演示一下，但是命令你可以从官网的手册里能查到，我给你看一下在哪查退回去。

在官网首页上，这不是有一个到k门txt文档对吧？你点这个文档，然后点完以后，你可以看一点一点1介绍，然后1.3quick start， quick开始。这里边就是有一些快速的常见的命令的介绍，就在后面了。

好，那么因为比较多，我不给大家挨个细看了，我就是挑基本的主要的给大家演示一下，能够把它用起来，大家了解一下它到底能干什么就行了。

好，首先我要启动命令行 come on的，然后我要敲命令启动，得先启动主keep，因为卡不卡依赖于主keep，好，我需要先CD到CD到6，我刚才是不是写错了，我那个配文件配错了，我的意思是把这个数据放到d盘work定损项，然后我卡萨也是装的d版，但是我刚才写到了c版写错地方了，应该是d版改一下这是d版。

好，那么再回到命令行，首先我要去d盘，因为塔普卡装到装到了 d盘，然后我CD到卡普卡的根目录下，CD d盘，然后 work，然后是卡夫卡到这个目录下，然后我要执行b下的命令，我可以这样，我直接敲b目录，然后因为我是windows系统，所以我得进windows目录下，然后我要启动主keep，那里边有一个主keep杠server杠start点bat我要执行它，我就这样主keep刚sir刚start的bat然后我启动的时候我要指定我要用肯目录下主key products配置文件，我可以空格写上配置文件，你注意我当前路径是这个路径下，我再访问config，然后听下组keep up case。

好，总之整句话的意思是我要执行命令，然后的话用配置文件来执行来启动这个组keep回车。

好，主keep启动的比较快，启动完了启动完以后还得再启动一个命令行窗口，我们再去启动这个卡夫卡，还是要CD到对应的目录下，d盘work卡不卡CD过来以后启动卡不卡也是类似的，有一个叫卡不卡，刚server刚start的bat，我还是用刚才的方式b然后 windows卡夫卡server start bat然后也是我要用到刚才我们改的配置文件就 server叫practice，然后他也在啃录像， server点practice，好然后回车，你看这个卡夫卡也启动了，启动完以后这个时候你可以去看一下咱们 d盘work data，你看这个data下是不是有一个目录叫主k本，主k本上有这个数据的。

另外再看 data下有了一个卡卡洛克斯，这里边有数据了，我们在启动的时候它自动创建的数据，现在主p和卡夫卡都已经启动了，然后我要使用这个卡夫卡这样我再启动一个命令，行，林天凡他使用的方式确实有点啰嗦，好我再启动命令行，然后的话我要我要使用卡夫卡的命令工具，我要CD到对应的目录下先去d盘CD d盘work，然后的话卡不卡，然后的话并然后 windows我直接 CD到包含命令行工具的路径下，然后我这里要干嘛？

我首先要创建主题，因为卡不卡作为一个消息队列，它是采用的是发布订阅模式，你要把消息发布到某一个主题下，首先你要创建一个主题，再强调一遍，这个主题是什么概念？第一个它代表了一个位置，第二个它也代表了一种消息的类别，消息的分类。

比如说这是点赞的消息，我就一个主题，那是关注的消息，我又一个主题，所以说它有双重含义，我们首先需要创建这个主题，而创建主题我们需要利用windows目录下有个工具叫卡夫卡topics点bat利用那个工具这里怎么写我就直接写了卡夫卡 topics点bat我调这个工具，然后我要创建主题杠杠，create然后我要创建主题，我要在哪个服务器上创建主题，杠杠，bootstrap server，空格。

 House冒号9092，你注意我们装的卡夫卡它默认的端口是9092，表示我要访问这个服务器，好，然后空格杠杠，reputation就是副本一就比方说你要创建多少个副本，我这只创建一个就得了，然后再来空格， party cense，一比如说分区你要几个分区，一个当然你也可以写多个，当然命令比较长，你也可以从手册上去找命令是有的。

好，然后杠一空格加杠TP就这里说我要创新，我要在这个服务器上创建主题那么一个副本一个分区。然后刚刚topic是主题的名字是什么？我叫test回车，它没有任何提示，这就表示创建好了。

为了确认一下到底好没好，我们可以再执行一下 Topics，命令，去查看一下所有的主题，它可以查看一下卡副卡杠topics，点dad，然后的话查看aaah杠least，然后杠，both drop，然后 server，然后 local house，9092其实和上面这个create差不多，也需要指定你要看的是哪个服务器，因为我们这里是没有搭建集群的，但实际生产环境中可以搭建集群，可能有多个服务器，你要看的是哪个服务器，所以你要指定这个服务器9092好这就可以了，回车那就列举出来的所有的主题只有一个就test。

好了，那么既然主题创建好以后，下面我就要往这个主题上发送消息，我们是以生产者模式的身份来发送，所以我们需要调用生产者点bat，就producer点bat命令才能发送，就这掉了。

卡副卡杠看守杠producer点bat调命令工具，然后杠 god list broker不是服务器的意思吗？其实它的意思和有点类似，就是服务器列表，你要往哪些服务器上去发这个消息，我们现在只有一个 Local house，9092往这上发消息，然后往这个服务器上你往哪个主题上发消息，杠杠topic test，我要往这个主题上发消息，回车以后很快它出了一个小三角，表示你可以写字了，你可以开始发了，我就写了。

Hello，hello，world现在又发了两条消息，每发一个回车发出两条消息发出去了，然后此时生产者在这阻塞着在等着你发的更多的消息，但我没发。好，接下来我们得再去通过消费者的命令去看一下我能不能得到这个消息。因为当前窗口被生产者占用了，所以我再启动一个窗口，这个窗口代表的是消费者，我要去读这个消息，当然了为了执行命令，首先我也需要CD到 D盘的目录下， d盘cdd d work卡不卡？

并windows。

好，我CD到目录下，然后我就像调生产者命令一样调消费者的命令是吧？卡夫卡看守看沙漠点办，然后刚刚 boss抓sir都不好死，9092意思是你要从哪个服务器去读数据？我要从9692读数据，然后读哪个主题？Topic，test，读 test，主题中的数据，然后站杠杠strong。比给你意思是我要从头开始读所有的我就回车，稍等片刻之后，他很快就读到了你之前发过的消息。

Hello world。只要你发到这个位置，发到这个主题下，那么我就能从这个主题下依次读到这个数据，生产者与消费者他们之间就这样产生了通信。好，再来。你看这边我这放着这边再来再写，比如说 How how are you回车，你看这接到了我就这样写，好，很快就接到了，这两端就可以产生通信了。

当然我们这只是通过命令行的方式给你演示一下这个卡夫卡它到底是一个什么样的形式。

当然这个你了解一下对卡夫卡有一个直观的印象，也检验一下你的工具的安装的好不好好，不好用，然后后面我们更多的是采用Java代码，尤其是采用spring去整合卡夫卡去访问卡夫卡，那么当然那个是更重要的内容。好，那么这次课我们就对卡夫卡做了一个了解，课后大家把它安装好，然后也把命令敲一敲，对它熟悉一下。好了，这次课我就演示到这里，咱们下次课再见。