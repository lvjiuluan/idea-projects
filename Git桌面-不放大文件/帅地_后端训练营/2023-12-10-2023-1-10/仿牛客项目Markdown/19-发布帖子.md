19-发布帖子.mp4

这次课我们来实现发布帖子的功能，那么在实现这个功能的时候，我们需要用到异步请求，那么所谓的异步请求就是当前我的网页不刷新，然后我还要访问服务器，那么服务器会给我返回一些结果，这个结果不是网页，那么我通过这个结果中提炼出来的数据，我去对网页做一个局部的刷新，通常是给一个提示，更改一些样式之类的，好，这样的方式就叫异步请求。

那么实现异步请求的技术叫access，就是异步通信技术。所以首先我们需要对 Access这项技术做一个了解。

 Jack它是一组单词这样一组单词的缩写，那么翻译过来就是异步的JavaScript与xml所以你根据命名来看，它里边并没有包含什么新的技术，它不是一门新的技术，它只是一个新的术语。换句话说，我们只是利用老的技术，然后产生了一种新的玩法，这个叫access。

然后像我刚才所说的就使用access，那么网页能够增量将增量更新呈现在页面上，也就是说当前页面不刷新，然后访问服务器给我返回一些，结果我再把这个结果增量的更新到页面上，大概就是这个意思。

然后 Access中的 x代表的是xml但是现在其实我们要求服务器返回xml的时候几乎没有了，因为我们得到了xml以后不好解析，它结构比较复杂，目前的话我们都是要求服务器返回杰森格式的字符串，它比 xm简单多了，方便多了，然后任何语言都可以解析这种格式的字符串，所以说很方便。

好了，总体来说 ajx他的手册你可以从某z了官方网站查到这个地址，我列在这儿了，那么科科网如果你有时间的话，可以自己去看一看，课上的话我们就不去看了，那么我这些关于Jack的一些总结提炼都是从手册中提炼出来的。另外一会我们演示的案例也是根据这个手册提炼而来的。

好，那么我们一会演示的内容主要两部分，一个就是我们先写一个 Jack请求的小例子，大家体会一下依附请求是怎么去处理的。当然我们发异步请求可以用原生的js也可以用 Gs框架就carry，那肯定是框架比较容易，所以说我们就用carry。

另外我们的项目前端页面是由做的，它就基于这块，所以我们每一个网页上就已经引入了几块，所以说我们用几块也会非常方便在项目里。这个事例你了解以后，我们就利用这种方式去开发发布帖子的功能，这是我们这次课的一个安排。接下来我就给大家演示一下使用解块发送异步请求的一个示例。

好，我打开这个idea，那么要想开发示例，首先我想这样，我在community utu之下，我想加几个方法，是处理杰森字符串的方法，因为我们服务器要给浏览器反馈杰森字符串对吧？

现在我们没有这样的工具不方便，那么实际上我们当前的项目中已经依赖了一些杰森相关的包，就是不一样，他把我们引入进来了，叫Jackson，但是我们平时开发的时候可能更习惯于用另外的一个叫fast节选，就是它的效率更高一点，性能更好一点，所以说这样我就再引一个包 Fast Jason，然后我们用包下的API去处理基层相关的就转换好，我就打开浏览器，我已经提前打开了，这个网站我搜一下包叫fast Jason。

那么你看第一个就是它的使用数是遥遥领先的，然后这个是阿里巴巴开发出来的一个包很好用的，然后我点一下 fast的节选好，然后选一个最新的版本。好，把这个代码拷过来，把它粘贴到 home点xml零。稍等好了，这个包就依赖好了以后，接下来我就利用这个 API去开发几个工具方法，一会好用，这个方法是什么？其实就是我们平时给服务器向浏览器返回的阶层数据往往需要包含几部分内容，我们就把这几部分内容整合到一起。

第一个就是我们通常会给浏览器返回一个编号，比如零代表什么意思？一代表什么意思？编码代表什么意思？返回一个编码。

第二个很有可能会给浏览器返回一个提示信息是成功还是失败，还是怎么样。

第三个也可能会返回一些业务数据，这个业务数据不同的功能就不一样，所以根据这样的一种诉求，我这样是提炼这个方法，首先它得是公有的，然后静态的方便调用，这个方法最终返回的是一个Jason格式的字符串，所以是个string，然后方法名我叫get Jason时间获取Jason字符串，然后你需要给我传入的是扣的编码，然后再来一个message，提示信息，再来一个map， Map当中就是封装，你的业务数据不同的功能就不一样，这样的话就比较灵活一点。

好，那么调用者把这三个条件给我，我把它封装成一个接生对象，然后把这个阶层对象转换成字符串，我们就得到了一个阶层格式的字符串。

好，首先我需要把这个参数封装到阶层对象里，阶层对象我们利用 fast计算API是这样的，它叫结算不对，好，就是 com的阿里巴巴 fast节省就它了，我上面的变量名就叫节省等于new，节省不对，然后我把传入的参数装到对象里去，节省点put扣的，值是扣的，然后节省点put message。值也是message。

Ok先把这两个值装进去，那么map我需要把它打散了，把每一个建制队单独装到对象里头去，所以我要先对map做一个判断，它y为空了对不对？先判断一下。

如果说它不为空，我需要便利 Map，它便利map有三种方式，一个是你便利它的key，一个是你便利它的value，一个是你便利它的 key value，我这里便利他的key，遍地k你就要获取map点key set key的集合，每次标的得到一个key，我就节省点put，我就把这个key存入 Jason，那么它的值是它对应的value就是MAC点get t ok好，那么经过了这一段代码，继承对象它的里面就封装了，你传给我的这些数据，最终我把它转成字符串，那就是杰森格式的字符串，瑞森杰森点儿too Jason死菌这就行了，我们在调用的时候，有些时候可能就没有什么提示，只有一个编号，有些时候可能就没有业务数据，只有编号，或者是只有提示，就这个编号一定是有，然后提示或者是这个业务数据可能没有，因此鉴于这种情况，我再加两个方法，就对这个方法重载一下，便于调用。

好，再来一个 get范围跟它一样，存在参数不同，比如说有一种情况是只有这两个参数，就是code和message，这个就很好办了，我们就可以调它了是吧？To，return get就是传入的是扣的message。然后 map没有，全是文档好，再来一个，有些时候可能连 message也没有，只有一个扣，就这种这样的 message也是no，这样写就方便了，那么这个写完以后可能是大家对杰森 API不熟悉，所以说我们写一个命运方法给他测一下，测完以后你就对他印象就直观了，我就因为这个工具类比较简单，它也不需要由容器来管理，所以我就在这里直接写一个命运方法进行测试了，这样。

我先创建一个麦，就模拟一点业务数据。

好new map，然后 map点put，比如说我装一个name叫张三 map点put，装一个ed假设，他是25岁好，然后我就调用 get杰森斯顿这个方法，比如传入的客户的是0，我传入的提示消息是ok，没有问题，我传入的业务数据就是一个map，然后我把得到的结果打印出来非常简单，我执行一下命看一看结果对不对？

好，你看我们最终得到了一个json格式的字符串，其中 message值为ok，扣的值为0 name值为张三，h值为25，所以说我们很容易就能得到这样一个格式的数据把它传给浏览器，浏览器把它转化为GS对象，然后可以得到每一个key所对应的值也很方便，这样就很容易实现一个前后端的交互了。

好了，有了这个工具以后，下面我就开始给大家演示 a jacks，它的示例我们怎么发送一个异步请求，我需要在CTRL那里先加一个方法来处理这样的一个请求，是一个小事例，所以说我在阿尔法CTRL里写代码，我在最后的位置来写个注释，这是 jacks实例。

首先我声明这个方法的访问路径，pass等于就叫 jacks简单一点事例，然后请求的方式我设为post，就是通常情况下很多时候是页面是要给服务器通过异步的方式提交一些数据，然后我们保存完以后给浏览器返回一个简单的提示，它一提示就完了，那就是我们一会要开发的，发布帖子的功能其实就是这样的，所以说我这里就用的是 post请求，然后因为是异步请求，我们不像浏览器返回网页，我们返回的是字符串，所以你要加上注解 risk，boss body。

好，我再接着说明写这个方法，返回字符串，方法名随便取叫test DX然后 POS的请求浏览器要向我提交数据，比如说我希望他就提交一个内容，提交一个位置，然后我去处理，当然我这里是模拟就不处理了，我只把它打印出来，只要能接触到怎么处理都是次要的。

然后最终我要向浏览器返回一个届深圳服换，我们就可以利用刚才所装的工具了， community Ocho点get Jackson get Jackson string，这里我没有不需要返回业务数据，我只要返回一个编号00代表成功了，然后给一个提示消息说操作成功就完了，我就不返回 map。

好了，那么 CTRL这个方法我就完成了，完成以后我们需要有一个网页，网页上面还得写一段解块代码，然后来访问这个好我要新建一个网页，为了方便这样，我就写一个静态的网页，我在这个时代的一个之下，在html里写一个静态网页，这样的话我这里就不用加方法去访问网页，静态网页可以直接访问吗？

好，我就利用一个html，这个文件名我叫 jacks demo这样看起来比较直观，放大一点，这个标题改成叫ajx好，这个网页我把它搞得简单一点，写一个段落，然后段落里写一个按钮，只要我一点这个按钮就向服务器发送一个异步请求就行了， tap等于8000，然后 y的按钮名字叫发送，我一点就发送一步请求，然后点的时候我要触发单击事件，在这个事件里我要调send的方法，所以接下来我们的重点就是来实现散的方法，那么实现这个方法我需要用到几块儿，首先我得在这里引入几块儿，当然我们项目中原有的页面不用引入，它默认就引入了，怎么引入几块儿，咱们随便找一个页面去看。

比如说首页搜一下index，点html再找到底部，这句话引入9块2，通过解块儿官网引入解块儿，不是本地的。好，我就把这句话靠过来，我当前页面就引入了几块儿，然后我再写上 square的标签儿，在这里面写实现 send方法也说明这个方法 send。好，那么用且夸瑞去发送一个if请求非常简单，到了点儿，如果你想发get请求就点get，如果你想发post请求就post非常容易。

当然其实解块儿还有一个万能的方法，就是到了点儿和jacks这个方法的话就是你可以配置任何的参数，你是get请求POS请求什么请求都可以通过这个方法来配，当然它也最复杂。

那么其实我刚才所说的get post是一个简化之后的方法，我们就用简化之后的到了点pose，那么这个方法它常用的参数有三个，为了看起来比较舒服，我通常会要换行三个参数，第一个参数是你要访问的路径，我要访问谁，前面那天然后阿尔法the jacks这是我的访问路径，逗号隔开。

第二个参数就是你要向这个服务器提交的数据，这里我们是要写一个json，就是写一个怎么说 js对象，说明一个js对象其实它也是json格式， js对象的直接量其实就是Jason格式，我需要向服务器提交的是name对吧？Name，然后比如说值是张三，不要向服务器提交年龄age，它的值是23，这就可以了。

最后我们还需要声明一个回调函数 function是匿名的，没有名字。

那么当这个服务器给浏览器做出响应以后，那么浏览器得到响应以后，它会掉这个方法，并且它会把服务器返回的数据传给这个方法，这个data是什么？

Data就是服务器返回给浏览器的数据，当然它是个字符串，好，我要证明一下，怎么证明很容易，我在控台把 data打印出来，我打他的太 TS有个函数叫type of data就可以看出来这个data它是不是死菌，但是另外我再把 data整个内容打印出来，那么它是字符串，我需要把这个字符串转换成GS对象，这样我才方便用GS去调，怎么转呢？

用解块也很方便，就到了点pass，Jason你把这个字符串传进去，那么它会把这个字符串转换成一个 js对象，我再把它赋给data，经过这句话的执行，data就变成了js对象，我就可以调用它里面的属性了。这里我这样我把它的类型再打印一遍，看看有没有变好。

然后我去访问它，访问它，访问这个对象data点，这对象里有什么，它里边不是有扣的有message对吧？我就data点扣的再来一行，得特点卖c好了，总之是一个简单的小实例，而且解块儿发送异步请求的这个格式是固定的，你哪怕把它背下来也没有关系，好，写完以后咱们测试一下，我把服务启动一下， Sorry搞错了。我现在我选错东西了，我应该选 community，application不是YouTube，我说怎么半天不动呢？

好再执行一遍。好执行完以后我就打开浏览器，首先我要访问静态页面， Local host8080community静态页面放到了html路径下对吧？然后页面的名字叫a Jack's demo点html，我就看到这个页面了，它只有一个按钮，好先不着急先点右键点警察，我把控制台打出来看他报错说没有。图标，我们确实页面上没有引入图标，不管它，因为是个小例子，我就点发送了，点发送你看他反馈的结果，首先我输出的我打印的是什么？是返回的数据的类型，string，字符串没问题。

第二个我输出的是整个数据，它是一个字符串，message是什么？扣的是什么？没有问题对吧？接下来我又把这个字符串转成了对象，再打印它的类型就是对象object，然后我data点扣的就等于0，data点message就等于操作成功有没有问题？

好，那么利用这样的方式，你看我们这个页面不管是说路径也好，还是说页面的内容也好，是没有刷新的，保持住了，然后我们在这个情况下访问的服务器得到了一些结果，就这样了。

好，那么这个小事例搞定以后，接下来我们就可以利用这个内容去实现发布帖子的功能了。

好，下面我们就去开发这个功能，这个功能的开发还是那么几步，我们还是从数据访问层开始写起数据访问层，首先我们得有增加一个方法，就是我们能够插入帖子的数据对吧？得增加这么一个方法。

好，我就打开这个 Discuss post map这个接口当中之前我们声明了查询有关的方法，现在我们需要追加一个追加一个增加帖子的方法，这个方法因为是增加返回的是增加的行数int，然后方法名我叫int discus post，那么你插入数据时要传入的是实体 discourse，post，好，这就声明完了就这么一个方法。

下面我们再去实现这个方法也比较简单，我需要打开 discourse，post，map。

好，那么我要在这里就是在写一个音色的语句，然后把刚才的说明的方法实现了，这样音色的语句我也在前面定义一个 circle，然后把这个音色它的字段把它在这儿声明出来，其实insert的字段往往就是比查询字段少一个ID而已，我就可以复制粘贴，但你 ID改一下叫音sir的feels。

Ok，接下来我就要来写 insert的语句，写一个音色的标签，ID等于刚才的方法名，避免写错，就copy音色的，然后返回的不是返回的是参数，因为返回的肯定是一个整数参数， private type就等于实体 copy一下。好，然后我们在这里写 circle就可以了。 Insert into discuss post。

然后括号是你要插入的那些字段，我们可以就include引入这些个字段叫insert，讲错地方了，insert，然后我就需要给这些个字段的赋值，这个音色的feels和select feels它不是其实差不多的是吧？那么负值的话， Select它没有负值，我就只能一个手写了。

没关系手写，但是顺序不要搞错了，首先第一个是user ID第二个是标题抬头，然后是content的是内容，正文再来就是类型，帖子的类型，然后是帖子的状态，然后是帖子的创建时间，接下来是这个帖子的评论的数量，他们的抗体，最后是帖子的分数，好了，这个DNA我就写完了，写完以后其实最好是测一下这里，我上课上的我就不去测了，节约点时间，你课后的话因为你写的代码相对少一点，你最好多测一测，测好以后再往下进行。

这里我就偷个懒。

当然如果说一会我们开发完以后，在执行的时候报错，我们再去看 circle，其实也行也可以。好了，数据访问能写完以后，接下来就写业务层面对吧？业务层我们需要提供一个能够保存这个帖子的业务方法，就在这里就需要把我们上次课所讲的过滤敏感词就能用上，因为你添加的帖子的数据，它里边可能写一个大段的文字，可能就会包含一些非法的词汇对吧？就需要做这样的处理。

好，那么接下来我就看有没有已经有了 Discourse，post service，所以说我们直接在里面追加一个方法就可以了。好，我就追加一个方法，返回int，方法名叫at this cast post参数discourse post。首先我先对参数做一个判断，如果说post的值是空的，那我要抛异常了，我就不能往下继续了，在这里给一个提示说参数不能为空。

好，这是第一步对参数的判断。如果说参数不为空，接下来我们就需要对 Post当中的数据做敏感词，相关的过滤 discourse post，它里边的哪些数据需要过滤，我们看一下这个表，看一下表。

 Id这个数字肯定不需要这样的，就需要后面是数字还有这个时间了，这些不需要只有title和content需要做处理。

做处理的话，我们一个是过滤敏感词，还有一个事儿，其实你最好也把这个标签也给它去掉，比如说他填写的一个标题，他是这样写的，带了个标签里边的话可能是写的是什么？

我们最好把这个标签小于号大于号也给它替换掉，不然的话这个标签显示到网页上的时候，可能会表现出元素，表现出一个标签的特点，比如它里边可能注入了一些对叶脉有损伤的破坏的一些内容，可能有影响，所以说我们不希望我们只希望浏览器认为这是一个普通的文字，而不希望他认为这是一个标签，这个意思，所以说你要对这个标签也做一个处理，这个处理比较容易，是不用的，工具，我们所依赖的工具其实就有这个功能，我给大家写一下。

首先 post点sat先处理开头写注释，这是先转译，先转译的是html标记怎么转移我们Diao这样一个工具叫html utilize，这是 spring mvc给我们提供的一个工具，然后它有一个方法叫htmlsk你把内容传入进来，如果这里边带了标标签小于号大于号，它会做一个转义转成转义字符的，好我就post点get开头，这样的话我就把原有的抬头进行一个转移，当然你如果没有标签它就不处理，同理，还有 content也需要做一样的处理， html ugs，SK，然后 post点get content好。那么转译完标签以后，接下来还要做一层就过滤敏感词，那么过滤敏感词就要用到我们上次跟他所写的工具了，对吧？

所以我们需要把工具注入进来，那个工具叫三ctf beautiful。那么注入进来以后，我们再做过滤敏感词的处理，pose点set开头，然后三CT filter，点filter，post点get开头。好，同样的处理 post，site content好了，那么该转移的也转移了，敏感词我们也过滤了，那么最后我们就可以去实现插入数据这一步了，直接调迈克就能实现了，我就return discourse的迈克点，insert，discard post，我的参数名叫post，好了，这样就完成了，完成以后下一步就是要开发视图层，那视图层一个是我们需要写 controller，对吧？

第一个第二个对页面我们需要做一些处理，但是我们这次处理的页面不是说随便配个表单，它是一个异步的方式，我们需要写点这个 js代码。好，接下来我们就写 CTRL，首先我打开，你看我们之前是做了首页，首页是查询的帖子是在home control里做的，这样我新建一个control，在这个control里去实现增加帖子的功能。新建一个类 this cast post很多了，那么以后再有和帖子相关的业务我们都写在这里来。

好，首先我需要在类上写上CTRL的注解，标记一下，另外我给你俩加上一个与开始卖品配好一个路径给他。这个录音楼写的简短一点就叫discard，简写了，然后那么我们要在这个内容要实现增加帖子的功能，你肯定需要依赖discus post service对吧？我们就把它注入进来。好，朱书记来下面我就可以去处理增加帖子的请求了，注意这是一个异步请求。

放大一点在这放大一点，首先声明它的访问路径，爱的这些路径叫discourse at就很直观了，然后因为你是增加数据，你要浏览器要提交过来很多数据，所以说提交的方式请求的方式应该是post，另外我们给它返回的是字符串，不是网页，所以说加上request包点，那么这个方法是public，返回的类型是死菌，然后这个方法的名字我叫ed discuss。

Post，那么页面上传入的是什么？其实页面上只传入两个值，页面上只传入标题和内容，那么帖子类型默认都是普通的帖子状态，都是默认的状态，然后创建时间就是当前时间，这都是自动生成的，默认你新增的帖子肯定没有评论对吧？

默认它也没有分数，所以说浏览器只能给我们传这两个值，ID生成的，那么优质ID就是当前的用户发的帖子，说到这我们还得再注入一个内容，因为你也得获取当地用户对吧？

得通过 Host后者去获取，所以我们还得补充一个猪肉叫 house偷的，好了，那么参数刚才我说了，页面上只需要传入一个标题，另外一个content就可以了。

好，那么首先你发帖的前提是你得登录，你要没登录是不允许发帖的，这样我先尝试从后者里去取优点，如果优者都取不到的话，你后续也不用继续了就有问题了。

好我获取user我判断一下，那么如果说user是空的，就表示说你还没登陆，这种情况怎么办？我就给页面反馈一个提示，注意是异步的是阶层格式的数据，我可以利用它，没有那些有q的工具点get接生词卷给他返回一个403的编码，403意味着没有权限，403代表的是没有权限的意思。

好，然后这里再给个提示说你还没有登录好，那么如果说程序执行到这，假如说他已经登录了，他登录了我们就需要调service去保存这个帖子，当然你在保存之前你需要构造一个实体出来对吧？

我就创建一个POS的对象，ID自动生成，那么user ID我们需要传入的是当前的用户的ID，标题是传入的标题内容，就是传入的内容，另外后面还有类型默认是普通帖子0，状态默认是0，所以说这两个字段不用传也行，因为它默认整数就是0对吧？你这个时间得初始化一下。这些数据默认都是0，还有时间需要处理一下好。我就 post their site create time。然后 New date。Ok，对象构造好以后，我就调用service的爱的方法把它存进去就完了。

好，最后我就return虽然给他一个反馈，我们默认如果说程序执行到这，我就认为成功了，对了，我就给他返回一个正确的提示 community get精神0，表示一个正确的状态，然后提示消息说发布成功，完了有人可能会想说你永远都是成功的，这里就不有可能没有可能这报错什么的，那么如果说程序在执行的过程中报错，那么将来我们会统一处理，我们就不在这一个处理。

所以说这里我写个注释就是报错的情况，将来统一处理，所以说我们认为程序正常，不会报错，而报错是我们在另外的地方单独处理就好了。

 Ctrl写完以后，接下来我们就要处理页面了，这个页面在什么地方实现发布帖子，我们之前其实也看过，这里我访问一下首页，在首页上点我要发布点这个按钮，然后再发布帖子，所以我们需要看一下首页是什么样，搜一下index，html首页，那么我找到发布帖子的那个地方，它在头部不在头部里，在这个内容里，在弹出框在这个部位。

那么是这样的，你看我们74行这有个按钮，这个按钮就叫我要发布，那么当你点按钮的时候，这个框就会弹出，然后你在这里输入一些信息给你看一下，就这样，目前默认已经实现了，页面上默认就已经实现了，这个动作已经由GS实现了，我们不用管，然后我们在框里填数据，填的是标题和正文，这两个框中的值我们待会要取到，取的时候通过ID去取，比较方便注意取完以后，那么当用户点发布的时候，这个数据就要发送给服务器，所以说那点发布的时候发布按钮他就得调一个方法对吧？

其实这个方法也已经自动的注册好了，页面上就已经带了。在哪？是在当前页面所依赖的 Gs？

李好。咱们可以看一下 GS， index的GS里我们找一下 js文件，搜一下index点GS你看他这里写了一段代码，说到了function在页面加载完以后，那么获取到按钮，发布按钮，然后给它定义了单击事件，单击时调这个方法，那么这个方法的动作已经定义好了，然后他首先先把输入数据的框这个框给隐藏了，因为你就发数据了对吧？发数据以后这个框就不用写上隐藏了，隐藏以后那么接下来他又把一个提示框显示出来了，这个提示框过了两秒又隐藏掉，还有个提示，那这个提示框找一下在这提示框在这里会显示一些提示的内容，当然这个提示的内容我们需要根据服务器返回的结果做一个动态的处理。

好，所以说我们页面上需要用到这些内容，但这些内容不是说我们去直接改这个html，而是我们去处理 js。好，下面我就给大家写一下 GS，我们再回到 index，点GS，在这儿主要是写这个方法。

首先当我点发布的时候，那么我就把刚才填数据对话框隐藏掉不用动，然后不要急于去显示提示框，你得向服务器发送消息，它返回结果以后再再提示对吧？

所以这个是后显示的，我在这中间我需要做一件事就要发异步请求了，发异步请求之前，我得先获取到标题和内容，不好传这个内容对吧？我获取这个标题和内容，好那就得用到 ID了，我现在打开的东西太多了，我先关掉。不用的，要不然碍事，我们看一下 ID是什么，叫这个名字。

拷过来不用改，我首先取的是标题，开头等于用这个写carry ID选择器，选中的是文本框点Val得到的是框里的值对吧？同理 content也是这样获取的，也是ID选择器，看一下它的ID是什么叫这个名字。Message、text、点位，好了，取到这个值以后，接下来我就可以发送异步的请求了，这个请求是一个POS请求，因为我要提交数据对吧？那么怎么发送刚才我们不是也演示了吗？到了点pose，然后是三个条件，第一个是访问路径，访问路径是项目名我写上常量，context、pass加上discus，然后艾特这是我们要访问的路径。

然后第二个是你要传入的数据标题和内容，我就开头冒号开头值，然后逗号，content，冒号content的值，最后再加一个回调函数来处理返回的结果，那么这个返回的结果返回的是字符串，我需要把它转成对象对吧？

所以我还是那么写 data，等于dollar plus Jason，那么得到了对象以后，那么我会得到一个状态以及一个提示消息，我先不管三七二十一把这个提示消息显示到这提示框的ID我需要用到这里，我先写一个注释说在提示框当中显示返回的消息，我利用ID获取提示框修改它的内容，是利用 txt的方法改它里面的文本，它的内容应该是data点message改了消息以后注意提示框默认可是不显示的，你接下来需要它显示出来，其实就是这段代码先显示，然后过两秒自动隐藏，你不要让用户去点麻烦，所以我把这段代码粘过来，改一下缩进这里写一个注释。

这里的意思是在提示观众显示反馈消息以后，这里面我要显示提示框显示显示以后，那么两秒后自动隐藏提示框，是这样一个逻辑。然后还有一个如果说我们返回的结果是ok的，表示我已经数据已经添加完了，添加完以后怎么办？我要把当前的页面刷新一下。

好，看到这个数据，如果说你添加失败了，报错了我就不刷新了，但是我给了提示，不管你成功还是失败，我这里都给了提示，但只有成功的时候，我们刷新页面，就这个意思。

在这刷新页面得判断一下是不是成功的，那就判断data点code它是不是0=0就表示成功，刷新页面我们用GS很容易实现，那就是windo点、location、点遗漏，重新加载当前页面，我们就能看到最新的数据了。好了，到这儿我们这段前端的代码就写完了，写完以后咱们测试一下，看看能不能行。这样我重新的把这个项目的启动一下，重新部署重新启动。

因为有的时候你的改动比较多，尤其是涉及到了新改的新加了一些静态资源，前端资源的时候最好重启一下，因为静态资源它有可能有的时候它就编译的不到位，你要注意一下，好，完成以后我就打开浏览器刷新一下。目前还有一个问题，我要发布，你看我没登陆，按理说它不应该显示出来对吧？你得我登陆了以后才能显示，所以我需要对这个按钮做一个登录与否的判定。

这个之前没有做，我再打开首页，然后找到我要发布的按钮，就在74行这个简单，就是说你判断一下当前用户有没有登录，你判断一下 log news是不是别闹就可以了。我这就写th if等于log in use，如果说它不等于not，我才显示这个按钮，等于我就不显示了，好， Ctrl f九重新编译，打开浏览器刷新没了好。

为了要验证能不能发布帖子，我需要登录一下，我就因为我之前注册的账号这个是1还是I我不确定。

换一个。

好，登录成功以后看到了这个按钮，我就点我要发布，然后写标题，随便写我就写叉，然后发布提示发布成功等两秒页面刷新看到了一个叉叉叉，当然你现在点点进去还不行，因为我现在一个帖子的详情页面还没做，但是我们在列表上能够看到叉叉叉这个帖子表示ok了，另外你也可以看数据库，你查一下这个数据也没有问题，对吧？

好，再测一个，我刚才添加的是一个没有任何敏感信息的数据，我再来一个有敏感信息的数据给你看一下，比如说这个标题，我加上标签，然后的话随便写一句话，alert，完了标题上带了这个标签了，然后正文里我带一些非法更非法的信息，也带上标签，这标签我就不带我带上一个 h一可以开票加QQ，然后什么大概就这么一段话，我这里有开票是一个敏感词。

好了，然后我就发布了点发布也成功了，然后你看它显示的是正常的内容，我们看不出来说它有没有转译，我们可以看数据库看一下，再重新查一下这个数据，你看这个标题的内容，是不是他把小于号转成了and lt对吧？

把大于号转成了and GT这样的话在页面上显示的时候就不会出现，他以为这是一个标签的情况，这只是一个普通的文本，然后正文可以怎么样？

被过滤了，被替换成了星，比方说我们敏感词过滤的工具也起了作用。

好了，到这儿我们就把发布帖子的功能完成了，总之在这个功能里我们学会了使用 Jack发异步请求，我们也运用了我们所封装的过滤敏感词的工具，也成功了。好，这次课我们就演示到这里，咱们下次课再见。