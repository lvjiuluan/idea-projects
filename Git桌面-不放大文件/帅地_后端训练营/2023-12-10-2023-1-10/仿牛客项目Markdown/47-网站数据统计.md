47-网站数据统计.mp4

这节课我们来实现网站数据统计的功能。那么要统计的数据有两项，一个是UV一个是dau首先你要了解这什么是UV什么是dau我们在统计这两项数据的时候分别要注意什么，那么我们适合能用什么样的数据结构的去统计这个数据，我们先要对这些内容做一个了解，下面我就给大家介绍一下这两个概念。

首先说优威它是 UNIX visit这个单词的一个缩写，那么翻译过来就是独立访客，就是说那一个一个人他访问这个网站一天访问多次，他算一个访客，但是我们如何去识别这个人呢？我们并不是通过这个人的ID又在ID去识别的，我们是通过他的IP IP地址来统计。

当然我们是去重以后进行统计，也就是说为什么要用这个IP来统计，因为我们希望把匿名的用户，那些游客没有登录的用户也统计进来，就是说UV我们关注的是访问量，而不是关注你到底注注没注册，你到底登没登陆，不管是谁，只要你访问就可以，就算这个意思。

所以我们每次访问都要进行统计，因为你不能确定这次访问他到底是不是一个新的用户对吧？所以每次访问都要统计，反正每次访问我都把用户的IP存到一个数据结构里，然后他最终去重以后就得到一个结果。

好，那么像这种场景其实特别适合于我们上节课所讲的还不唠不唠进行统计。因为 help log最大的特点它是存储的空间小，而我们这个网站的访问量可能会很大，每天可能有几十万甚至上百万甚至更多的量，那么你需要有一个好的存储空间小的结构去存比较方便，所以这个功能我们使用 help log进行记录进行统计。

然后第二个统计的数据是dau它是这样一组单词的缩写，daily active user，翻译过来叫日活跃用户，什么叫日活跃用户？

其实不同的网站它的定义不一样，有的网站认为说你只要今天访问过我的网站一次你就是活跃用户，有的可能认为是你今天不但访问你还要特定你要访问，比如说我的主页或者你要访问我的某一个区域，你才算活跃用户，也可能有的网站认为你需要访问我多少次才算活跃用户，每个网站的界定是不一样的。

那么我的要求是什么？就是说只要你今天访问一次，你就算是一个活跃用户要求比较低，有人可能会想你这么定义的话，是不是跟独立访客UV一样的注意是有区别的，就是我们统计活跃用户，我们通常是通过user ID排重统计，也就是说统计只是统计登录以后的用户，对于那些游客没有登录的用户是不关注的，所以说看起来好像一样，但其实又有细微的差别。

 Dna我们在统计的时候，我们更关注的是用户他的有效性，我们更关注用户的它的一个核心的程度。

所以对于这样的一个数据，我们在统计的时候要求它是一个比较精确的结果，不能是不精确的。

所以那么我们也是需要每次访问，我们都要去进行统计，那么因为我们要一个精确的值，所以我们用 Beta map比较好，因为我们用它的统计存储的空间也比较小，性能也比较好，再一个它能统计出精确的结果，而happy love达不到这个要求了。

有人可能会想你统计你用 beta map来存这个数据你怎么存呢？其实这个很好存，因为什么？我们的网站的u在ID是什么？是整数对吧？我们要记录的是什么？我们要记录的是优质ID，他今天访没访问过访问过，就是一没访问过就是01就表示活跃，0就表示不活跃，我们可以以 Id用 ID整数作为beta map的索引来存，比如说ID为101的用户，那么我就在beta map第101的位置存一个一ID为202的用户，就在202的位置存一个一，很好理解吧？

用这样的方式可以存，这样的话我们每天可能是有几十万个活跃用户访问了，那么我们只需要用一个bit map，然后有几十万位去存就可以了，所以说它也是比较节约空间的，这么多用户，我只需要用这么多位用一个数据就能存，也是比较节约空间的。

好了，那么大致了解了这两个概念的区别以后，下面我们就可以来写这个功能，总体来说比较简单，因为其实我们也看到了，我们但凡是和 radius用 radius来实现的某些功能，一般代码都不会很多的，因为rise它存储的存取的数据的方式都是比较简单直接的，所以那么我们在实现每一层的代码的时候，我就是这两个功能一起实现。

比如说我写 service层代码这两个功能我就一起把它写完，因为一共也代码也不多，好，我们开始写代码，我打开我的开发工具，因为我们需要用的是readus，所以首先我需要定义 readus的tea，我先打开 red skuto好，那么我就需要增加两个前缀，第一个前缀我叫UV是用来统计UV相关的数据的前缀，我这个前缀就叫UV好，我copy一个再来一个dau日活跃用户dau好。然后我需要定义这个方法，然后来返回对应的 key，首先我要返回的是一个单日 UV的key，就是我们统计 UV，我们记住这个UV是以天为单位去记，每天都记，然后我们实际去查数据的时候，查看数据的时候，可能我想看某一天的UV这是能支持的，很显然有的时候我们也可能会看那一周的UV如果你看一周6个月怎么办？

你把这一周7天数据把它做1个合并，我们 happy love不是可以进行合并就很方便，所以我们按照单日的方式来记做这么一个key，怕被克斯代理均衡 key方方面面的get UV t因为你要获取的是单日的UV那是哪一天你是不是把日记传进来？

我只要求你传一个日期的字符串就好了，我就不要求你传一个date，而且这个只包含年月日就可以，我们只是按天统，不用时分秒我这里就return，然后刚才 plus杠UV，然后加上一个分割符split，然后再加上 key就做好以后，刚才也说了，如果你想统计一周一个区间之内的UV的话，我们可以进行合并。

我们上次课也讲了，如果我对这个数据进行合并，它会产生一个新的数据也存到 radio对吧？

你产生新的数据不也得需要有一个key，所以我们再来一个区间有v从哪天到哪天之间的一个UV，这个我就要还叫 get uvk但是参数不一样，因为你是一个区间，所以说肯定是有两个日期，一个是开始，一个是结束，我叫石军。对，开始的日期再来一个。And对结束日期。好，我就return。Practice just beat it。然后加上搞错了，然后加上 start date，再加上一个 spill it，然后加上案例。

好。

这是关于UV的两个key，同理，那么我们统计活跃用户也是需要类似的两个key，一个是某一天的这一天的活跃用户，一个是区间范围之内的几天的也是类似的。好，那么这是单日活跃用户，我叫盖dauk我需要传入一个date为天堂，practice deo加上split加上好再来。

然后是区间活跃，用户get还叫dauk需要两个参数，一个是起始的日期，一个是结束的日期准确， study加上 speed加上and it好了。

 t我就定义完了。

定义完以后，那么我们开发的话，首先开发数据访问层，因为我们用的是 rise，所以说我们数据访问层不用单独写一个组件，我们直接上来就写service就可以了，去调 ready他们练就行了，所以我要写一个service，这是一个新的功能。

我创建一个新的service，我在包下新建一个类，这个类我叫data service，数据统计我就简短一点数据了，然后加一个注解，service。

好，那么因为这个例子当中我们重点是要用release，所以我把 release time late先注入进来，另外我们在统计的时候要频繁的和日期打交道，每一个方法都得和日期是紧密相关的，那么日期的话我们又需要对它进行格式化，而我们需要的格式化成年月日的形式，不用时分秒以日为单位。

所以我我在前面提前先室内化一个适应部队的方案，后整，这样的话我在整个类当中随时就可以用它，我到处都要用的。6CM的format给他一个格式，简单点yy yy mmd就是年月日就完了。

好了，那么接下来我们就来写有关统计相关的方法，那么要统计这个数据其实两个方面，第一个方面是我要把这个数据记录下来，在每次请求当中我要截获请求，把相关数据记录到我 Release里。

然后第二个当我想看的时候，我能够提供一个查询的方法能够访问到，一个是记，一个是查。

好我们一共是统计两个数据，我们就分开来做，我们先来处理 UV的统计。第一个方法我要写的是将指定的 Ip计入有为，因为是统计的是IP，好那就很简单，说明一个方法不需要反馈值记录，不叫record。

Uv。

记录的是iip所以你把IP传进来给我，记录就简单了，首先我就得到 k然后往里一存就完了。10卷 ride is key，等于 ride is key。

Youtube点get UV t好，这里你需要传入一个日期的字符串，传入一个日期的字符串。我们每次统计的时候肯定是统计当前时间的，所以我需要把当前时间格式化，然后转成字符串传给他，很方便就是date、format、点、format。

然后的话new。

 date就行了，今天的好我得到了 key以后，我要往 readiness里记录。我 run this template。

点ops for happy love，然后I的一个值一个t然后这个值是IP，好，记录这个数据的方法就完成了，然后还要需要提供一个查询的方法，能够让人很方便地查到这个数据，所以再来一个方法统计指定日期范围内的。

UV。

反馈浪，因为这个数据可能会比较大，然后统计就计算比较accurate，然后 UV因为是一个时间范围，从哪天到哪天，所以我需要你传入两个日期，你期望看的那两个日期，一个我叫star开始日期，再来一个一个我叫按的结束日期，好，那么这个方法之内首先我先对两参数做判断，那么任何一个参数为空，我不允许必须两个参数都传我才给你统计。

好。

如果说start等于not或者。

是and等于not，我将抛异常 through new。给一个提示给一个参数。

不能为空。

好，那么如果参数没问题，我们就要怎么处理我们统计范围内的 Uv的话，其实就是把这个范围内每一天的 k做一个合并，合并的话我们需要得到先得到一组k我得先收集到这一组k做成一个速度才行，对吧？

然后好调合并的方法。所以我需要今天从开始日期遍历到结束日期，然后把每一天的key得到，然后变成把它放到集合里，我需要整理 Key，那么我要整理该日期范围内的 key。

首先我先说明一个集合准备存整理到的t试卷，我叫t case。

new a released，

然后我整理的时候我是从这儿便利到这儿对吧？那么从那日期怎么便利，它可不像int对吧？然后每次循环以后，我这个日期是不是得加一天对吧？所以说为了能够对这个日期做运算，我们需要用到 kind，等于kind点儿， get insist，先室内画一个Kindle，但是 Kindle里面的日期还没有，我需要进行一个设置。

凯伦的点site看，我先把 start设置给他，我让 calendar里面包含的日期是开始日期，然后我就利用 calendar做便利，用 while循环 while凯伦的点get time，就是日期点 after。然后我前面加一个感叹号，好，我们看一下是什么逻辑。凯伦的点get time就是时间这个时间如果晚于and date，加个感叹号就不晚于and date。

也就是说这个时间是小于等于and的时候我就循环，它一旦大于and我就结束循环，就这个意思，也比较容易理解。

然后当然了，我在循环内部我首先要做一个处理完以后开展得加一天，让他无限的趋近于案子，最终等于案号结束这个循环对吧？必然死循环。我这个里边是开了的，别忘了开了点点加一天，单位是开了的点 Date，我指定的是加多少天一天这样。

好，在加之前我需要整理的是key，我需要得到一个key，这个key很方便，就是 cutu ready cutu然后点get UV key你把看了那笔所包含的日期传进去， data format点，format方面的 data就是开了你的点get，这就是我们所得到的一个t我要做的是把 t加到集合里去， t list at t好了，这就整理好了，当我们循环之后 key list整理的就是所有的这个时间范围之内的key我需要对它进行合并，所以下一步是合并这些数据合并完的数据， key我要进行一个声明， red is key等于 ready skill to点get UV key。

好，这个时候我需要传入两个日期开始到结束，当然我要传的是字符串，所以data format，点format，start再来df点format，这是合并以后数据的key，我接下来就要进行合并了，那就是readiness template。

Ops for help log合并有你，然后第一个参数传的是合并以后的key，然后后面的是其他你要合并的那些数据的key，我们就是集合了key list，当然你需要把它转成数组，他要的最终是数组那种集合转成数组， to和瑞。

好这就行了，这句话执行完以后，这个数据你就存了，合并以后的值，我们只需要做一件事，返回统计的结果就行了，我就return radius template和ps for have log，然后点统计数量site ready skip。

好，那么统计uvr这个方法我就完成了。那么除了ew以外，我还要统计活跃用户，其实也是类似这样两个方法，只不过我们的数据类型不一样而已，我再接着写。

接下来我要将指定用户进入到 dau数据子区加指定用户记录 dau public不需要反馈值， record什么 dau然后我们统计dau的时候，一般是按照优质的ID来统计的，所以传入就是ID这个也简单，首先还是先得到一个key t这里你也要传入的是当前的时间的字符串对吧？Df点format，然后new data有了p以后直接把它存到 radius template ops for value。

然后调的是site，背的方法，传入key。

然后刚才我一开始也说了，我们存的时候怎么存，我们是以邮政ID整数作为索引，然后存的是布尔值有没有活跃，是否活跃，我所以这个参数是uid然后数你调这个方法说明肯定是这个用户已经访问了，他一定是活跃的，对于其他的我没有调的，那就默认就是false，就这样就可以了。

好，同理我们还也要提供一个能够统计能够查询的方法，那就是统计指定日期范围内的DNA开了一个浪开口 dau那么这个参数也是开始结束两个日期。

好，那么整个逻辑和刚才其实统计类似，一开始也是判断一下参数怎么样，如果参数没有问题，我们也是当然我们背题map我们不是合并，我们是要把日期范围内的每一天的do做一个之间互相之间做一个运算，做一个奥运算。

如果说我要统计今天的活跃用户，你只要用户今天访问过网站一次，你就是活跃的。如果我以一周为单位，7天为单位统计这个用户是否活跃，那就是说在7天之内，你任何一天你只要访问过一次，就算是活跃，这是我们从产品角度去对活跃用户的一个定义。

所以你看我们这样的一个逻辑应该是做什么预算？奥对吧？任何一天你活跃那就是活跃，所以用奥运算好，基本上你要做奥运算，我们最后那一步也是需要你传的参也是也是一组 K所以我们首先第二步也是要整理 k整理完k以后再做运算，所以整个的过程和类似，尤其前面这两个类似都把它拷一下。

好，第一步判断参数为空，我就更改就这样。第二步是也是整理该日期范围内的t也是类似的，但是我整理 T的时候，我们 beta map的运算，它需要的t的类型是bad速度，所以这个集合点我存的不是死病，我是bad速度这样来处理好。

然后也是就开了盖，因此先16万一个开了，然后先把它设置为起始日期，然后便利的方式一样，如果开了你的 after and去反，不是这样的话，那么我就每次遍历我会得到一个key，这个得重新写了，好每次遍历得到一个t那就是red is t YouTube点get daudauk然后你要传入凯伦的所包含的时间，当然需要格式化一下放慢一点，然后是calendar点，get time。

好，我得到 key以后，最后我要的是这个我先这样先得到一个strain student。

好，我需要把 key转成bet数组放到集合里也很好办对吧？Key list点at，然后 keep叫get best，然后 k整理完以后，我就把这个日期加一完了。好，最后要做的事情就是进行一个奥运算好，那么进行奥运算，我们不能够直接使用思俊结构去调研这个方法，我们需要用 red底层的连接去调用，我需要这样写，我就直接 return。

 Red is Complete，然后 sq然后传入一个匿名的，ready是call back的实现 ready come back。

当然它这个方法默认返回的是object，但是我们这个方法期望的返回的是long我强转一下，但是前提是我要保证我在这里最终实现的时候确实是返回浪，好想转一下，剩下的逻辑我们就是在 doing readiness这个方法之内去实现了，把这个参数先明天再简短一点，那么我们做奥运算之后所产生的数据也需要存到一个新的数据里，也需要一个新的key，在这里我先把新的key做一个声明。

Read is key等于read is key。Youtube点get dau key。两个时间开始start结束，and好， key有了以后我要做合并了，那就是connection。

点儿 bit不危险，第一个参数传的是你要做什么样的运算，奥运算好，然后第二个参数传的是 k就是运算完以后你要存到哪去 k red is key，当然他需要的是bet，所以我点get bets，然后后面的参数你要对哪些key做运算，那就是集合里的数据， key list我需要转成速度 to are we？

然后需要单独处理一下，我需要声明它要转成什么样的类型，它最终转成的是new bad，一个二维的bad数组。好，那么这句话执行完以后，我们就可以进行统计了，当然我们统计的是 K的值，我就直接把统计的结果返回 connection，然后点被count red ski。对，get back。

好了，那么 service我就完成了，一共写了4个方法，完成以后，接下来我们就可以写表现层的逻辑，那么表现层的逻辑一分为二，第一个就是我们什么时候去记录这个值。

第二个我们去查看两两个方面，记录这个值我一开始也说了，我们需要每次请求都得记，因为每次请求都有可能是一个新的访问对吧？既然是每次请求都要记，你说我们在哪里写这个代码，很显然我们是在拦截器里写比较合适，对吧？因为这是一个非常通用的的处理方式，那么拦截器很方便能够拦截那么一个请求对吧？于是我要写一个拦截器，我在 intercept包下新建一个拦截器，专门解决这个问题，那么拦截器我给它取名了叫data center。

好了，拦截器前面我加上一个注解，另外它需要实现一个接口 hand in the second。

好。

那么在这个类当中我需要记录的是记录的是UV或者是活跃用户，我需要调 data service，所以我把它注入进来。另外对于活跃用户，因为我们记录的是优质ID，所以我还需要得到当前登录的用户的ID，我再把 house偷的注入进来。好了，我们在什么时候统计？当然了我们在 Free handle在请求支出统计就可以了，所以我重写 Free handle。

当然我只是做一个统计，最终统计完以后请求继续向下执行对吧？

你这里不要返回放，你要返回数，让请求能够继续下去，我只是加个塞统计点数据而已，那么统计首先我统计 UV，然后再统计这个d给u都在这一个软件系统统计了，那么UV首先统计UV你要统计的是IP IP怎么得到通过request，对象就能直接得到非常简单。

 String IP等于request点get remote，这就是 IP，当然如果说我们在访问的时候，我写的是look house，他这个IP有点特别，他写的好像是0.0.0.1，那么如果你是正常的一个IP地址，比如说127.0.0.1它就没问题，所以 house有点特殊，但是它是不是个错误。

好了，然后我就记录到 data service里面去， data service然后点 recovery，把IP传入就可以了。

好，然后接下来统计dau我需要得到当前的登录用户是吧？那就user等于house偷的get used，那么有可能用户没有登录，这意味着可能是now对吧？所以要判断一下，如果user是now没登录怎么办？我就我就不统计，如果它不等于not，我才统计这样的一个逻辑。

 Data service点，record dau然后是user点get ID。好，你看我们记录数据就非常简单，统计完了，记录完以后拦截器目前还没有生效，你想让它生效还得再做一个配置，我们需要找到 web，mvc肯定是吧？在这里面我们再把拦截器注入进来配一下，这个叫data interceptor。

好，那么在后面我也是把它注册一下，data intercept，当然对于静态资源我们不需要拦截，我们只拦截就是对CTRL的动态资源的访问。好了这就配完了，记录数据的层面我们就完成了，接下来展现数据查询数据，那么展现数据我需要写一个control的来处理这样一个请求，那么我在control的报价再新建一个类叫data control的。

好，那么写上注解很臭的，然后显然是要调data，service把它注入进来。

那么这个control里我们需要写三个方法，第一个方法是我要访问统计页面，打开统计页面的样子，大概是这样的，里边有两打开页面以后有两个表单，然后在这两个表单上你想统计网站UV你就填这个日期，然后一点一点按钮，就统计了活跃用户也是类似填日期点统计就可以了。

那么如果你点开始统计，我就要统计网站UV我需要提供一个方法，你点统计用户要提供一个方法，所以一共是三个方法，打开网页的方法，统计它的方法，统计它的方法。

好，我就写一下，首先我先实现打开统计页面的方法简单了，先说明他的访问路径，路径我叫data，就data，然后的话请求的方式，master等于这里面我写个大括号，两个 Request，然后 request，点post，为什么要这样写？

我一会写另外两个方法的时候再进行一个解释。

反正我先这样写着，总之这个方法既可以处理盖的请求，也可以处理POS的请求，然后方法需要返回的是模板路径，方法名我叫get data配置为这样，模板它在site二的面目录下名为data点开卖，所以我这样写site。

好的妹 data好了，写完以后这就可以了，我们一访问这个路径就能打开这个模板就可以了，但是模板一会我再处理，我先把另外两个方法也写了，也非常简单，我再写一个方法处理统计网站UV的请求。

好，那么瑞克斯卖品 pass等于data，UV master等于request点 post，因为你也看到了我们页面上要想统计的话得出来，要想统计的话他得选两个值对吧？然后点按钮，那就相当于提交一个表单，所以说要闯进来一些表单里的数据，我们用的是post。好这个方法名我叫get UV那么传的参数就是两个日期，一个是开始日期，一个是结束日期是大的。但你注意这个类型可不是普通的基本类型，它是一个日期。

那么我们页面上其实我们最终传过传的时候传的是一个日期的字符串，日期的字符串怎么转成这个data，它默认是不好转的，因为我们服务器也不知道你传的这不是什么格式对吧？

所以你需要告诉服务器我传的字符串这个日期是个什么格式，那服务器就知道了，既然是这个格式，我就能帮你转成对应的 data，它底层就可以做转换，我们怎么去告诉服务器这个日期格式，用一个注解叫date，time format。

然后对time format里边我们就写一个参数叫pet格式等于我希望日期的格式是这样的， yy杠mm杠DD页面上我们传的格式是这样的，那么同理也是一样的，太长了，换一个行就是这样的。

当然我最后我的结果要传给这个模板，我需要还用的model， model也声明一下。

好，那么方法内部的逻辑非常简单，统计的结果是个浪，我就等于data service点，calculate UV打死大的程序，把按的程序完了，那么统计结果我需要传给模板model，ed h build，然后的话我叫UV without就统计的UV的结果就UV另外你还要注意，那么我们统计完以后去哪个医院其实还是去统计页面，当我们就是一点这个按钮以后，就一点这个按钮它访问的服务器，服务器做了统计，又回到这个页面，回到这个页面的时候是不是起始年就开始年月日结束年月日还保留比较好对吧？

怎么保留？你看我这个页面访问了服务器，服务器再返回到这个页面的时候，你再把这两年再返回回来，它就能做一个默认显示对吧？所以这个时候我在model里再把这个参数再传回给模板好做一个默认显示。 Model点a的h的

 UV start对的。

然后就是start。

好，再来 Model点at attribute UV。

 and date and。

好为什么这个参数名我取名都以UV开头，因为我们这一个页面上能统计两组数据，而且他们的数据结构数据形式还很像start and start，and如果你就叫start和and的话，这两个地方就容易混淆了，所以说我们最好把这两组数据做一个区别，加个前缀好区别就这个意思。

好，那么接下来我就等回到这个模板就行了，那模板的话其实你还可以这么写，这样是可以的。

那么还有一种办法，我也可以用这个forward转发，注意如果我不写forward，我这样写，我是返回一个模板，这个模板的返回给谁，返回的是返回给dispatch serve late，因为这个方法是他第二个 disc就是为了得到这个模板，他就去让这个模板去做后续的处理，这是一种方式。

For word，其实是什么意思是就是说声明我当前这个方法只能把整个请求处理一半，我还需要另外一个方法继续处理请求。

注意另外的一个方法也是一个和他平级的能够处理请求的方法，而不是模板，我发布的到谁我可以发布的到 data就是这个方法，仿路径其实就是它了，我处理一半，然后交给你接着处理，交给他处理，他里边干了什么，里边不就是转转到了这个模板。

当然了，我们在这里其实你直接写这句话也可以，但我这样写主要是告诉你，其实我们发过来也是可以用的，之前虽然说过一遍，但是我怕有同学还是不知道该什么地方用，这地方就可以用。那么假设如果这里还有其他的逻辑的话，我这么写这段逻辑能够被复用，如果我只是规范这么一个东西，这个逻辑就不能被复用，所以说这样写是有一定的好处的。

好，我这个就用forward了。

那么接下来我就可以解释了，为什么说我这个地方要支持两个请求方式，因为当我调这个方法转发到转发给他的时候，你注意这是虽然说程序从这儿跳到这儿，请求从这儿跳到这儿，但是这还是一个请求，转发是在一个请求之内完成的，因为他接收的是一个POS的请求，他把这个请求转给他还是post，请求在处理的过程中请求的类型是不能变的，所以就要求他需要支持POS请求，这样的话才能够被转发，否则就不行，要注意。

最后我们再统计一下活跃用户，那么统计的方式和很像，我就copy一下，那么这个路径我叫dau Post，然后方法名我叫get dau也是两个参数，一个是start，一个是然后 model这个就不变了，然后我们统计的值得重新写了， dau等于data service点，calculate dau然后把 start传进去，把and传进去，我就得到了统计结果我需要把它传给页面的时候，这个不叫dau result值是dau好，然后当然了为了页面上能够再显示继续显示这两个开始日期和结束日期，我把它也传回去，改个名字。

Deal，start it，deal and ok，然后转发到统计页面没有问题。

好， CTRL的这三个方法我就写完了，写完以后最后就是处理这个模板了，模板叫data点html我搜一下，这个页面是第一次处理，我需要从头开始处理一下。

好，然后这个地方路径要处理，这个地方header要处理，好，内容一会再处理，然后尾部不用管， GS路径要处理一下，最后处理中间的内容的部分。

首先你要统计你需要配这个表单对吧？我先来配统计网站UV的表单，那么首先请求方式，method等于post。另外要声明仿邮件，action等于get Uv然后那表单中我有两个框，这两个框你要给它取个名字对吧？

我把这个数据提交过去， name等于和统计UV的方法的参数匹配，start name等于然后当统计有结果以后，再回到这个模板的时候，我需要这两个框能显示默认值，所以我要写th冒号y6等于当然这是日期，所以我需要格式化一下。对此点放慢点，然后是UV是这样，格式比较简单，就是年月日。好，那时分秒的就不需要了。那么按的是同理的，我把这个拷贝一下。

当然按的是UV and对格式是一样的格式完了好再看，当然了你统计结果需要在这个地方显示，在一个十八里显示，所以在 span这个位置我需要写上th冒号。

txt等于。

统计结果 UV without按钮，好，按钮得改按钮，它是8条，我需要把它改成3个问题好了，统计优雅就是这样，统计活跃用户不是类似的吗？

放然后是nice的等于post th action等于data dau这是关于 form的处理，然后这两个框也是一样的处理方式。

首先 name还叫start，这个还叫im参数名一样，然后 value topic一下什么事？This the format deo study，再来dau and date这是默认值。当然这里也需要改成submit，然后结果需要显示结果，就是dau伪造好了，这个表单我们很快也就处理完了，因为它数据比较少，处理完以后我们就来我们先测一下。

其实还差了一个环节，就是权限的环节，这只是功能的一个初步的实现，但是还有一个问题就是怎么说，这种功能不可能是每个人都能够访问到的，对吧？

它一定是网站的管理者才能访问，所以我规定只有管理员能访问他，那这个好办，我们之前有色块的配置，我们只要把它配一下就ok了。

那么关于全新的配置，我们打开 CK，然后找到这，你看之前这部分请求是管理员专有的，我在这里再加一个路径不就可以了吗？当然这不是一个路径，其实是三个路径， data，UV data dau我可以这样写data星星，反正凡是以data开头的你都不能访问就完了。好，那么完成以后，下面我们就来做一个测试，启动一下。

好，那么启动完以后，我打开浏览器，然后先访问一下首页，然后先不登录，但有人说我通过哪去点路径，其实我们在这个hide里不去配这个路径，因为这个路径默认普通用户，甚至连版主都看不了，所以就没有必要配了，管理员想访问怎么办？

他自己敲这个路径，稍微麻烦点自己敲。好，我敲一下，比如说我是一个游客，我就想访问这个data，你看访问不了。对你没登陆没有权限对吧？好我登陆了登录了，我家访问了，对他访问不了，不存在没有拒绝是吧？Ok，所以说这个权限首先是生效的，要想访问怎么办？你必须得有用管理员的身份。我比如再来一个21。

版主看看他能不能访问，然后data也不行是吧？没办法，我只能用管理员了，然后偷点11。

好，然后管理员登录以后他直接敲路径，管理员知道回车就可以访问了，我就填数据统计对吧？今天我是第一次起这个服务，其实就刚才操作了那么几下，就那么几个请求，我们看统计的对不对？首先我统计UV点这儿今天依然是今天然后我开始统计一个因为什么？

虽然说我换了几个用户，但是UV是按IP来统计的，都是一台电脑都是一个IP，就一个当然这个时间你可以调，比如说我调成26号到28号统计什么都没有，比如说我调22号到28号，统计一个，因为今天包含在这个范围之内，是吧？就这样了。

好，这是统计优惠，我在统计活跃用户，比如说今天还是今天统计三个，这是按uzid来统计的，你看刚才我是不是用普通用户，我用这个还有版主管理员，三三个用户分别登录我对吧？

所以说是三，而游客那个是不算的，对吧？所以是三，当然我再换个时间，比如说换成明天到28号，没有了是吧？然后换一下换成22号到28号，三没问题。当然因为我现在数据量小，所以说虽然小有好处也好算，那么数据量多的时候你再看一看，你自己去看好了，那么关于网站数据统计，我们就讲解完了。好，这次课我们就演示到这里，咱们下次课再见。