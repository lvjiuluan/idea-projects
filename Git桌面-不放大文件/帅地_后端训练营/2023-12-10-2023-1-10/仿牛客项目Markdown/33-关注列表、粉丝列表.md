33-关注列表、粉丝列表.mp4

这次课咱们来实现关注列表和粉丝列表，那么上次课咱们不是开发了关注了，对吧？那么我们把关注的数据已经做了一个保存，那么然后我们在某一个用户的主页上能够看到他关注了几个人，然后几个人关注了他，然后那两个数量，他关注了几个人，关注他那两个数量，其实是可以点进去以后各有一个列表，其实就是我们这次课程要开发的功能，那么现在的数据已经有了已经存好了，那么我们要把它做一个展现其实并不难，那么相对来说是比较容易的，然后我把我们要做的事情也做了一个归纳写到了PPT上，因为我们使用reds访问访问这个数据，在数据访问这一层比较简单，所以说我们通常就不去写 deo了，我们直接写业务层，然后就访问ID，或者说把它当做一个是内存的组件来对待，我们做这个功能业务层显然我们需要查询对吧？

那就查询的某一个用户，他关注了哪些人，然后你要分页。

第二个你要查询某个用户，他有多少粉丝也是要分页，那就是说从我们上次课存的关注相关的那两组数据当中去查就可以了。然后查完以后业务层开发完以后，接下来我们需要做展现表现层，一个是我们要写CTRL了，我们需要处理这个查询关注的人，查询粉丝这样的请求。

其次我们需要编写这个模板，也是要把两种查询的模板配置好。总之这两个列表他们的展现形式极为相似，差不多，几乎就一样，所以说我们就一起并行的把这两个功能一起写出来。

好，那么在写代码之前，因为刚才我靠嘴说不是很直观，我打开精神页面给大家看一下这个功能，比如说我点用户打开了他的主页，这里不是有两个数量对吧？

然后比如说你点进去能够看到这个用户他关注了多少个人支持分页，后退一下，当然点这也能后退，然后你点这个就是看当前用户他的粉丝就关注这个人的人，就是他的粉丝也是支持枫叶的，总之当然这个地方也是可以切换这两个功能，他们的展现形式是一模一样，主要来说就是展现他关注的人，或者是关注他的人，要展现的是人的头像，人的名字，除此以外还要展现的关注的时间。

我们在开发的时候将这个时间做一个倒叙，有人说这个时间是什么呢？咱们上存到有序集合里不就是一个时间，其实那个分数就是那个时间，我们把它把那个分数取到把它再转化为时间，这时间就有了。然后另外那么当前的登录用户看到了你，关注了这么多人关注了你，我如果对他有兴趣，我也可以关注这个人。

所以说当前用户也可以关注这里面的某个人，所以说这里边我们还要判断当前用户与这些人的一个关注状态，从而去开发这个功能，但这个功能的开发其实和首页上和主页上，这个其实是类似的，这个代码我们是可以复用的，简单处理就可以复用好了，废话不说了，我们直接来写代码，那么刚才说了我们首先要开发业务层是吧？

所以说我把业务层 follow service打开放大一点，在这里我要补充一个新的方法，然后写好注释这个方法我要查询某个用户关注的人，这是一个，除此以外还要做另外一件事，还要查询某用户的粉丝，就这两件事儿，咱们一个来先开发第一个咖啡，那么我们在集合里存的其实是一个你关注的人或者是你的粉丝的 ID，但我们传给页面的肯定不能只是ID，我们需要有user还需要有关注的时间，所以说其实是一个user对象和关注时间的整合在一起的数据。

这样我返回一个集合，首先这是多条数据，然后集合中我通过 map对这个数据进行一个包装好，这个方法名我叫范的follow with，那么你要查询的是某一个人的他关注的用户，注意我们在存的时候，其实我们不只是说存他关注的人，我们存的时候他关注的一个目标一个实体，但因为我们这个需求就是过于明确了，我们当前做的就是要查询人，如果说你把实体都融在一起去做这个查询有点麻烦，你又得判断他是人，我要查人，他是这个帖子我要查帖子，他是评论我要查评论，我这块我就不那么写了，我存的时候按照实体来写这个地方我就需求明确一点，我只查人，如果将来说我们还有需求要查帖子，查关注的评论，我们再加方法去实现，这块就不揉在一起写了。

好，既然要查某个用户关注的人，你得把用户传进来对吧？User ID传进来，然后我们要支持分页，所以说把分页的条件传进来。

好，那么具体实现的比较容易，首先我要拼 key，follow with key，咱们拼一下就可以copy，follow为key等于第一个我要传入 uzid第二个因为我们明确当前是查关注的人，所以说这个态度我们就可以固定下来写个常量就可以了。

Mtt好像没有引入常量接口，我就实现行了。

回到刚才的位置，这个地方就是NTT type user是三，好，有了k以后，下面我就要查询了，我要从集合中把这个数据查到，那我就ready template。

然后第二，office for reset是有序的结合，然后查多条数据，你要按照范围的方式来查询 range。

 Range它默认是由小到大的分数来查询，但刚才说我说了我希望它倒叙，我希望它由大到小，最新的时间是在前面的，你可以这样，你可以 reverse range倒叙，好，然后我们需要把这个条件传进去，首先你 key传进去，然后除此以外，我们在范围查询的时候，你要查你要传入两个索引，你要从哪儿查到哪儿，传入索引。

首先我要从奥赛的索引开始查奥赛的然后截止的索引其实是截止。如果是my circle分页，我们第二个条件就给一个当前页最大显示的数量limit就可以。但现在我们这要的不是 limit，我们要的是截止的索引，其实就是offset加上它，但是你要减一，因为这个奥赛的是包含的，所以你要减一这样才行。

好，查完以后我们就会得到一个集合，我们会得到一个集合，集合中的纯的是整数。

那么。

存的其实我们是我们关注的目标的ID，它盖ID我给它取一个名字。

好了，那么查到以后我对这个数据做一个判断什么判断它是不是为空，如果为空的话，我就不用做进一步的封装处理了，否则我就去处理。如果说他get ideas等于空值对吧？我就直接return now就返回就完了，否则我就继续。那么如果不为空的，我们需要最终把 Id转换成更详细的数据存到集合里，这里我就先把集合实例化一下。

好，然后我要便利他get ideas，然后把每一个用户渠道把相关的数据渠道好了，那么渠道以后每每个他改的ID我要查到了对应的用户，查到以后要封装到 map里，所以说我这里需要先实例化一下 map，好，那么然后我要把他get ID对应的用户查到，那我就调用user service，但目前设备还没有注入进来，我注入一下。

好注入以后咱们继续查询查 find user ID，然后把大概的ID传进去，我得到 user把它放到最终 map点put user那么除了 user咱们还要查关注的时间，其实就是有序集合中的分数，那也很好取，就read this template。

第二ops for g set，然后你要取一个分数，咱们之前不是演示过是调 score方法，当然你需要把 key传进来，然后你要取谁的分数，你把这个值传进来，那就是他get ID。

好，我要看看这个值它对应的分数是多少，我们会得到一个小小数，但我们知道这个小数其实我们当时存的是用这个时间毫秒数转化而来的，所以我们可以把它再还原回这个时间，我这样写map点put存进去，这是一个关注时间我叫follow time，这个时间我就new date。

然后 sky这是小数。

第二浪漫流把它转成了就可以了。最终 Map中包含了这两个值，我想要的，我把这个map在放到集合里就好了。

好最终我把历史的返回就行了。这是查询某个用户所关注的人，查他的粉丝其实也是大概的流程，我把另外的方法也写一下，但这个我们写的时候就不啰嗦了，我就直接写了，还是返回map，方法名这回我叫find follows。

好一样的参数，你也是要查某个人的，粉丝也要支持分页，也是这么几个条件。首先也是先拼 key，我还是copy。好，那么 key当中的tap固定为人的类型，所以还是它然后 ID是人的ID就是ID就行了。

那么有了t以后，我们还是像刚才那样去通过倒叙的方式把 ID查到，返回端还是一个site，我忘了我们之前在演示spring整个 ready的时候，我演示有序集合的时候，有没有说过我们调用这个位置或者是reverse方法查到一个范围内的数据，并且他会做一个排序，排序的时候它返回的其实是一个set对象，写到这儿的人会可能会有疑问，返回的是site，这个site不是无序集合吗？

你注意默认的话GDP的时间确实是无序的，那么其实 release的 range，方法它返回的是 site这个接口不假，但它的时限内其实是它内置的，它自己实现的是一个有序的集合，所以这块它是做了一些处理好。这个变量里面我还叫 target Alice，然后read this template ops for z set，然后 Reverse range道具，把follow key传进来，然后起始的索引，截止的索引，offset加上里面的建议。

好。

那么这个数据我还是做一个判断，如果说他get I DS等于我就对他其实和刚才这个是一样的，如果不为空，我们需要也是把最终结果封装为一个集合，整个代码结构和类似了，我就copy稍加修改就可以了。

好我实例化了一个集合和刚才一样，然后遍历 target Alice，在每次遍历的时候，我实例化一个map没有问题，然后要查 u字也是根据他刚才d来查没问题，然后把u字装到map里没问题，接下来也是要取这个分数，就是时间 ready，Stanley的ops符号计算 key不对，把它换成我们新的t传他get ID，然后也是通过 scar，我们得到 follow time存进去，然后添加到结构里返回，其实整个这两个方法都是一样的逻辑，只不过对 key处理不一样而已。

好，这个业务方法我们就写完了，写完以后开始处理数据访问层处理表现层，首先我们需要处理这个请求，我要打开 CTRL，然后根据当前的逻辑我需要添加两个方法。

好，我打开 follow controller搜一下，那么后面我加一个新的方法，先声明了他的访问路径， pass等于follows我要查某一个用户他的关注的人，那是哪个用户，你要把用户ID传进来对吧？我也希望把 ID通过路径传进来，所以说我再加一个下级， user ID，因为这是一个查询，所以说请求方式为get就行了。

那么方法名方法说明一下时间这个方法名我叫get follow with。在这个方法之内，首先我就要得到路径当中的 ID对吧？然后好用它来做进一步的查询，我就需要用到帕斯维尔堡注解。

好，因为要分页，所以说我要声明一下配置对象，那么为了往页面模板传数据往底下是model，好，这些条件准备好以后，首先我们要把 u的查到， service还没有注入进来，得注入一下。

好回来。那么就user service，find user by ID把 User ID传进去，然后我们对又得出一个判断，万一他写路径特意写个错的怎么办，对不对？万一是个错的没有值判断一下多了一个埃尔法，如果说是空的我就报异常了，给一个错误页面的提示，说该用户不存在。

好，那么如果不报错没问题怎么办？我要把我要把你访问的优点传给页面，为什么要把这个又再传给页面，你看一下好。

我点你看我们不只是列表，这列表前面有一个标签能点的页签，页签上，谁关注的人，关注谁谁谁的人，就是你访的用户，名字要显示在这，所以我把用在床上，为了显示这个名字，好我就murder I的attitude，然后的话悠着传进去。

好，那么有了user以后，接下来我要查询列表中的数据了，因为要支持分页，我对分页条件进行一些处理，进行设置site limit，比如说我每页显示5条数据，因为我的数据比较少，然后配置的set pass声明一下路径，路径不就是他，当然他得有下级，他的下级是优质ID，好我把优质ID拼上去，最后还要 site rose，我要查一下一共一共有多少行数据，从而计算的对总的页数做一个判断。

那么你要查询一共有多少行数据，我们可以调 follow service，然后点find。 Follow we count方法之前我们实现过find。Follow we count，然后你要传入uzid另外还要传入这个类型是固定的，NTT我好像还没有实现这个接口是吧？好，这个类型是固定的。 Itt type user，当然了我们最终查到的这个方法是不是它是一个它是个浪，但是赛特rose我们这个方法要求传的是一个整数，这样我们强转一下，那么关于分页我就设置好了，设置好以后最后就要查询分页查询我要显示的数据了，我会得到一个类似的里面装的是MAC，好。

那么。

变量名我叫优则类似，因为我查到的是优的相关的数据，那么调用的是 follow service，点find。follow with，把user ID传进去，把分页条件传进去。

好，那么最终得到的数据我们还要做一个补充，补充什么页面上，刚才我一开始我也说了，我们还得判断当前用户登录用户是否能关注他对他的关注的状态，而目前我们的关注状态没有。这得补充一下。

我就做个判断， User list如果说他非空我就遍历，然后补充数据，我就放每次遍历得到 map，得到遍历的是user list，好，那么每次我要得到map以后，我要从 map当中把你要看到 user得到，然后的话去判断当前用户对 user关注的状态，然后把u字取到基本上我叫u别和前面的 u字冲突了，好u等于 map点get，然后的话是user当然这里你要转型，然后我要判断当前用户对用户关注的状态是怎么样，这样我把这个方法单独封装一下，这样好复用，因为一会我们还有个方法要用的，突然问题玻璃返回布尔值s follow。那么你把你要判断的 uzid传进来，我们判断的是当前用户对它的关注状态，你先看一下当前用户那就household点get user判断他是不是登陆过是不是为not，如果说当前就没登陆，没有用户你就直接返回boss就行了。

因为如果没登录的话，那就不可能去关注它，我们就认为是没关注不了。

好，然后的话 return follow service，我们之前写过这个方法，还是follow，然后的话你把当前用户传进去 household，get user，然后就是get ID，然后 itd用户类型type user，另外的话再把有载ID传进去，判断一下当前用户对这个用户有没有关注过。

好回到刚才的这个地方，我们就可以调这个方法来做进一步的处理，那么这个方法我就这样直接往map里放， map点put，

 pass follow做。

这样一个标志。

然后的话调这个方法还是follow的，然后把优点get ID存进去，我就会得到这样的一个结果。

好，这会 map里的数据就补充全了，补充全以后，最终我把集合要传给模板 model，点艾特，然后users user list，好，最终我就返回模板处理模板就可以了。

那就是sat，然后followings网页的名字叫不是叫followings叫。

 follow me。

点html就是它好，那么除此以外还有一个还有一个请求是要查询的，当某个用户的粉丝，那么其实这个方法的逻辑和这个是很像的，我就copy加以修改，首先改一下路径上肯定是要变的，那就是follow us，粉丝follow us，然后的话也需要传输某用户也是 get请求，然后这个方法名得改一改， get follow us。

其他的不动，然后也是要解析路径中的uzid也是要分页，也是要用model往页面传数据，在一开始我们要查询用户，判断它是否存在，如果存在我就把它产品模板不用变，其次对分页的处理，然后我也要每页显示5条数据，然后当然路径得改了，follow us。平常uzid然后 rose行数是find应该是follow。

好，follow count的条件需要就变一下。首先传的是类型。 Entity tap user，然后其次传的是uzid这个和刚才正好是反的要注意，你要记得我们 Key是怎么拼的。好，然后就要查询了这个就是find follow us，follow service，点find follow us，所以说你看我们这个方法的定义，这俩单词比较接近的，所以说你在写的时候一定要搞清楚，不要弄混淆了，不然的话就很头疼，一定要搞清楚。

然后传递ID，传递俩条件，飞行条件没问题，然后要补数据，如果非空我就遍历，每次得到一个map，然后从map中得到 user，然后我判断一下当前用户对它是否已关注，这个逻辑还是一样的，最终把 user传给模板，然后返回这个模板的名字，这个叫follow。

Follower二点html就完了，好了，那么完成以后接下来我就开始要处理这个模板，首先我要打开这个页面叫profile点html打开这个页面，因为我们是点这儿访问的列表页面的对吧？

所以说你要在这个地方把这个链接加上去，所以我们先处理页面的链接，我就搜一下 profile，点cmi好这个人关注了多少个人，这里不是有一个链接吗？对吧？

链过去把链接得改一下，th冒号，hren好，我改一下这个路径，那么我们当前的路径路径中带一个变量，所以我写个双出现拼这个变量，然后是 follow with那么下级就是用户ID，你看用户不就这样取悠着点什么对吧？所以很容易悠着点，ID就可以了。好这个路径就处理好了。然后再第二个关注者就是粉丝，这也有一个路径也需要处理。好，这里边它也有一个变量，所以说也要选双竖线follows。

然后也是刚才的优点ID，好现在我就把链接配好了，配好以后那两个页面你要处理 follow vee，还有follower，不过这里面其实处理方式雷同，我们重点处理第一个，第二个就很简单了，搜一下 follow me，html，当然我们是首先第一次处理这个页面，你需要把他们的基本的内容配置好好，然后这个地方要改 hider要处理好，然后再看后面这得处理好。

接下来就处理中间的核心的内容。因为中间是个列表的话，它都是一个数据的示例，我可以把其他的li删掉，保留一个以此为模板进行遍历就可以了。

好，删掉多余的保留一个就行，我们从前往后去处理它，首先我们在一个选项的地方，这里有两个可点的页标签，就是这能链接能链过去互相能跳，这俩链接得处理好。好，第一个是链接链，到 follow上去我把它处理一下。

好，那么它的路径就是follow with，然后的话 uzid当然因为你有变量是吧？变量悠着点，ID咱们 control不是传过来一个uzid好再有 a里边你看它是某某某关注的人，这个地方你得显示用户的user name，它得是一个变量的显示对吧？在这里我写th冒号，txt等于然后的话uz等于uz内。

好，那么类似的第二个是练到 follow上去，好，那么它里面的内容这个人名也是需要做一样的处理。

好了，那么这个人名就处理完了，处理完以后这个地方还有一个叫返回个人主页，其实就是返回到 profile，这个链接也得改，因为这是个写死的精彩的链接。改一下，那么我要练到的是user，然后的话profile哪个user呢？User点ID这样。

好，那么关于选项的这个地方我就处理完了，处理完以后接下来就开始处理这个列表了，主要就是循环对 Li进行一个遍历，每次遍历我们从集合中得到的是一个map，所以变量名我就叫map。 Users。好，然后的话每次得到 Map我要显示的一些数据，首先你看这个地方当然这是用户头像先把它改了。好，那么map中首先有一个数据就是user对吧？Map的user然后点头像黑的URL就可以了。另外的话头像外面有个超链接能链到用户主页上去，这个链接我也处理一下。

好这个地方我要写成路径艾特，然后访问主页是要带ID，所以说写上双出线 User。

然后说。

fan不是发下级，是优质ID，是优质的ID，所以是map点优质点ID链过去。行了，然后再往下你看这个地方这地方写死成人名了，你得写成变量对吧？那就是MAC点user点user name。

好，然后再往下关注于什么时候，这是一个关注时间，我把它换个行，不然的话有点写不下一屏，关注时间改一下。好，那么关注的时间我们需要进行格式化， diss点format，那么这个时间也是卖不离去卖不掉。Follow time对吧？然后给一个时间的格式。好，然后再往下就是分页，分页的话我们可以复印首页的分页，这地方就很简单，一句话搞定好。

那么除此以外还别忘了一点，就是关注它这个地方的处理，它和主页上的关注它的处理方式其实是类似的。

那么主页上关注他，我们之前在处理的时候是哪去了？在这我们之前在处理的时候，一个是这个地方你要判断这个状态，显示是关注它，还是已关注对吧？

另外的话一个是显示关注他和已关注，另外的话你要判断如果说我访问的空间是我自己的，你还不能显示，再一个按钮颜色的变化是通过样式来切换的，也是根据你是否已关注切换样式的。

最后我们关注的时候需要获取一个uzid那么 Uzid我把它摆到了前面，用一个黑的来做处理，我们现在的处理方式和它是一样的。首先我回到刚才的页面，我把前面加上一个黑的，然后 Ittid value value应该是谁？是map的user，是你当时正在看的， User的ID这块要处理一下。好，然后 Button它上面的 class我先处理 class， th冒号plus等于这里边需要拼一个变量，前后加上一个出现，不要忘记。

然后中间我们主要是拼的是这个地方巴丁音符这个地方，那么就是map点 has followed。

好，那么如果是followed的状态，我就显示另外一个样式，否则显示这个样式。那么另外的样式叫什么？我就拷一下，记不住，或者其实你可以把这句话整个贴过来也行这样的。

好，那么除了样式以外，别忘了还有其他的内容要处理，那么你要判断一下它在满足条件时才显示，否则不显示。那么这条件我这样写，登录log in user，如果说log in user不等于闹，你只有登录了我才显示关注你才能关注别人对吧？如果你没登录关注的权利是没有的，并且log in优点点ID它不等于卖点优点，ID就登录用户，他不等于你当天看的用户如果等于的话，那就是一个人自己关注自己没有意义对吧？这是判断。

另外这个字也是需要根据状态去改的， Text等于那就是map点has followed。

好。

那么如果是已关注你就显示已关注，否则你要显示关注他，我copy一下。好了，到这儿我终于把 Follow这个页面给它搞定了。 Follow s其实和它一样，我就快速的把另外一个也写一下，follow第二天的这里我能copy我就copy省点事儿，这个地方他俩用的样式也是一样的，拷贝还得展开，不然的话会拷的内容会多，这一展开后发现有错了。

好high的，然后再往下我先把 li多余的删掉，再往下尾部不用处理，下面这两个样式也需要处理，直接copy得了，这两个GS不是样式。

好，最后处理正文的内容，首先是这个链接和它是一样的，但是你不要整个拷，因为它俩样式有所区别，链接地址是一样的，好，这里我也折个行 user怎么取？一样。

好，那么另外一个路径也是copy，好，那么内容的话，也是人名 copy。好了，copy完以后返回个人主页这个一样，好像基本都一样，但是你最好一个捋一遍，不然的话他万一有这个逻辑不一样的地方，容易容易搞混，所以说这个地方还是慎重一点。

好，接下来列表了，我先把分页拷过来。

好，然后的话其他的地方首先电力一样，好，然后再往里面看遍，历以后里边我们主要是显示用户头像，然后显示你要查看的每一个列表中的人的名字，关注时间，还有关注的状态确实都一样，我拷便利拷过来了，然后路径一样的，profile路径一样的，好，然后是user the head URL书写方式一样，然后人名一样的处理方式，关注时间换个行太长。

好，那么关注的按钮这个真是一模一样，直接我直接就把它都拷过来算了。好了，到这儿我终于把这个页面逻辑写完了，写完以后咱们得试一下，那么我把项目重启一下。好，启动以后咱们试一下。你注意我上课之前我对这个数据做了一些处理，就是我造了一些数据让他能够至少有两页，不然的话数据太少没法看对吧？

我提前照好了就跟大家说一下。

然后当前是以 AAA的身份默认已经登录了，那么这样我就看AAA的空间，就他看他自己的空间个人主页，你看我照的数据是当前的AAA关注了8个人，然后有另外7个人关注了他，我点进去看，你看AAA关注的人有这么多，因为当前的登录身份就是AA，他已经关注了这些人，所以状态是下一页没有问题，上一页没问题。

当然了比如说我随便点一个，比如说我不想关注这个人了，点一下刚才那是张飞点完以后，那么页面刷新了，那个人就看不到了，因为他就不存在到关注列表里看不到。Ok上一页下一页没有没有问题，然后但是你从这也可以切换，或者你返回个人主页，我看能不能返回。可以。

看这个关注者就是谁关注了AAA这个人有这么多7个人，其中 Ccaa也对他进行了关注，我再看上1页，然后我随便找一个人也关注他一下，比如说我就关注 ggg关注他没有问题对吧？好，然后这个地方能不能切换点一下，这是可以切换的，然后返回个人主页，你看他多关注了一个人，他关注的还是8还是7。好了，那么这次课我们就把关注列表和粉丝列表就给它完成了。好，这次课我们就演示到这里，咱们下次课再见。