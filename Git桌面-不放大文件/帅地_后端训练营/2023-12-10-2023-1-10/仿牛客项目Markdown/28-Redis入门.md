28-Redis入门.mp4

这节课我们来学习第四章的内容，这一章我们主要学readiness， reds它可以对我们应用程序当中的很多功能，提升它的性能，所以我们学完release以后可以利用它来开发我们应用当中对性能要求较高的功能。除此以外，我们学完以后还可以利用它重构一部分我们现有的功能，这样的话也能够提升这部分的功能的性能。

那么我们第一节来学习 ready入门相关的内容，主要是大家要了解什么是ready，然后他怎么去安装，然后呢安装以后基本的使用的方式，首先我们先对rice的概念做一个介绍， rice它是一款基于键值对的no circle数据库，然后它的值支持多种数据库数据结构，我们先看这句话，就是说先说 no circle，no circle，数据库是什么数据库？

它是指关系型数据库之外的数据库的统称，反正除了像my circle oracle这种关系型数据库以外的其他的数据库都统称为no circle数据库，这个no circle它是这样一种单词的缩写，叫 not only circle不只是circle。为什么？因为其他的类型的数据库它数据存储数据的方式有很多，它不只是靠circle去存储数据，有的是按照建制队的方式存，有的是按照列的方式来存，有的是按照文档，有的是按照图形，反正这个形式是各异的，那么reds它是按照兼职队的方式存储数据的，那么它来存数据的时候，兼职队它的t都是stream，而value的value这个值是支持多种数据结构的，然后它的值支持的数据结构主要有这么几种，当然还有其他的我们课程中主要是先来学习这么几种，分别是字符串希然后列表集合以及有序集合，那么这些比较常用的基本的值的类型，我们一会会给大家做演示，后面课程当中基本上大部分我们都会用到。

除此以外，那么 Risk它为什么能够以一个很高的性能的方式去存数据，是因为它把所有的数据都存放到内存里了，我们知道我们和内存打交道，我们向内存中存取数据的速度要远胜于硬盘，速度比较快，所以它速度惊人。那么但是我们一直把数据存在reds里，万一这个服务器关了对吧？这个数据不就没了吗？你也不用担心，在它把数据存到内存的同时，它还可以将内存中的数据然后的话以或者是快账或者是日志的形式也可以存在硬盘上，从而保证数据的安全性，这样的话它就性能和安全性都具备了。

那么快照的形式其实也叫rdb的形式，那么这种形式就是说它直接把当前内存中的数据，然后原原本本的直接存在硬盘上，那么这种形式的优点是它数据的体积小，反正你内存中有啥我就存在硬盘上什么。

然后如果说我们想从硬盘上恢复，数据到内存里速度很快，但是它的缺点是因为你是一下子把整个内存中的数据存进硬盘上，那么它在做这件事情的时候比较耗时，而且在做存储的时候它会产生阻塞，如果这个时候你还你还在处理其他的业务的时候，会对其他的业务有影响，会影响性能，所以说以快照的形式往硬盘上传数据不适合实时去做，它适合比如说几个小时做一次，做一个数据的备份比较合适，然后以日志的形式存数据到硬盘上，这个叫aof这种方式。

那么它是每次你每执行一个release命令，它就把这个命令存下来，它一致的方式把命令存下来，存一个命令，就一句话这个是非常快的，所以说它可以做到实时的存，但是它存这个命令是以不断的追加的形式存的，它比较体积比较大，比较占磁盘的空间。

另外的话如果你想从磁盘里硬盘里把数据恢复到内存里，它是把你存的那些个命令从头到尾再跑一遍，所以说它恢复的速度比较慢，但是好在它实时性好，这两种方式你不见得说我必须得用其中的某一种可以两者结合在一起用，是这样的。

那么rides它是一个非常好用的工具，一个是它性能非常好，第二个是它支持的数据类型非常的完善。

第三个它的使用上非常的简单，特别容易学，那么这么好用的工具它都适合做什么？这里我列举了它常用的使用场景，第一个它最适合做缓存，比如说有些数据我们访问的非常频繁，那么你存到硬盘上它不就慢对吧？我缓存到内存里，从内存中取就快，这种功能我们一律可以用release来搞定。

第二个是这个排行榜，比如说我们做一个热帖排行，那么排出来前10个或者是前30个热门的帖子，这个热门的帖子是访问非常频繁的，除了热门的帖子之外，其实访问量就比较少了。

既然他访问这么频繁，我们把热门的帖子那么进行一个缓存，你来访问的时候效率不就高了。

第三个是计数器，比如说模仿帖子，那么这个帖子的浏览量就要加一，你访问浏览量又加一，每个人访问他浏览量都要加一，这个操作是非常频繁的一个热门的帖子，很多人会去看，数以万计甚至几十万的人去看对吧？

所以说你去计数这个数据，如果存到硬盘上，那么这个性能又比较低了，而存到reds存到内存里，性能 Ok的，另外它也广泛地应用于社交网络的一些功能当中去，比如说你点踩关注你像这样的功能，那么访问是非常频繁的，比如说你发了一个热门的帖子，很多人会给你点赞，那么很多人会对这个帖子进行关注，对吧？我们把它这样的数据存到内存里，效率也高。

再一个你就是一个帖子点赞，其实就是一个数量。那么这样的数据你存到一张关系数据库的表里，其实它也不方便存，就存一个数据对吧？你还建一张表，其实也很麻烦，所以这种方式我们以建制队的方式存在内存里就非常方便。最后那么瑞丽斯还能可以用来做这个消息队列。

当然了 reds它不是专门做消息队列的工具，所以说我们在课程中不会去演示这个功能，但是就是说如果你的项目对这个消息队列要求的不是特别高，readiness通常也能够满足你的需求，如果你要求特别高的话，你可以用更专业的消息队列的服务器，我们后面讲的卡夫卡就是这方面的佼佼者。

好了，那么我们大概对 readiness做了一个大致的介绍，下面我们看一下它的官网，它的官网是ready点？Io。好，我打开一下官网看一下，有点慢，大家稍等一下，打开以后，那么如果你要看他的手册，你点 documentation这里边它针对一些功能或者是某些方面做了一些归类，这里可以去看。

但是其实 ready是非常简单，你不看这些内容也可以，ready是我们学主要学什么，其实就是学他那几种数据类型，你只要会用那几种数据类型，你会往 reads里存这些类型的数据就ok了。

而你操作这个readiness去存各种类型的数据，其实就是用各种命令，所以说其实你去学会它的命令基本上就会了。

那么与命令有关的手册，你可以看这个地方 come on，好我点一下，然后这里边他给你做了分类，这里默认是所有的你可以看，比如说string相关的命令，我这个情况有点慢，大家稍等太慢了，我就跟你大概说一下，你点死菌这里面会做一个过滤，过滤出只有死菌相关的命令，然后以此类推，这个是集合，这个是有序集合，这个是列表，这个是就这几个比较常用，其他的我们后面也会涉及，但现在我们先不管，总之命令是非常多的，那么我在课上不会说把每一个命令给你演示一遍，太阳啰嗦了，那么大家就是我课上给你演示一些基本的最常见的最常用的，那么课后或者是你以后的工作当中，你可以多去查一查手册，看一看它还有什么功能，这个是你要自己去查的。

好，然后我们要安装 radius，那么当然在官网上你可以去下载你点登录的，可以下载，但是下载的话是这个地方是正式版，你点但是下载的是踏点gz这样的，包这个文件是针对Linux系统的，而reds官网它没有提供针对windows的这个安装包，不过好在什么 readus，它是非常流行的一个工具，那么引起了微软的重视，他一看既然你自己不提供安装包，我给你做一个，所以微软它给 rise做了一个windows系统下的安装包，那么下载的路径是在这 get up，那么我已经把这个网址打开了，打开以后我们往下看在下面有它的一些介绍，我们可以点 release配置，点开以后这里边他列举了各个版本，那么最上面的这个是最新的版本，3.2.100，然后你可以点一下3.2.100，下面有一个这个列表，列举了他所有的版本，所有的安装包，然后一个是MSI就是安装程序，一个是GIP就是解压缩压缩包，这两个是源码包我们不需要，而这两者我选择的是安装程序选的是它，然后我已经提前下载好了，大家看一下就这个文件。

好，下面我就把工具给大家安装一下，很简单了，基本上就是一路默认就可以下一步勾选同意，然后下一步这里边你可以改变一个它存放的位置，改一下我把它放到d盘work目录下，然后在work目录下我想新建一个文件夹叫readiness。

好就放到 d盘work reads目录下，然后下一步你注意这个是它的端口，当然你这里可以改，但是我们没有必要改就默认就可以了。然后下一步安装很快就安装好了，这是一个非常就是简约小巧的工具，安装完以后，那么我打开第一盘work看一下，这不有rise对吧？

就这然后它这个目录也很简洁，你看里边的话它连一个文件夹都没有，就是一堆文件，其中这个是配置文件，然后其他的有一些你像 Reds杠cla是它的客户端文件，当然我们访问它的话通常会通过命令行的方式来访问，那么为了能够容易直接访问这样的工具，我们最好是把安装路径配到环境变量里，这样的话我们民航就能够直接访到这些工具了，我配一下高级系统设置环境变量，然后 pass，新建一项粘过来，这就可以了。

好，配完以后，那么我来访问一下， come on，打开命令行，然后的话我现在要启用的是rise的客户端，好访问这个readiness，然后你readiness安装完以后，它服务就自动启动了，我们通过客户端来访问它， radius杠CRA你看输出这句话表示我已经连上了。

127.0.0.1本地端口是6379，然后 rides这里我给大家演示它的一些常用命令，你把基本的使用方式会用了就行了。

那么reds这个数据库它默认了，其实内置了16个库，这16个库它没有名字，它是用索引来区分，所以分别是0~15，那么默认它选中第零个你可以切换，比如说select一，这就切换到第一个库， select二切换到第二个库，我再select0切换回第零个库，我就在这里就给大家做一个就是示例做一个演示。

然后比如说如果你演示过以后，库里有一些演示的数据，你将来不想要了，你可以刷新一下，把它刷没了，你可以flash DB刷新库，刷完以后库里就啥都没有了，当然我现在也什么都没有，因为我还没有往里加东西。

好，接下来我给大家演示一下刚才我们 PPT上所列举的内容，5种值的类型，我们都怎么去用？

我先演示的是死菌类型，我怎么往库里增加这个值为死菌类型的数据，怎么把它取到，怎么对它做操作，给它演示一下，非常简单，我们要往库里添加死菌类型的数据，就直接site后面它这一串文字是一个提示，这是一个提示，他意思是你接下来你要设置的是key，因为它是py6结构，你得先声明这个k那么这个k你像我们这个关系型数据库，如果是我们 key或者说我们表有两个单词构成，我们会中间加一个下划线对吧？

而这个rise它提倡这样的一个规则，如果你有两个单词中间相连的话，用冒号好，比如说我 key要取个名字，我要叫 test count，数量你就这样写test冒号count，这是一个key。

然后指定它的value，比如说value是一，后面其实还可以指定他超时的时间，这里我就不写了，后面带方括号的表示可以省略回车， ok表示这个数据我就已经存好了，我已经 key和 value一对对key value存到了 radios里，那么其中的 value它是以字符串的形式来存的，怎么取到存是site取那是get，get后面写上 t你看取到的是一字符串，然后它还支持对这个值进行一些计算，比如说我要让这个值加一，比如说我存的是一个浏览量，我让他加一怎么办？

也很简单，incr就是inc增加的一个单词的缩写 t我让 t对应的值加一，加完以后变成二减一就是decr decadent减法的缩写，好减完以后变成一。简单，这就是死菌类型的数据的使用方式。

好，下面我们再来看一下希我要存希类型的数据是这样的，这命令以h开头， h set存数据 key比如说我要叫test user，我要存user，而这个值它不是一个值，因为它是希这个值也是p value， feel the value好。

 User比如说我有ID，它的值是一，我就这样写，存好了，然后我再存一个h site，test，user还是往 key里存数据， user还有另外的一个属性，user name张三也好了，存完以后我怎么取其实很容易取。

H get就是取然后写上 key test，user，而这个k我们得到的是一个希，你到底要希中的哪个值，你再把哈希的k再写上去，比如说我要取ID，ID是一，接下来 h get test user。

然后比如说我要取user name张三，就是这样一种形式。

好，再来下面我们再演示一下 list就是列表，那么 ready是他对列表的设计比较灵活，这么说它的列表是一个它这个列表是一个横向，你可以把它看成一个横向的容器，那么我们往这个容器里存数据，支持从左边往里装，也支持从右边往里装，取的时候支持从左边取，也支持从右边取。

那么如果说你是左进右出的话，那其实就是队列，如果你是左进左出的话，那就是干。

所以说你用这个列表可以做出做出队列和战法这样的功能。

举个例子，比如说我要往类似的存数据，按照左进右出的方式来存，比如说我存的是ID分别是101102103，我先存的是101左近的101，存进去了，然后再存102，你注意是左进你就要在左边加上102，然后103左进103是这样，所以最终出版的是这样一个对于列表里的第零个位置就是103，第一个位置是102，第二个位置是101，如果你又出的话，首先出的是101，然后是102103是这样，你可以把它想象成一个横向的容器这样。

好，具体怎么去操作给大家演示一下，我就按照刚才我所说的左进右出，首先我从左侧往里存数据，是ll表示list toss左侧近，然后 key test我要存的是比如是ID，我叫ID，然后101其实你也可以直接把另外的多个这里可以写多个值，我就直接102103那意思是我要分别存101102103，那顺序和刚才我说举的这个例子就是这样的，它是先101在102在103注意好，然后回车出来，三个数据进去，出完以后我们可以看一下 llen那是看列表里边的长度，我看它有多少个数据？

三个。然后再看l index，就是我要看某一个索引所对应的值。下面你把 key写好，test爱丽丝比如说我要看索引为0的值103对吧？1030，好，再来。 L index test ideas。比如说2101最后一个，好，那么还有我还可以说我不只是看某一个位置的值，我想看某某一批位置的值，或者说从索引几到几的范围内的值也可以。

L range rang然后 Test爱丽丝，比如说我从0开始到2，一共就三个就0~2，你看分别就是103102，101很直观了。

好，然后我还可以让他从右侧出兑，就是弹出一个一个值，你就rr表示right， l表示left，刚才我说错了，不是表示list left，这个r表示right，r然后 test ads表示从右侧出一个值，它弹出的是101，他们的右侧对吧？好，再来 are pop test。爱丽丝102。以此类推。

好，这是列表，然后我们再看集合 site，那么集合的特点就是列表是有序的，有序的，然后集合是无序的，而且集合中的内容值是不能重复的，这是集合的一个就是要素。

我们怎么往集合里存数据很容易是这样si s代表的是site添加，你还要写一个key，比如说我要存的是老师，我写test，teachers，然后你可以后面写多个老师的名字，我就随便写 aaabbbccc dddeee写5个，回车我就往集合里加入了5条数据，然后我可以通过这样一个命令 s card test，teachers这句话可以是统计这个集合中有多少个元素，5个没有问题，然后我还可以通过这样的1个命令， s这句话的意思是从集合中随机的弹出一个元素test，teachers回车，你看它弹出的是CCC，s pop test。

Teachers这会弹出的是意义。

好，那么有时候这样这有什么用有用这个的话，我们可以利用这样的命令去实现抽奖对吧？那么你把这个人名或者是人的编号存到 site里，然后它不能重复，又是无序的，就相当于我们一个抽奖箱一样对吧？然后你每次弹出随机的一个用户，他就中奖了，非常简单。好，然后还有一个命令是s numbers，这句话是查看集合中还有多少个元素，你看弹出两个之外还剩三个没有问题。

然后最后一个要演示的类型是sorted set有序的集合。

刚才这个集合是无序的，如果说我希望集合有序，你可以用有序集合，有序集合其实它是这样的，它是跟每一个存的值就是附加了一个分数，然后他按照这个分数去排序，它提供了一个能够按分数排序的这么一个功能，那么有序集合，我们是这样操作，以z开头爱的添加，然后比如说我要添加学生test16.4。

好，然后你后面要写什么呢？后面你要写这个省可以省略的我就不写了，你要写分数，然后以及和对应的值，然后可以写多个，比如说我就写了10，分数是10AAA20BBB，30CCC，40DD，五十一一就随便写了5个人，然后他们的分数分别是abcde回车加完了，加完以后其实有序集合的命令和集合有点相似，我可以通过z card来统计一下它里边有多少个数据？

5个，然后我可以这样z是杠，是查询就是某一个值它的分数是多少？Strong的分数你要写上key test，16.4，然后写上一个值，比如说我要查 CCC的分数，CCC30没问题。好，然后再来我可以这样， z rank， z rank是返回某一个值的排名，它排第几默认是由小到大的 test students，比如说还是CCC它排第二名，你看这个排名其实要求达到就是这样一个顺序，从左到右对吧？012没问题。好，再来还有一个g range范围，取某一个范围内的数据test，students，比如说我写02，意思它是按照由小到大排序，然后取0到第二个值那是谁？

 Abc A是0，b是1，c是2，就这样。好了，你看总之 rise它的命令很简单，反正我们利用这么几条命令就可以操作不同类型的数据，只不过你可能一开始接触命令，因为有点好几套，你记不住那多写一写就记住了，然后多去查一查手册，还有额外的其他的命令，我没有演示到的，你也自己去看一看，自己试一试。

好，那么除了这些命令以外，我们再说一套命令是全局的命令，是对所有的数据都有效的命令。首先你要知道 Key星意思是查一下我当天的库里一共有多少个key，星代表一切，所有的key都列出来了，所以它针对所有的类型都有效，这个也比较常用，然后你也可以这样kiss，比如说test星，意思是我要看一下我库里test开头的key有多少个，其实我们都是以test开头的，就查到了。

总之 case命令主要是查看库里的 key相关的内容的。

好，接下来还有一个命令叫tat，是看某一个t它的值的类型，比如说我看一下test，冒号user看一下 key它的指的类型是什么希。没错，还有一个exist是看一下某个key是否存在，比如说我看一下 test，user存不存在一表存在，好，这样我把它删了，删的话是给deldel指定一个k把这个k删掉，删掉以后它的值就没了，我把 test用这删掉，删掉以后我再判断 exists test。

User要表示00表示force没有了。

好，那么最后还有一个命令比较常用，是我们可以设置某一个key，它的过期时间，它到了这个时间自动销毁就删除了，比如说我们登录功能打开登录页面，它不是有一个验证码，验证码你存到库里，其实过一分钟删掉就可以了。

那东西不用存很久，所以说像这样的需求就可以用到这个功能。

我给你演示一下，xkr过期，然后你指定一个k我指定的是16.4，然后指定秒多少秒过期有10秒。好，写完以后kiss星，你看目前19等值，还有我再来kiss星，还有好我多等一会儿，等他超过10秒，应该差不多我再执行一遍，你看就没了，只要超过10秒，它就自动的把这个数据删掉了，好了。

那么以上是我们 rise入门相关的内容，你理解rise是个什么东西，另外了解它的每一种数据类型，然后我们怎么去做基本的操作。当然课后你要把 reds安装好，自己多试一试，把这些命令用熟了。好了，那么这节课我们就演示到这里，咱们下次跟他再见。