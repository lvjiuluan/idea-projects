11-开发注册功能.mp4

这次课咱们来开发注册功能，那么注册功能还挺复杂的，像这种相对复杂一点的功能，我们开发的时候要额外的注意，复杂的功能，我们想办法把它拆解，然后拆解成若干部分，使得每一部分都相对简单一点，那么就好开发了。

那么对于一个外部项目来说，我们每一个功能其实可以把它按照请求去拆解，因为每一个功能它都是由若干个浏览器和服务器之间的请求交互所构成的，这个是很容易分析的，你像注册功能，你怎么去访问怎么去使用，你很容易能想到，那么首先我在首页上点注册的链接，就能打开这个页面，这个很显然访问服务器就有一次请求，只不过只是打开页面而已，这次请求会比较简单一点。

第二个我需要填写数据在表单里，然后点注册这个数据就会提交给了服务器，服务器去把它存下来对吧？但是显然是第二次请求。

然后服务器保存了这个账号以后，它会给你发一个邮件，然后让你去激活一下，这个时候你收到邮件以后可以点邮件中的链接，其实一点链接也是访问了我们的服务器，然后进行了激活的服务，这是第三个请求，所以很容易分析出来我们这个功能由三次请求所构成，那么我们一次请求一次请求去把它搞定，就相对来说就容易了。

而每一次请求我们还是按照之前的思路，我们先开发数据访问层，然后开发业务层，然后开发视图层三层架构对吧？但是你注意有些功能它可能没有数据访问层，有些功能可能没有业务层可能会有一定的缺失，你比如说首先第一个我们访问注册页面只是打开页面而已，这个就没有什么业务，也没有什么访问数据库，好，我们先把第一个环节搞定，好，我打开开发工具，那么对于这个视图层，首先我们得有controller对吧？

我们请求提交给controller controller，然后当然这里这个业务比较简单，没什么处理，他直接去调用模板，然后有模板给浏览器做出响应就可以了。

那么这个模块登录模块我单独的给它创建一个新的controller，在这里，这个CTRL就叫log in CTRL，那么创建好以后，我们需要在这个类上声明啃出了注解，当然通常我们会加上瑞克斯麦克这个类我就不加了，不加以后我就直接访问的是方法。

好，接下来我就在这里增加一个方法处理访问注册页面的请求，他被返回死病。

然后这个方法名我叫get register配置就是获取注册的页面，那么返回的是模板的路径，我们之前已经把所有的页面都引入进来了，注册页面是很好找的，它在 site目录下，所以我return的是site，然后 right，当然写完以后前面别忘了给它说明访问路径， pass等于radius，然后 master请求方式就是get好，这样就可以了。

那么当然了这个是模板，我们还需要对模板进行一些设置，加上他们那些个标签相关的内容。

好，我就打开 register把它放大一点，然后首先加上 timeline的声明，你可以拷贝，我懒得切换，界面我就直接写了。好，然后我们页面之上所要依赖的样式文件， js图片，那么它的路径我们需要通过time leave的方式去管理起来。那么这种绝对路径你不用管，主要是这种相对路径我们需要进行一个处理。

我就写上thhief然后艾特括号这俩点就不要了，然后 css global点css这个也是好，然后我们页面的结尾之处还有 js，我们也需要做类似的处理，总之开发页面是一个比较繁琐的事，因为页面的代码看起来会比较长比较乱，我们需要挑着去改，很容易会遗漏一部分，所以说你在处理页面的时候需要比较富有耐心了。

好了，那么这个页面的这些个路径静态资源的路径我就处理好了，处理好以后，那么我们访问注册页面是通过点击顶部的注册的超链接点过来的。首先我们整个项目首先我们访问的是首页对吧？所以通常都是通过首页去点过来，接下来我把首页的顶部的注册的链接给它写好，练过来。

好，那么我打开首页的模板，找到 hide的区域，在这儿这里面我不只是要把注册改了，把首页也得改，对吧？因为首页当然练的就是他自己这个也要改一下，不然的话你一点就会有问题，这个是不对的，这里我写一下th冒号hief然后后面就不是html了，我们首页的路径是index对吧？Index接下来再把注册的路径来处理一下。

那么注册的访问路径就是 register，然后其他的功能我们还没做，那么其他的路径我们就先不去写了，先这样了。另外你注意咱们这个项目中其实每一个页面头部黑的区域都是一样的，对吧？如果你每个页面都把这些个链接都这么处理一下，会非常的麻烦，所以最好的方式是能够让这段代码能够在多个页面复用，那么他们内部也是支持的，而且很容易。

那么如果想复用的话，首先我需要在还得这个标签上写上一个属性叫thfrig问题。

等于说白了其实就是给这段代码取的名字，你好通过名字去复用它，我给它取个名字就叫就叫黑的。好，那么这儿我取了名字给这段片段，我register想复用那段程序怎么写呢？

咱们来写一下，我首先找到 hide的区域，那么这里我也需要写上 Timeless的属性 th冒号，我们要写replace，那意思是我要用这项内容替换当前的标签的内容，我要把它替换掉，用谁来替换 index？ Index就是 Index，模板他并不知道他的位置，然后冒号两个冒号后面写上还得刚才我们给代码评论取的名字，你这样写就可以了。

好，那么写完以后咱们可以进行一个测试，我就启动一下这个项目。好，以后我们启动项目都是用 debug模式，那么出了问题咱们好打断点，随时去调试。好启动完了以后我打开浏览器， local house80 80index，访问以后主要是看一下这个链接对不对？你可以把首页悬停到首页之上看左下角这个位置，你看的链接是对的，放到注册上看左下角的位置也是对的，咱们点一下。

没问题点注册，没问题，这点首页就可以了好了。

那么开发注册功能第一步访问注册页面我们就处理好了，这里是主要的要演示的内容就是 Timeless，我们怎么利用它把一段标签一段什么标签的内容复用，这里就演示到了。

好，接下来咱们就可以开发第二个请求了，要提交注册的数据，在开发请求之初，我想先再导一个包，那么我们在这个功能里以及我们后面的功能里会经常的用到这个包，主要是给我们提供一些这个判断字符串，还有一些比如说集合等等这些常用的数据，它的一些空值的情况我们经常会用到。

好，那么这个包我们去搜一下，那么我打开 memory post库，然后包的名字叫comments long，comments long回车好。

然后第一个使用的最多的就是康姆斯朗三，我就点进去，它是阿帕奇推出的，然后我们选一个最高的版本，3.9就行了，这里我把美本配置拷过来，然后我再回到我的程序里，这样我把这个代码先关掉，然后我打开 pome的xml把它拷进来，然后稍等一下，好这个包已经下载好了，导进来了，这是第一步。

然后第二步我还要做一点配置，我要在 application在practice里把我们这个网站的域名配置好，当然我们现在没有域名，就是配的一个本机的 IP地址，因为我们在注册的过程中要发邮件里得带激活链接，这个链接链到哪去得？链到我们的网站，所以你得有一个链接对吧？因为这个链接是在开发阶段，在测试阶段，在上线的时候它是不一样的，所以说你需要把它做成可配的。

好，下面我打开配置文件， application practice，那么我就追加了这个内容，其实是我们自定义的内容，要给它这个配置我给它取个名字叫community，然后 t也是我们自己取的， k我叫k没有那天点pass路径什么路径都没域名，当然我们现在也没有申请正式的域名，就是写我们本机的地址， local host端口是80 80这样就行了。

第二步我们准备工作也做好了，然后第三步还需要做一点额外的准备，我们需要再写一个工具类，然后在工具类里头我们去提供两个方法，然后我们后面注册的时候好用，不然的话我们献血有点麻烦。

好，那么我就在 YouTube的包下再新建一个工具类，这个工具类我叫挺牛的挺you tell，然后这里头我就提供静态的方法，都是很简单的方法，然后我们直接调就完了。这个工具我就不由容器托管了。

第一个我要加的方法是它生成一个随机字符串，我们一会生成激活码，每次是一个随机字符串，再一个将来我们可能还就一定会做上传头像的功能，或者是提供一些上传文件的功能。那么每次上传的时候，我们需要给这个文件生成一个随机的名字，那也是一个随机字符串。所以我们在这个以后的开发里经常需要生成随机字符串，所以这里把它提前封装好比较方便。

我写一个注释，这是生成随机的字符串，它是一个公有的静态的方法，返回的是死病，那方法名我叫generate uuid因为我们生成随机字符串，它其实用到了一个工具，就是uuid工具，其实这个工具可以直接生成，但是我们需要对它稍微封装一下就可以，我就直接return uuid Java里自带的工具，然后 render uuid它会生成一个uuid对象，然后点two string我们就得到了一个随机字符串，这个字符串它中间有字母以及横线所构成，通常我们不想要横线，我们只想要字母和数字就够了。所以我就这样写，就是点 replace are替换掉所有的横线，把它替换为空的股票，这个逻辑就完了。

除此以外，我们再封装一个方法，是叫做MD5加密，我们采用 MD5算法的方式对这个密码进行加密，因为咱们注册的时候你提交的密码其实是明文，那么我们存的时候要把它加密，不然的话密码是容易被泄露出去的，或者容易被盗的。

那么 MD5算法加密它有两个特点，第一个特点就是说它只能加密，它不能解密。

比如说假设举个例子，我有一个字符串密码，hello，假设它加密成的结果是这样的，ABC123、def456，那么这个算法只能把这个字符串加密成这样的一个值，而且你每次加密它都是这个值，但是不能解密，那么看起来好像说我们得到这样一个加密的结果，好像是很安全的，其实还不够，为什么？

因为如果说你的密码真的像这个单词一样hello或者是一个生日一样，非常的简单，那么因为它每次加密的结果都是这个值，所以说想盗取你密码的人，那些黑客其实这个值他也知道，因为他自己有一个简单密码的库， hello生日都包含在内，他也会利用这个算法把这些简单的密码加密成这样的值，所以说其实你密码简单加密，结果其实人家手里也拥有着也是容易被破解的，因此我们一般是这样处理的，你看 user表里不是有一个字段叫salt，盐我们不管你是什么密码是简单也好还是复杂也好，我们都给你加上一个随机的字符串，没有规律的，比如说加上一个3 e4 a然后这样的hello加上随机字符串以后，那么加密的结果假设是这样的，那么因为加上一个随机字符串以后，这个单词其实就没有规律了，那么黑客的他库里其实没有这样的单词，所以说他就相当于他库里就没有这样的密码，他就盗不了你的密码，这是其一。

其二如果说他想硬性的去破解密码，因为后面字符串是随机的，它破解的难度是非常大的，而且随着这个字符串的越来越长，你10位20位越来越长的话，那么它破解的难度是呈几何级增长的。甚至如果说你在这个字符串里还加上了中文的话，那就更难破解了。

所以说我们这样去处理，就在密码的后面加上一个随机字符串再去加密，是为了让安全性更提高一些，是这样的。

好了，那么这个方法我这样去封装还是公有的，然后静态的它返回加密的结果是一个死菌，然后这个方法名我直观一点就叫MD5，然后要求你传入一个key， Key其实就是这样一个结果，就是一个你原始的密码，我们给它拼上一个言拼成一个随机字符串传进来，然后我对这个字符串进行一个加密。

那么其实加密 spring它有一个自带一个工具就一句话就搞定了，就实现了这个算法。

当然我们首先最好对这个参数做一个判断，因为如果你这个参数为空，我就不去加密了，也没有什么意义，我就直接返回空了。好，那么判空的话，我们就可以用这样一个工具叫stream YouTube。

我们选这个你看阿帕奇commerce浪三其实就是刚才我们导的包里所带的工具非常的好用，然后你可以判断is block key，那么他会判定你这个k如果是now他认为是空的，如果是空串也认为是空的，如果只是一个空格，他也认为是空的，所以非常方便。

好，如果说你传的是空值，我就返回闹，我就不去处理，否则我就去调用spring的工具，它叫 digs digest dig it。Youtube，YouTube这是spring自带的一个工具，然后点MD五，然后是得给as x就是说他把你传输的结果加密成一个16进制的字符串返回，但是它要求参数传入的是带，但我们这个参数是string。没关系，我们转换一下，就key一点get back就可以了。

好了，总之工具的封装非常的容易，那么主要是你要了解，那么这个MD5它加密背后它的逻辑是怎么样的，为什么我们去在设计优则表的时候，那么有 sat字段为什么要这样处理？主要是为了提高安全性就可以了。

好，那么有了工具以后，接下来我们就可以这些包配置工具都准备好以后，我们这回终于可以去开发我们注册的业务了。我就打开 User service，我们之前写过这个工具，因为注册是针对用户表的操作，所以我们可以把逻辑写到类当中去，打开 user service。

然后那么我们在注册的过程中，因为要发邮件，所以说你得把这个邮件的客户端注入进来，对不对？你还得把这个模板引擎注入进来对吧？我们先把注入进来，首先我注入这个邮件客户端没有class，然后再注入进来这个模板引擎他们的安检。

另外发邮件的时候要生成一个激活码中要包含域名，还得包含我们的项目名，所以我们要把配置文件中的域名和项目名都注入进来，那么域名刚才我们配的key对吧，community pass都没有，而这个项目名这很早以前我们就配了 Sova点spotlight点，context parce，把它们注入进来，当然这个是注入一个固定的值，是不是？

一个b所以你需要用到 value注解要换个注解。

然后这里面写到了括号，表示说我用表达式的方式取 t的值，这里我写community，这字符串不要写错了，因为字符串它是不会检查你是否正确的。这里我说明一个变量来接收这个值。杜妹好。再来一个我可以copy，第二个是项目名，咱们通常习惯于叫context pass就应用的路径，然后这个是刚才我们看了是 Server点 context，god pass，ok，就是这样。

好了，那么终于我把注入进来的，内容都注入好了，下面我们就开始编写注册的业务，我就写一个共有的方法，便于别人复用， public这个方法需要返回一定的结果，这个结果就是要其实你返回什么都行，比如说你返回一个整数代表不同的状态可以你返回一个集合，包含了很多信息可以，你返回一个自定义的类都可以。

实际上我们返回的内容中包含什么？主要是包含比如说你这个账号是空的，不能为空，密码不能为空，邮箱不能为空，账号已存在等等这样的错误信息，它包含的信息不是一种情况，是多种情况，所以最好我们声明反馈是能够封装多多个内容，这样我就写一个MAC，我把返回的结果通知到map，词句ok，然后注册这个方法名我叫 resist，注册的时候你需要把用户的信息传给我，包括账号、密码、邮箱这样的内容，所以说我要求你转入一个，因为这对象给我，我来帮你解决这个问题，最终我暂时先写维特纳，然后一会我们再具体的去实现。

好了，这个注册方法这个结构就定下来了，定下来以后接下来我们就开始编写它内部的逻辑，这样我首先先把 Map给它实例化好，对六希map，然后最终的话我觉得返回 map先把这个结构写好，省得一会忘了。然后我们这个逻辑的一开始应该是对这个参数进行判断，因为万一你传的参数不对，你账号密码都没有输入，对吧？

所以先对这个值进行一个判断，那么这些注释首先我们是对空值做一些判断的处理，我就写空值处理。那么如果优点是闹我就直接抛异常了，这是绝对不允许的，你要是闹我就没法处理你。阿根问题exception，非法的参数我就写参数，不能为空给一个提示就完了。

好，那么如果说user不等于我们继续再判断user里边的内容，可能对象不为那，但是里面的属性有问题，所以再判断，那么如果说user我用的工具是病，are you tells点is block？

先判断user点get u在内，这是一个很关键的信息账号，那么如果这个账号是空的，我要这回要给这个不报错，因为账号是空的，是一个他业务上的一个怎么说一个漏洞，但它不是说程序的错误，因此我们要把这个信息封存到map里，返回给客户端，告诉他说你这样做是不对的，而不是抛个异常。

好，所以我就往map里装一个提示信息，这是提示你账号不对，我这个提示信息的名字叫using name。Message提示的内容就是账号不能为空，好，完了然后我就不往下走了，直接就返回就行了。

好，那么同理你账号可能为空，密码也可能为空，所以你再把按照这样的方式再把密码也给他判断一下。这个是user点get它是word，然后如果密码为空，那么我们要返回一个密码相关的提示，我就叫password，message，密码不能为空，然后如果是这种情况就回退了，还有那么我们注册的时候还要输入邮箱，邮箱也可能为空，所以也是做出类似的判断。

点get EMAIL，那么这种情况我就提示你的是EMAIL message，然后这里面写的是邮箱不能为空，逻辑都一样，所以说你拷贝复制粘贴很容易，那么如果上述的关键的数据都不为空，我表示说我可以开始去做注册的处理了，要处理的时候不是上来就去注册，而是你要验证一下你传的账号是不是已存在，对吧？

你的邮箱是不是已经被注册，所以你要做这样一个业务逻辑的判断。好，我先判断这个账号，我验证账号，验证账号就是说你把它传入的又在内，去库里查一下，看他有没有对吧？我就调用user map，然后点select by name。我条件就是传入的user点get user name。

好，那么我会得到一个user， user的名字就叫简单就叫u和参数做一个区分，这是页面传进来的，这是我查到的数据库里真实存在的数据，当然如果你账号不对的话，就账号这个怎么说是不存在的话，查到的结果就是闹，对吧？如果存在这个结果就不是闹，所以很容易就能得到一个判断的结论，如果u它不等于闹，那就意味着我查到了意味着这账号存在了，那就不对了，我就给他一个提示放到map里，这个还是账号的问题，所以我的返回的 k依然是user，那么这个提示的消息就是该账号已存在，此时我就return map不往下走了。

好，这是账号的验证，同理邮箱的验证也是类似的，就是验证邮箱，因为这个逻辑比较长，所以我把每一步的注释写的清楚一点，验证邮箱的话就是通过邮箱去查一下用户看存不存在对吧？我还是复用 U变量名 user map点select EMAIL，然后 user点get EMAIL，好，然后判断他是不是等于如果说它不等于就比方说这账号邮箱是存在的，我还是做类似的处理好。

这个地方一没有message表示该邮箱已被注册你得换一个，或者是你要找回密码。

好，那么经过这两步以后，账号密码邮箱都不为空，然后账号邮箱它也不存在，就说明这个信息没有问题，这个时候我就可以注册用户了，那么所谓的注册用户就是把用户的信息存到库里，我就写个注册用户，然后我在保存之前还得对密码加密码，对吧？而密码加密是他输入的密码，你要加上一个salt，然后再加密对吧？所以你还得先生成随机的salt随机字符串。

好，所以我们需要对user里边的数有些数据做一个补充，悠着点set给他一个随机的字符串儿， community YouTube咱们刚写的工具类点，MD5。抱歉写错了，是生成随机字符串， get点generate uuuid然后这个字符串非常的长，我们不用那么长，我们用5位8位就比较短就可以了，这里我就来5位，我就在萨德斯郡一下，然后的话从0~5一共有5位。

好，那么有了so了以后，我们再对密码进行一个加密，然后再设置到u的对象里，对他原来的没有加密的密码进行一个覆盖。Site、password，然后这里边需要加密码，那就community、YouTube点MD5点m第五，然后传入的参数应该是它原来的密码，没有加密之前的密码点get pass word，然后加上sort user的get sort。好了，那么经过加密以后得到一个值再覆盖这个password就行了。

然后我们再把其他的字段也进行一个设置，因为它传进来的只是邮箱，账号密码，其他的字段也需要我们再重新设置一下悠着点site，tap类型注册的用户默认都是普通用户 user点set status状态默认都是0表示没有激活，然后你需要激活，我需要给你发送激活码，所以悠着点set ak vision扣的激活码，这个激活码就是一个随机字符串，还是用这个工具点generate就不错了。

Janet uuid就行了，那么激活码可以长一点，没关系，我就不截取了。

好，那么用户注册的时候，我们在给他一个随机的头像，因为他注册的时候不要去上传头像，我们给他一个随机的系统自带的，然后的话他可将来注册，成功以后登录以后可以去自己再改一改。

那么牛客网有好像是1001个随机的头像是路径是给你看一下是 image点not q点.com，然后是head，然后下面是一个比如说一t一t点瓶颈，这是一个随机头像，然后只要你改序号一就行了，改成23一直到1000，好像0也可以。

从零开始到1000，一共1001个随机图片，所以我们随的就是这个数字，然后把它拷进来，所以我需要给它设置一个随机的头像set，hide URL，这个因为那个数字是随机的，这个路径当中包含一个数字，我用死菌的放卖的方法，然后把这个字符串写进来，这个地方就不能写死为0了。

应该写一个占位符百分号d比方说这个地方是一个数字，然后这个方面的方法我可以给它再加一个参数，那么它会用这个参数来替代占位符好，这应该是一个随机的整数，我就这样写 new render账号自带的一个工具，然后点next int随机整数，那么这个整数的范围我希望它在1000之内。

好，就这样，那么头像的路径也随出来了，最后再给 user设置一个创建的时间，或者说他注册的时间就是当前的时间， ok。

到这我终于把优质对象里边的数据补全了以后，那么我们调之前我们写过的 insert优质方法，去把它添加到库里就可以了。

好这一步就完成了，完成以后别忘了我们还做一件事儿，你要给这个用户发一个激活邮件，那么发送激活邮件，我们当然发的是html邮件，你们好带这个链接，首先得考虑那模板是谁，模板需要什么参数对不对？

其实这个模板我们之前在拷贝静态页面的时候已经拷进来了，它就在 mail的目录下看名字就知道了，Activision的xml。

好，那么我把它打开，咱们先设置一下，因为目前的话还是只是一个静态的html你需要把它改造成模板，这里首先我要写上xmns thhttp三w timeless表。Rg好，先指定先声明它是一个time leave的模板，然后这个链接绝对路径不用改，这就不用动了。那么看里面它的格式，他说叉叉叉.com，这是邮箱，你好，显然这个是我写的一个例子对吧？

你需要把它替换掉，因为刚才都是把它替换掉，所以这里我们需要写th text等于一个变量，假设我要求这个变量叫EMAIL来替换这个值，一会你要把 Email传给我这个模板。

其次这里边有一个正文说您正在注册牛客网，这是一封机会邮件请点击，然后这个链接，然后注册激活您的账号，那么很显然这个链接你得动态的传进来，不能写成井号，要不然他不能点，对吧？

所以这个地方还得改成动态的值， th冒号hef等于那么URL就路径传进来一个路径，请点击，这是一个事例，就是这样一个路径。

其实你也可以这样就把这个路径去掉，写成此链接，那么我们这页面上会看到这样一句话是吧？

您正在注册牛客网，这是一封寄货邮件，请点击此链接，然后激活您的牛客账号，我们看到的是这三个字，但是这三个字是有链接的，是可点的，你一点就链过去了，所以没有必要把那个路径写的那么啰嗦，在这里就三个字，更直观一点。

好了，这个模板就处理好了，处理好以后我们再回到service，接下来我就可以利用这个模板发邮件了。那么上节课我们讲了邮件怎么发，所以说很简单，把上次跟我们说写的 Test里的代码挪过来就可以了。

那么首先激活邮件，首先我们需要创建这样一个对象叫context，aaah是timely foo包销的对象，识别化的，我们好通过这个对象去携带变量，好那么 contact、点、sat wherever你得先带上 EMAIL，对吧？而这个EMAIL发给谁就发给用户的邮件点，user点，get EMAIL对吧？就这个值。

其次你要给他晒了一个 URL，这里边我们就得规定一下 URL它是一个什么样的路径，这是由我们自己定的。就是你希望服务器用什么样的路径去处理这个请求，那你就可以自己定，假设我要求这个路径是这样写，完整 HTTP，冒号双曲线，logo house8080这是我们的域名，对吧？

然后接下来是我们的项目的访路径community，接下来是我们这个项目之下某个功能的访问路径和激活的功能，我叫activity，然后这是哪个用户在激活，对吧？

因为很多用户都可以激活，这是哪个用户，我们得给一个标志，比如说这里我就要求你传入一个用户的ID，101是用户ID，直接把它拼到这个路径里面来，然后还得携带激活码，我就后面再带一级扣的就激活码，比如说我要求激活的路径是这样的，所以那么我们得把这个路径动态的拼出来，不能写死都能拼出来。

首先前面这一段是域名，那就是我们注入的度命，接下来是项目名，那就是我们注入的康txt，再往后是 activity是功能的访问名，我们这就得写死了，这就可以了，因为以后不会变，我就写错了，copy一下。

然后再加上用户的ID那好办，user点get ID你注意注册的时候，用户传进来的优质对象里是没有ID的，但是当我们调用了insert语句之后，那么 user里就有ID了，这是买卖得自动的获取了生成的ID对它进行了一个回填，为什么会这样？

因为我们这儿对买卖投资做的配置就是使用自动生成ID的这么一个机制，所以它底层在执行insert的时候会自动生成ID，然后我们在 map配置文件里还指定了 ID的属性对应着谁，所以它会把生成的ID复制给属性，所以 user点get ID就有值了。

好了，然后 ID之后还有最后一集是激活码对吧？我们得加一个斜线，然后再加一个激活码，激活码就这里不也有了吗？Get xtv正扣的。好，这个路径我们终于把它拼好了以后，你需要把它也site到康txt之内， P叫URL值也是u二。

好，那么拼好了这两个条件以后，接下来我就可以利用模板引擎去生成邮件的内容，此卷空间的内容等于template的安检点，process，那么那个模板我是把它放到了没有的路径下对吧？

然后 Activision点html后缀不用写好，然后把 context传进来，那么生成 html格式的内容以后，最后一步就是调用milke lend，然后的散的没有方法去发送邮件就可以了，邮件发送给用户的邮箱，所以优质的get EMAIL，然后邮件的标题，这是一个固定的业务，所以说固定的标题就是激活账号，然后内容就是 content。好这样就行了。

好了，那么到这儿我们 service、业务层注册用户的逻辑就完成了，那么最终如果说你传的参数有什么问题，我们会返回 map里边，包含对这个问题的描述，我们可以把这个描述显示到这个页面上，给你做一个提示，如果说没有问题，我们就进行一个注册激活，最终的返也返回map，这个map就是空的。

那么如果map里是空的，就比方说没有问题，好了，那么 service完成了，完成以后接下来我们再去开发控制器CTRL，那么在 CTRL当中我们去处理前后端交互的逻辑，好 CTRL我们还是利用log in control了，还是在这个模块中去写，那么我们首先需要注入一些内容，因为我们要处理这个请求是需要调业务层的，对吧？你首先得把 user service注入进来，我们好去访问它。

User service。好，那么其他的暂时不需要了，因为类提供的软件的方法一下就能解决所有的问题，只要你把参数给他就能解决所有的问题。

好，然后我们需要定义一个方法来处理注册的请求，这个请求是浏览器向我们提交数据，所以请求得是pose的请求我先声明一下路径 pass等于register，然后 master等于为快master点post，然后方法是public返回string，就返回视图的名字，然后方法名就叫register。

首先我要增加 model参数，这样的话我好往model里存数据，携带给模板，这是第一个。第二个页面它会传入什么？它会传入注册时传入账号，密码邮箱，你可以声明三个参数去接收这三个值，或者是直接声明一个user对象也是可以的。

好，那么只要这个页面上传入传入值的时候，它的值与user的属性相匹配，那么 Spring mvc就会自动的把直注给注册对象里面的属性，这样非常方便。

好了，那么在这个方法的实现的时候就简单了，因为我们有 service对吧？你只要调 service的resist，把user传给他，让他去处理就好了，然后他会给我们返回一个MAC，我们根据map的返回值去进一步看我们要怎么给浏览器做响应。

好我得到一个map，我判断一下，如果说 map它是空的，或者说 map它是它是或者说它是空的，总之就是卖的是空着的时候表示说我注册就成功了，那么注册成功的时候我们怎么办呢？

注册成功的时候，我们应该在浏览器上给一个提示，说你成功了，提示完以后我们应该跳转到这个登录页面，马上你就可以登录了，这样就比较方便，对对不起，我说错了，是我们注册成功以后就给它跳到首页去，为什么不是到登录？

因为它有一个激活的这么一步，你激活以后再去跳到这个登录页面，这是我们逻辑，刚才我记错了，我们跳到首页去，然后我们怎么他给他一个提示，我们可以把请就这个数据返回给登录页面，然后登录页面上弹出一个提示，但那样的话不好看，我是这样做的就是说当他注册成功以后，我弄了一个第三方的页面，在 site下这个页面叫operate result，就是你操作的结果的页面，operate result。

这个页面非常简单，我把孩子折叠起来，这个孩子没什么可看的，福特也没什么用，它的内容就非常简单就是说你这做什么事成功了，但是这个地方的值你可以改，然后系统然后成功以后，系统会在几秒后自动的跳转的目标链接由你来定，所以它过几秒就自动跳转了，自动跳转的逻辑是底下 GS实现了，很容易很简单的。

好了，就是说我们注册成功以后，我们跳到这个页面给一个提示说你成功了，然后过几秒再跳到最终我们想去的那个地方。而这个页面需要两个条件传进来，一个是提示信息，一个是你最终要去哪个页面，是这样一个逻辑。

好，那么我们回到 CTRL，我就这样处理。 Model点儿at actually message这是给中间页面一个提示消息，提示消息我就自己随便写成功了，我就写注册成功，然后说我们已经向您的邮箱一发送了一封激活邮件，然后请尽快激活，就这么一句提示。

另外提示完以后，倒数8秒最终跳到哪去，还得给他一个目标的设置。 Model点儿ed actually目标也叫target，最终我要跳到首页，我写上首页的房租叫index，然后我就return我要去的模板，那么它在site之下，而且site operate result这样就行了，当然这样还没有写完对不对？

因为你这个模板还得根据这个条件去设置，我们还没设，所以接下来还得设置这个模板。所以说其实每一个环节还挺啰嗦的，但是也还好，你按照请求执行的流程的倒叙一步一步的反推去做就好了。首先我需要把它定义成他们那个模板，这里我要写上，xm lnsth他们if挂机，然后这个路径是绝对的，没有问题，这个路径我们需要进行一个定义，采用 Time before的风格去定义它。

好，看底下有没有GS需要去处理，这个GS都是绝对路径，不用管。好，那么最后我们去看中间的环节，中间的内容咱们怎么去配？首先我们要就这个提示信息可能不同的业务它有不同的消息，我们要根据实际情况去动态的改这个值，所以这里应该是个变量 test，等于当然我们传的是一个message对吧？Message。

另外跳转自动跳转是跳到哪去，是跳到超链接的路径，这个路径不能写死，要动态的改变。

 Thhref这是一个路径，他们的意思路径的写法是以at开头，然后但是这个路径不是一个固定的值，是一个变量，所以这里还得用表达式把它取到变量名叫target。

好就这样就可以了，这个模板我也定义好了，我们再回到 control了，继续把它永章的逻辑给它处理完。

刚才处理的是就是说他注册成功的情况， l否则 map中如果有值，比方说它失败了，失败的时候我们需要向页面传那些失败的消息，好让它显示而最终我们要return到哪去？你失败了应该return回原来的页面是谁呢？Resist对吧？

所以你看return就是它了，return回去，但这里要携带一点信息，因为 Model点I的还是不对，那么当然它的内容可能三有三种情况，一种是账号有问题，一种是密码有问题，一种是邮箱有问题。

这里我不去识别到底哪个的问题，我就直接把账号、密码、user、EMAIL那三个信息一股脑的就发送给他，但是有可能有的值是空的，一般上空的我们就不处理，不是空的就处理就可以了。

好，那就是username message，然后这个值我们从map里取map点，get usually message同理再来俩，第二个是password。Message。最后是EMAIL message。

好，总之错误的时候，我把这三个消息发送给发送回注册页面，接下来我们要对这个模板进行一个处理，模板我都打开，他这个模板我们之前已经把路径 hider说到嗨的我刚才忘了一件事儿，那么这个opera的不也有head吗？他也得进行这样的复用对吧？刚才把这个事给忘了，但这个是小事儿，最好还是把它写上，我写哪去了，怎么写到结尾去了？因为刚才我把它合并了，在合并的状态下一填就填到结尾上去了，写错了。

好，那么回退一下把它写到这个位置。行了，好，我接着去处理 Resist。它的header我们已经复用了，不用管了，内容是需要管的，负责不用管了，底下 Gs路径也不用管了，主要是要对内容的部分进行一个处理。

那么内容的部分其实主要就是对表单的处理，表单的话，首先你要声明这个表单提交到哪去，他什么样的提交方式对吧？

所以我们需要在 form上加上一个master的声明，我是以POS的方式提交数据，另外你要指定提交的路径提交给谁，那也是用 Tommy的风格去写这个路径，那么这个路径是rise的就行了。

另外你表单想提交的话，它最终一定得有一个提交按钮，button summit这就是提交按钮没有问题，只要你点这个按钮就提交过去，而提交的时候每一个框需要有name声明你这个数据的名字对吧？目前我这个name应该是没有的把它补上。

首先你看是账号，有ID，但没有内容就等于 user name这个name要要和CTRL当中优质对象的属性名相对应，这样是不是mvc基于同名原则把参数传给user点user内容，这个一定要注意写错字母就不可以了。然后密码同理密码，这个name等于pass word。好，再来确认密码，注意密码和确认密码它俩是一个相同的值，所以我们把密码传给后台，确认密码不用不需要，它只是就是说怕你就是手误写错了而已，所以确认密码只是前台的逻辑，他不用传。然后是邮箱， name等于EMAIL好了。