10-开发注册功能(续).mp4

那么这个name也就写完了，写完以后还有问题，就是说如果说我这么一提交数据提交给服务器，服务器注册成功了，它跳转到了首页，那就和这个页面无关了，这都皆大欢喜。但是如果说我这个数据有问题，提交给服务器注册没有成功，它不是还会回到这个页面，而回到这个页面的时候，不是给我们携带了一些错误消息对吧？所以我在错误页面上还得把错误消息做一个处理。

好我们一点一点处理，有点繁琐，别着急。首先首先如果你回到错误页面的时候，那么肯定是希望 User、name、password这些值还在对吧？而不是说回来以后这个值就空了，它还在，所以我们回来的时候就要给它填一个默认值，框的默认值是通过value来进行设定的，每一个框它现在比较长，我做一个折行，我先把这折一行，然后默认值我在这写 thy0默认值肯定是个变量，等于。

好，那么默认值我们从哪取？你看这个方法，当我们跳回出页面的时候，这个出页面是可以直接访问user的，为什么？因为 User它已经存在于model里，在spring mvc在调这个方法的时候，他就做了这样的处理，既然又在model，我们可以在页面上可以直接访问到它，对吧？所以我这可以刚才那个地方默认值我可以写成什么？就写成 User点user name。

好，但是这样写是不严谨的，因为如果说我是不是通过错误发送返回这个页面，我是直接点注册功能，跳到这个页面的时候， user就没有，对吧？我直接仿这个页面图，user没有，你这样写不就控制异常了吗？所以你还得判断如果user为空的时候，你就什么也别显示，如果不为空的时候我再把它显示出来。所以这块也就是说 register是在两种场情景下复用的一个模板，所以你要考虑到兼容性。

好，因此这个地方我得这样讲，user对象不等于now，在这个时候我就在这里外流表显示悠着点儿，悠着内对吧？如果它等于now我就什么也不显示是这样的，同理密码也是这么处理就可以了。

我这个代码拷过来逻辑是一样的，这就是 user点pass word， User不等于now，那么显示的是user点pass word。

好，那么确认密码其实也是一样的，因为确认密码和密码一定是一样的值对吧？当你能提交的时候说明密码和确认密码一致了，那回如果说错了回到这个页面，那他俩也是一致的，所以确认密码也是这么处理，我把刚才这个代码贴过来，那就显示密码就可以了，邮箱也是类似的逻辑，只不过这显示的是悠着点，EMAIL。

好，那么回到错误页面默认值的显示处理完了，那么最后还有一个逻辑就是说你这个错误信息要显示在这里，但这里我们目前是写死的一个消息，我们应该把它改成一个变量，所以你应该在 div上写上th，冒号， text等于某个变量，等于谁？就是我们control当中传的这些个错误的消息对吧？这个账号的问题你应该写user name，message。

当然你首次访问这个页面的时候，如果 Message是空的，它就显示不出来，因为它没有下级的调用，所以它不会出现控制异常的问题。那么同理，如果密码有问题，就是整密码上显示那个消息，然后确认密码不需要 pass是不是写错了pass word，password，message确认密码不需要，然后邮箱需要，邮箱是EMAIL message。

好，然后还要注意一个小的细节，就是错误的消息默认的它是不会显示的。

那么什么时候它会显示就需要，因为我们这个页面是通过 but stop做的。那么它是有一个连带的关系，我们看一下什么连带关系就这个错误消息是否展现，它基于 input框上面的样式，class，那么如果 Class里带上了样式 is invalid。

如果说框里的值表示框里的值是非法的，那么 div就会显示出来，如果没有样式它就不显示出来，有没有样式得动态的判断，对吧？这是一个动态的情况，不能写死。

所以 Class应该是一个动态的，我们要传一个动态的值给他，所以也需要用 tap来处理。其中 form、control、样式一直有的，然后后面还要拼上一个动可能配上一个动态的值，对吧？所以你要用两个竖线表示说这是一个固定的值，后面可能带着一个动态的带一个动态的值，我就可以这样写了，打了括号对吧？好。

是否拼一直歪着的，你看一下就是 user message它是不是空值，如果user message它不等于那就表示说有错对吧？如果有错我就应该加上样式is invalid，否则我就不讲样式，这里要写上三元运算。那么同理你这个账号是这样的，那密码也是这样的，也是竖线。好拼上一个变量，但这个叫password，message逻辑是相似的， copy一下，整体都一样，确认密码不需要做这样的判断，然后邮箱是需要的，这个地方是EMAIL，message。

好了，到这儿我们终于把注册页面的逻辑处理好了，总之处理页面的逻辑的时候比较啰嗦，那么你不用追求的时候我一步到位把它处理好，你可以先按照逻辑，我要提交数据时我要做什么处理对吧？

我回到这个页面时我要显示原来的值我要怎么处理，我要显示错误消息，我又怎么处理，那一层一层去追加就可以了。

甚至来说你可以就是说我先把内幕添加好以后，设置好以后我直接先测一下，如果没有问题我再返回来再去设置 value，再去设置 class也都可以。

好了，写到这里我们就可以做一个测试了，看看有没有问题。我们写了这么多代码，出现问题是很正常的，那么出现问题的时候，我们主要是多看一看控制台，多看一看它的一个提示，按照我之前跟你讲的调试技巧去解决问题就好了。

好，我就把代码重新部署一下，我按一下 CTRL f9算了，这样我还是点这个按钮就完全把服务重启一下，因为它CTRL f九编译的时候，有的时候可能会把 html这些东西可能会有一些遗漏，有的时候它是不及时的。

那点这个可能稍微靠谱一点，好我再打开浏览器，我先访问首页，再访问注册页。

好，我要注册了，我先我先看一下数据库，看一下表里的数据，我先写一个错误的故意写个错的试试。这样 order办ID倒叙一下，你看我之前已经有了一个用户叫牛客，假如说我还想注册一个用户名叫牛客，看看行不行，然后牛客的密码，你要问他密码。

我记得好像是123，咱们试一下。牛客密码就还输123，确认密码123，邮箱，我看一下表邮箱，我就填写我现在的邮箱就可以了。别重复。

好我就点注册了，点立即注册，成功了，因为牛可以存在对吧？他返回了这个页面给我带来这个消息，而其他的没有受影响对吧？表示ok我这个逻辑是对的，我就账号不让我注册这个账号，我就改一个，改一个改成什么？改成换一个不叫扭亏了，随便写个嘻嘻密码123确认密码123邮箱是这个。

我这点注册对我换个邮箱试试，换个邮箱是邮箱也可以重复吗？我看其他邮箱里面我用 Test QQ.com，其实这个邮箱根本就这不是我的邮箱，不存在瞎写，看能不能验证出来注册，他说该邮箱已被注册，说明我们服务端的逻辑对于账号邮箱没有问题，那么如果说我什么都不写，什么都不写，他其实前台已经有了判断，他不允许你过，所以其实后端走不到，我想应该也没有问题，因为判空逻辑比较简单。

好我来填一下这个数据，账号是CC密码123，邮箱是我的邮箱，然后我点立即注册，这个有点慢，然后成功了，跳到了中间的中转页面，说注册成功，我们已经向你的邮箱发送一封邮件请尽快激活，然后倒数8秒跳到了首页，没有问题，没有问题。

那么接下来就要看了，我这个邮箱里有没有收到邮件还挺快的，收到了。收件箱，激活账号。某某你好，你正在注册牛客网，这是一封激活邮件点链接，而这个链接你看鼠标全程的时候，你看我们网页的左下角路径对吧？路径，然后IPTV151151是我的优质ID，后面 Ff500什么什么，那就是自动生成的一个字符串是激活码，但是现在还不能点，因为我们激活的行为逻辑还没处理，但不管怎么说，我们把注册的这件事已经处理好了，对吧？

就是说我们已经把第二步处理好了。

好，那么到这儿我们终于可以开发最后的一个环节了，这个请求开发完以后，咱们整个注册功能就都搞定了，这个相对来说就容易多了，其实这三个请求当中就是中间的这一步比较繁琐，那么激活账号无非就是做验证比较容易一点，好，我们接着写激活注册账号的代码，我打开我的开发工具，这样我先把刚才我说编写的代码关掉，因为这个内容放不下有点乱，好，我们重新的整理一下这个思路，我要激活这个账号，我首先要做什么，首先我需要在业务层，数据访问层不用，因为激活账号其实最终是要改变一个用户的状态。

我们数据库访问层面，我们其实有的map已经写了，所以不用写了，我们直接在service层加一个业务就可以了，再加一个业务方法。

那么我们在处理激活账号的时候，其实有几种情况，一种情况就是说你激活成功了没有问题。还有一种情况是什么？我点了邮箱里的链接，我点了不止一次点了多次，就第一次你激活成功了以后，其实重复激活就没有意义了，所以还有一种情况是你重复激活，我们要给个提示，还有一种情况是你激活码可能是伪造的，你是瞎编的，就不对就失败了。

所以激活最终有三种结果，成功了，或者是重复的激活或者是激活失败了，首先我想把这三种结果做一个敞亮的声明，写一个把它放到接口里，我们好在不同的地方能复用好，能够得到这个状态。好，那么这个常量接口我把它放到YouTube下，这是一个接口就可以了，用起来方便，那么我给接口取名叫community constant，就是常量的一个接口。

然后这里边我就定义几个常量，主要是激活的一种一些状态，首先是激活成功这个状态，那么常量我们通常以大写的单词来命名 ATV的小火线，success等于0，这种情况表示成功。

好，再来一个还有可能是重复激活，这个复制一下 active region，然后是重复激活repeat，大写的好办，你可以有快捷键，好像是CTRL CF的u能把它做单位转换，然后再来还有激活失败的情况，然后也copy一下，然后失败那就叫failure。

Fail ure当然这个值不能都是0，都得有区分01二我就把常量定义好了，那么我在user service里头去处理激活的逻辑的时候就需要用到常量，所以我让当前的类实现接口，a place community constant。

好，那么刚才我们写的是racist方法，现在我们写的是激活的方法，他们这个方法就返回激活的状态，你是成功了还是失败了，就返回int就可以了。然后报上名儿我就叫activity。那么你要激活账号的话，你看我们刚才的激活链接，你会传给我什么？你点链接的时候你会传给我用户的ID是多少，要给谁激活对吧？以及激活码是多少，所以我们能得到这两个参数值，所以我就要求你把优质ID告诉我，要求你把激活码给我，然后我就可以帮你激活好了，那么我们处理这个机构的逻辑也非常简单，就是说首先你把用户先查到，然后查到以后你判断一下他激活码对不对？

大概是这么一个逻辑，对了，我们怎么处理错了怎么处理，对吧？

首先是作为一个查询 User，等于利用 map对谁来办ID方法，你把 uzid传进去，我们会得到这个值，那么有这么几种情况，如果说悠着点get斯特尔斯，它等于1，你注意我们注册的时候斯特尔不等于0，而你激活以后它会变成一，如果我们发现斯特都已经是一了，可是它已经激活过了，你这次机会就是重复的对吧？

所以我觉得return什么？ Active region，repeat这是一个重复的激活。

好，再来如果你不是重复的激活，还有可能出现什么情况，还有可能是这样的。User的get activation code点e cos错了，不是按照位置，是e cos点e cos code。如果你激活码和传输的激活码是一样的，那就表示说你激活码没有问题对了，你就可以成功对吧？激活我最终要返回的是 Active vision success，但是你在激活成功之前还要做一件事儿，你得把用户的激活状态改了，改成一对吧？

这才叫成功，所以你要调you the map的update的方法，我们之前不是写过吗？Update是特色，你把用户的ID传进来，对吧，把状态改为一就比较成功了，还有否则这是扣的相等，否则就是不等，不等就失败了， return，activity，非典。

好这样就行了，激活的业务层面的方法就写完了，写完以后我们需要在 control里再把这个请求处理一下。请求的页面是邮件的邮件就是一个html，所以我们已经把这个页面做好了。

好我需要打开controller，还是刚才 Log in controller，我就是无非是再加一个方法处理这个请求。那么先声明请求的路径，这个路径你不能乱写了，因为之前我们在注册的时候规定了这个路径应该是这样的，对吧？我把它拷过来再做一个强化，应该是这样，前面的都是默认的，就是我们访问的时候它自动的后面的话你这个就是路径名对吧？

以及它的参数，你要按照这种方式来写，所以 Pass应该等于它，但这里不能写死，应该写成变量对吧？

这个是user ID这个地方是扣的，然后这个请求是盖的请求就行，因为怎么说我激活的时候，因为它不是我们邮件上不是给提供一个表单，对吧？

只是利用路径简单地携带了两个条件，他最终期望你返回的是激活的一个结果，其实这相当于是一个获取的行为，我到底成没成功识别失败对吧？

它其实相当于是一个查询的行为。

好，然后我这个master就等于request点，你看那是点get，盖的请求就可以，然后他不理他是这样，方法名我叫 activity，那么这个方法上面我还需要加上 model好，用来像我们将要访问的模板传参，然后我需要用注解叫pass无二宝。

从路径当中取这个值，咱们之前不是讲过，首先我要取的是uzid对吧？我们得到的是一个整数。

好，其次我要取的是把这个复制一下， Code我们得到的是一个字符串。好，就这样，这个方法就说明到这。那么我们得到了这两个参数以后，我们去调service的方法去处理这个结果就可以了，非常容易use。Service点aptv点把优质ID传给他，把客户的传给他，他会给我们返回一个结果，这个结果的含义，我们从接口中可以去识别，你不要去用手写012对吧？

我们最好是依赖于接口，为了访问接口方便我这个类也实现这个接口， community cost好，然后我要对结果做一个判断，如果说 Result你等于的是active vision，success你成功了我怎么办？对吧？

还有一种情况是without等于activity。 Repeat。那么就是一如果你重复了我要怎么办？还有否则我不用比较就三种情况，否则我要怎么办？这三种情况其实第一种情况是成功的，后两种都是失败的，无论成功还是失败，我都希望给用户一个提示。

怎么提示？还是刚才的 Opera的中间页面，我们跳转到中间页面给他一个明确提示，你成功了还是失败了，然后提示完以后，那么跳到最终的目标不一样，成功以后我就跳到登录里面，因为你激活成功了，可以马上就可以登录了，对吧？如果失败了我就调到首页，你还不能登录，调到首页你先看看别的帖子就这个意思。

好，那么总之无论如何我们最终这儿要访问的是 operate，就写上return，operate这里有就他好，那么登录成功的时候，我们给一个这里可以复制，因为这里不是有了这样的逻辑，对不对？可以复制 opera的页面需要两个参，一个是message一个target对吧？登录成功的时候我给他一个message，注册成功我也给他一个message，不准激活成功，老说错激活成功。然后说您的账号已经可以正常使用了，然后我们最终跳转的目标是登录页面log。

In，假设页面的路径是log in，其实我们登录页面的登录页面还没有声明的对吧？一会还得声明一下，但我先定义好它的路径是login。

好，然后如果是这种情况就是说它是重复激活的，我们要给予提示 Message说这个是无效的操作，那么该账号已经激活过了，这个时候就不要去登录页面了，就去首页好，再否则这是错了你就激活失败，然后您提供的激活码不正确，这个时候我们还是也是要去首页，我就不去登录页面，好，完了这个逻辑就处理好了，比较容易。

好，那么处理完以后，当然这个operate我们刚才已经处理好了，这个不用管，我们还需要处理的就是登录页面，我们现在还没有登录页面，我就再写一个访问登录页面的请求直接在这里加一个就可以了。

我在这加访问注册页面再来个访问登录页面，其实和它很像复制粘贴，稍微改一下就可以了，这个我就要烙印也是盖只是得到一个登录页面的登录页面，只是得到一个页面而已，放个名我要get哪个in配置，然后他的页面的名字叫login的html，在sett目录下，所以这地方就写log in就完了，这就写完了，当然写完以后这还不行，你还得把 log in点is太慢，把它添加上模板相关的声明，所以我需要找到烙印，点html，加一下xml ns，HTTP冒号双曲线是三w califf点LG，然后这个页面的逻辑我们先不处理，因为我们当前开发的事，注册功能不是登录功能，我们只要把这个页面能正常的展现给用户就可以了。

在这一步，所以你需要把样式文件的路径什么的处理好就行了，所以这里我写th然后艾特好，把样式文件处理好，这个也是要做这样的处理。

好。当然底部还有 js，这三个不用，就这一个可以了，然后别忘了，黑的每个页面都要复用复用的都是index的页面对吧？所以我把黑的也处理一下。Th replace。Index header好了，登录页面我就配置好了，然后还差一点点事，因为我们现在已经增加了访问登录页面的请求了。

那么我们在这个页面上是不是应该这个可以点，现在还不能点，因为你看这个路径还不对对吧？

所以我们在首页上再把它配好，在首页上index把登录的页面的路径配好，在这和一样类似 th，好，然后艾特老毕。

好了，终于把这些零碎都配好了，配好以后咱们可以尝试一下，那样这样重新重启一下点，它就自动重新编译，然后自动重启服务了。启动好以后，那么我先打开页面，看一下我登录页面对不对？能不能访问？可以，没有问题。好，接下来我就要去激活我的账号了，刚才我邮箱里不是收到了激活码对吧？我就点一下点了一点以后向服务器发出请求，服务器做出了响应，说正对了几乎成功了，然后倒数几秒以后跳到登录页面，你就可以去登录了。登录页面我还有的地方没处理好，就这个验证码是一个图片，现在是一个固定的图片，将来我们需要动态生成，这样看不好看，把它也改一下。

好，打开 Log in，点开mail找到图片，这儿原来写的是这样的路径不对，我先把它改一下 th，就是说它不是不对，是在怎么说是在就是静态页面的环境下是对的。当我们把它拿放到模板引擎下，放到模板里，它的路径发生了变化，那就找不到了。好，处理完以后咱们再可能f9一下，然后打开浏览器刷一下这就可以了，当然你现在点的话没反应，因为我们还没有做刷新的处理，但是我们看起来顺眼了就可以了。

好，那么到这儿我们终于就把注册功能开发完了，虽然说这个功能比较繁琐，但是你仔细想一想，我们把它拆解成三次请求，一次请求逐个的去攻破，攻破完以后你发现这个很简单，没什么特殊的内容略微麻烦，但是你把它拆解成几步以后逐步去实现，还好，这一步相对来说还算比较容易，所以拆解以后拆解成三步以后，再根据具体的逻辑再去做一个小的拆解，就是总之我们一个复杂的功能就是做层层的拆解，直到我们可解为止，这就是我们开发的一个套路。

好。那么课后大家好好的把这个东西写一下，你去体会一下这个套路，然后遇到问题好好利用我之前所讲的调试技巧去自己去调试程序。我们这节课就先讲到这里，咱们下次课再见。