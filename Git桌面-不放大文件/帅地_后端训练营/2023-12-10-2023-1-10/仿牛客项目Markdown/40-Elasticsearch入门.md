40-Elasticsearch入门.mp4

这一章我们来学习elastic search， xs它简称叫es但是目前性能最好，也是最流行的一个搜索引擎，你像大名鼎鼎的 Facebook get up维基百科国内的百度等等，很多公司那么都使用 es进行搜索，那么我们的项目中也有搜索功能，我们就选择es这么一个专业的搜索引擎来解决我们项目中的搜索的需求。

好，那么第一小节我们来学习 es入门相关的内容，主要是你要了解这个工具，另外的话我们把它安装好以后，在学习它的一些常用的命令怎么去做基本的操作，那么你对它足够熟悉了，我们在此基础上再去演示这个代码怎么写。

好，首先我们看一下 EMS相关的介绍，这里有一些我提炼出来的一个重点的解释，说es是一个分布式的 restful风格的搜索引擎分布式大家都能理解，就是说我们是采用多台服务器进行集群式部署，这样能够提高整体的性能。

那么restful是什么？它是一种设计风格，这种风格它规定了前后端你应该按照什么样的标准进行交互，那么不同的类型的HTTP请求，你的请求的格式应该是什么样的？其实它是对请求的标准的一种描述。也就是说那么一s它采用这样 Res否这样风格的一个设计，就是我们通过普通的HTTP的协议就能够访问它，所以说很实用很方便。

然后第二个它支持对各种类型的数据的检索，它所支持的数据，包括你结构化的数据可以，非结构化的数据也可以，甚至是地理位置也可以，一些指标相关的数据也行，总之各种类型的数据我们都可以通过它来搜索，非常强大。

然后在搜索的时候， es它的搜索速度很快，可它可以提供实时的搜索服务，你要知道就是说搜索引擎它进行搜索它是需要分几步的，首先我们需要把我们的数据先提交到搜索引擎里，或者说我们把数据要在搜索引擎里再存一份，然后搜索引擎在存这个数据的时候，它会对数据进行分词，然后索引建立索引，然后通过索引再去搜索这样的方式提高效率。

所以说那么其实很多搜索引擎它都能做到搜索，但是有的引擎你在这个数据提交的环节它就比较慢，它不能做到实时，有的引擎是你提交以后，它这个分词索引速度稍微慢一点，不能做到实时。

那么对于 EMS搜索引擎，那么在这两个环节它都能够做到实时，所以说它搜索速度非常快，而且能够提供实时的搜索服务，因此才是目前最流行的一个搜索引擎。

然后第三个因为它是集群式部署，那么如果说你想在这个集群里加一个服务器非常方便，所以说它便于水平扩展，便于加服务器。

因此它每秒有了集群以后，它可以处理的数据量非常的大，它可以处理 Pb级的海量数据就总而言之 es是目前性能最好，然后的话最方便使用的一个搜索引擎。

那么我们想学会 es首先我们需要了解它的一些术语，那么我们在了解它的术语之前我还要再强调一下，就是说刚才也说了，其实就是我们要想使用es去搜索数据，那么前提是这个数据你要在es里再存一份，所以从这个角度来说，你也可以把 es当做一个特殊的数据库，也可以这么看。

我们买SQL也好，还是reds也好等等，这个数据你要想通过它搜索，你把它转存一份存到 es里。好，那么基于这个前提就有了索引、类型、文档、字段这样的几个术语，这是和它里面存储数据数据的形态有关的一些术语。那么这个术语我们和我们的数据库my circle可以做一个对比，这样的话大家好理解。你看我们my circle纯数据，首先我们得有database，得有库，对吧？我们的库不叫community对吧？然后其次库里得有表推广是吧？每个表的纯某一种类型的数据，然后第三个表里的数据是多行的，很多行。

第四个是每一行数据它有分为很多列很多个字段对吧？那么其实索引 Es中的索引类型、文档字段，它和my circle当中的数据库表行列相对应，也就是说es中的索引与数据库中的 database，数据库相对应es中的类型和my circle当中的退保表相对应一个类型，就是一张表，一个索引是一个库，因为这个概念和我们关心数据库差别比较大，所以一开始可能很别扭，但是你这样我按照顺序摆摆出来，然后你按照这个顺序去记还好。

第三个的文档，那么一个文档相当于 my circle中一张表里的一行一个文档是一一行数据或者说是一条数据，那么在es里这一条数据叫文档，然后注意这个文档的数据结构，我们通常采用的是节省节省结构，然后杰森中的每一个属性我们叫字段，字段其实对应的马赛克就是一列，好，所以它对应的是 database，这个对应的是黑宝，这个对应的是肉，这个对应的是color，是这样的一个关系。

好，但是在 es6.0的版本当中，这些关系逐渐要发生变化，主要是集中在前两个地方要发生变化，主要是他想废弃类型的概念，废弃类型以后就没有与表对应的术语了，谁与表对应？

索引，所以从6.0以后索引其实它对应的是一张表，一个索引对应一张表，然后还对应行，这个还挺厉害。

然后6.0它保留了这个类型，只不过类型都固定成一个固定的单词，而不是各个表明了固定成一个单词就完了，到7.0的时候就彻底废弃掉了。

那么所以因为我们要用比较新的版本，肯定是6.0以上的，因此对应关系大家要搞清楚，现在最新的它对应表它对应行，它对应列类型逐渐的废弃了解，但是我为什么要介绍，有人说你既然用新的你就别介绍了，这个还不行，因为我们在后续的操作当中还会看到残存的类型的一些信息，如果不介绍的话，你会感觉这是个啥东西很别扭，所以来龙去脉还必须得知道。

好了，这是es关于存储数据相关的一些术语，大家要了解。

第二个是和集群有关的，那么因为我们是分布式部署，所以说这个是采用集群的方案进行部署，那么我们一台 es服务器或者是多台组合在一起，那么就是一个集群，然后集群当中的每一台服务器，我们称之为节点，当然在其他的服务器当中，其实这个概念是通用的是统一的，不只是es这么称呼，然后分片，那么你注意一个索引相当于一个，然后表里的数据可能会非常的多，那么分片是指的是对索引进一步的划分，那么一个索引在存的时候可以拆分成多个分片进行存储，这样的话并发能力就提高了。

你把一个索引拆分成多个分片或者说多个空间的话去存，那就可以并且并发来存，就比较能力就比较强。

提高并发能力，再一个是副本，还有一个副本的概念，副本是对分片的备份，一个分片可以包含多个副本，我们有了备份以后，万一说某一个副本数据丢了，挂了，那么还有其他的备份，这样的话提高系统的可用性。

所以说再回顾一下集群式部署，分布式部署，那么可以提高整体的处理能力，提高整个的性能，然后分片，所以也是提高并发的能力处理能力，副本的事情要提高可用性。

以上是 es相关的一些特点或者是它的一些术语，我就介绍到这，大家做一个了解，当然你也可以从 es的官网去做更多的一个了解，那么es官网是这个网址好了，那么接下来我给大家演示一下 es我们怎么安装怎么去用，这个是es的网址我打开了，打开以后它会做一个判断，一看我这个是中国的IP所以它自动切换成中文了，这还挺方便，它还支持中文，但是文档它不支持中文，它只是一个大致的介绍才是支持中文的。

然后那么如果说你想去查看 es相关的文档，你可以点学习，文档就非常直观了。

点一下，然后它这里面有什么you last take stake。 Electric站它的技术栈，它和electric search有什么关系？其实 elastic设置它是整个技术栈中的一个产品，它这个产品其实最早就是es这一个产品，后来的话慢慢的扩充，有了很多其他的组件，慢慢的形成了一个技术栈，越来越多东西，但我们学的就是 Es这也是整个 es公司的核心，我要看他的文档就点这当然有其他的版本，你可以点比如说点这是7.2的文档，然后的话这是目录，你点目录还有一些介绍，然后的话你可以看往下翻下一节等等，这里我们就不在课上去看了。

当然了我不看这个文档，我要做的是下载，我再回到首页，然后你可以点这个产品，产品里面其实你点这也能找到下载的位置，你点这儿就更直接一点下载点一下，下载以后你看有这么多产品，其实都是围绕以last设置构建的整个这些产品加起来， less take stake它的一个站。

好，我要下载它点 download，然后目前最新的版本是7.2.0，但是这里我想说的是 es我们暂时还最好别用最新的版本，为什么？因为我们所使用的思政部的他的 Pom文件是继承于 pom父pom当中声明的 es版本是6.4.3，那么那个版本他做了一个测试是没有问题，和当前的思政部的完全是兼容的。

当然其实对于其他的工具来说，一般我们用一个更新的安装一个更新的版本的工具，其实也可以，比如说我spring布的声明这工具，我用的包是2.0，我们其实装2.2.2，33.0可能往往一般都问题不大，但 es它6和7之间版本变化比较大，还真的不行，你忘了刚才我说的就76和7这个过程当中，它是逐渐废弃掉了，类型变化比较大。所以 sport当中它他用的是6.4.3，我们用最新的版本真的就不匹配，我试过。

对于一s这个工具，大家最好用的是和死人不得内部一致的版本号，6.4.3，所以这里我重点强调一下，那么要下载6.4.3也好办，往下看一看你看它这有一个past历史，以前的版本我就点一下。好，然后他就倒叙的方式列举了以前很多个版本，找一下6.4.3，还有点冒，这6.4.3就是它了。

好，然后点进去，那么比如说我这是windows系统，我就下这个点 windows就可以，下载一个zip的压缩包就可以了。

好，那么我这个已经提前下载好了，我就不在课上下载了，然后我们来看一下，安装的话就很简单了，就把它解压缩就可以了。我就解压缩一下解压文件，解压到d盘work目录下。

好，剪完以后大家看一下 Less take search6.4.3，那么解压完以后我们需要稍微改一下它的配置，那么它的配置是在config目录下，然后是文件，elastic search点yml我就打开它。

好，打开以后我们不用说每一项都配，它，这里有很多的注释，有很多的解释不用每项都配。

那么有必要配的是这么几项，第一个格拉斯特内集群的名字，因为我们后面编程的时候要指定集群的名字，所以这里最好把它配一下，它默认叫man，我改一下，我叫改成叫脑壳的，好然后再看，然后最好把这个配一下，pass点data，就是说我们 es我们要往里存的数据，这个数据存到哪？

你看它默认的路径是针对Linux系统的一个路径，你这里必须得改了。

好，比如说我要把它存到c盘，好的d盘 d盘，然后work目录下data目录下，然后新建一个文件夹叫 electric，然后-6.4.3。好，那么然后再建一个目录叫data，我是把它放到这个目录下，当然你任意定义放哪都行。

再一个还有一个这个地方 pass点logs，就是说那么它在这个工具在运行的时候会产生一些日志，日志存到哪去，我也希望存到 d盘work目录下，所以说我copy一下，但是存的最后后缀就不叫data，叫locks。

好，这样就可以了，目前的话这个目录应该还没有看一下。Work data有，但这里 electric还没有，那么运行的时候它应该会自动创建，我们指定好就可以了。

好了，那么配置文件这就配好了，配好以后我们再来配置一下环境变量，因为我们一会会通过命令行的方式运行几个 es常用的命令，那么为了访问它的命令比较方便，我们最好配置一下它的环境命令 work you last take search6.4.3，那么它的命令是在b目录下，所以我把 b配到环境变量里，pass新建一条这点开编辑然后新建一条。

好，那么 es我就配好了，配好以后那么我们还要装一个东西，中文的分词插件，为什么？就是说因为搜索引擎和别的不一样，大家都用搜索引擎，你至少用百度对吧？比如说我搜互联网校招，那么他一定会对这个词进行分词，至少会分成互联网一个词，校招一个词，对吧？这就是分词，然后搜互联网相关的内容，搜校招相关的内容。那么如果某个内容和互联网和校招都有关，这个肯定是优先排到前面去，对吧？如果只和一个关键词有关，那就排到后面去，大概是这个意思，大家应该都能理解。

那么 Es它默认的话，它是支持英文的分词，英文分词很简单了，英文分词就是一个单词，一个单词中间有一个空格就分了，而中文不一样，中文的话我们一句话中间是没有空格的对吧？这个工具默认它没有带中文的分词的插件，我们需要单独装一个才能够支持中文分词。好，我们的牛河社区，咱们用户群体都是中国人，所以说用的都是中文，这个是必不可少的。而中文分字插件我们在哪找？ Es官方没有，这是第三方提供的，那么我们在低的普上可以找到，我们找一下。

好，这里我已经提前打开了 get up.com，然后你可以在搜索框里搜一下 get up它的搜索引擎就是一s搜一下us take search，然后分词中文分词插件叫ak好，然后搜索回车，那么第一个使用的最多的你来take search and nice。

Ok，点进去以后这里有这个代码你可以下载，但是我们不是要看源码。然后后面一些有这个版本的说明，就是说 Ik的版本和es版本的对应关系，其实它就是严格基本上是比较严格的对应关系。

总之6点差对6点差6.4.3，你最好就对6.4.3颜色对应，然后这里边还有关于 es的一些介绍示例你都可以看，插件的示例都可以看，我们不细看了，一会我给你操作下载的话是点这儿。他提供了一个下载的链接，还是在 Get up网站里点一下。

打开以后它这里列举了很多版本，我们要找的是6.4.3。下一页6点 4点三点进去点，这个就可以了，那么我这已经提前下载好了给你看一下它。

好，那么下载好以后我们需要安装，解压缩就可以，但是必须解压缩到一个固定的目录下，必须解压缩到我告诉你，反正我就直接解压解压文件，必须解压。

刚才我们安装的 elastic search的路径下，所以我打开d盘，然后的话elastic search6.4.3，然后你要放到普拉克因斯里边，然后还要在普拉克因斯下面建一个ak的文件夹，把它放到 Ik的路径下要注意，好我选中plus新建一个文件夹，然后取名为ik然后选择ak点确定解压到这里，我看解没解压，说好 work plan。

Ok已经解答说好了，刚才那个过程太快了，都没看出来好，然后解压缩完以后，我们只要看看一个东西，让你对这个分词插件有一个更多一点的了解。

我们主要是看它的配置，这里有很多配置文件，有很多 dic结尾的文档，就是字典，他分词的时候他搜索的时候，那么他怎么知道你哪几个字组成的是一个词，他怎么知道有哪些词？

那么是靠这个来配的，这里面其实有很多内容，你随便看一个比如说面点DAC打开，你看这里面就各种词，他搜到有这么一个东西的，就知道这是一个中文词，这是一个中文词，就这样的。

好了，当然了他这里边内置了很多词典，但是我们的语言是有发展的，咱们每一年不断的会流行一些网络新词，词典里肯定是没有的，那么如果有网络新词出现，你也希望能够被搜索引擎做分词做识别，能够搜到这个词怎么办？我们需要在这里配在 ik and Liza这个里配。

好，我打开这个文件看一下，这里就是ik的一个扩展的配置项，然后你可以在这里配你自定义的词典，一个什么点DAC文件，就是说你可以在这个目录下创建自己的disc文件，然后在这里指定，指定以后你只需要把网络新词写到你的 disc文件里就行，怎么写？

就像他写法一样，就是一个词一行就可以了，非常简单。好，然后还有一个他还配一个什么？这里可以配扩展的停止词。词典它有两个词典，一个是我们搜索的词，一个是停止的词。好，我们看一下它这里面有没有什么停止的这个词，你看这个就是stop work，dic它是默认带的，你看一下这是英文的，再找一个这个再点开，什么叫停止词？

你看就是这样的了，以使这样的得是这样就是停止词，这样的话你配了这个词词以后，那么他在分词的时候，他看到这个词就知道这是这个词条就已经结束了，到此就结束了，这种词就是停止词你也可以去配，但其实基本上一般不用配，因为网络新词它一般造不出这种东西来好了，总之就是说如果你想配置一些你就是一些新的词汇就在这里去配，主要是增加你自己的自定义的DAC文件就可以了，然后DAC文件你就参考它自带的去写就可以。

好，现在这个分词插件也装好了，还不着急去使用，我们再安装一个工具，这里我列举了这个工具的网址叫post Mark这个工具。那么postmark它能够模拟外部客户端，说白了它就能够模拟网页发送 HTTP请求，为什么需要这么一个工具？因为其实我们直接通过命令行去访问 Es服务器，如果是查询某些东西还好，但是如果要往里存东西，这个命令太长了，记不住也很难写，特别麻烦。

那么因为 es的支持用HTTP的方式去访问，如果我们有一个现成的网页，能够有框往里填数据不就方便了，但是我们又没有网页，那么这个post Mark它就能替代网页，然后你可以通过框去构造一些数据，然后提交给 es服务器，这样比较方便。

当然其实不只是往es中存数据，即便是我们从es中搜索数据，如果说我们搜索的规则比较复杂，那个时候命令也非常难写，那个时候我们提交的搜索条件用它来提交也会比较方便。

总之为了提高 EMS我们入门的时候使用的体验，我们就用这个工具比较好，那么打开这个网址就可以下载这个工具，我把它下载一下，我已经提前打开了，这个页面get boost com，然后的话打开以后你可以点 get started，然后这里就download，那么我当前是windows系统，64位我就点它就完了，你根据实际情况去下载，我已经提前的下载好了，看一下，安装一下。

好，稍微有一点点慢，大家别着急，咱慢慢来，安装完以后它会提示你注册一个账号，你就填邮箱，用户名密码，可以注册一个账号，然后那么我这已经注册好了一个账号，我就直接登录，就点刚才点31我登录，然后在登录的时候，你用这个账号或邮箱都能登录。

好登录了，登录以后，那么我们要访问 es服务器，其实就是利用这个页签，然后这里不是敲命令，而是在这框里输入一些数据，大概这样的操作，然后你看我登录以后，它会把我之前在别的电脑上也是利用这个账号所做的一些操作，他都已经给他下载过来，它同步过来了，这就是它的好处，当然我们不用看好。

那么现在你看我就把我这次课需要用到的这些工具都安装好了，再回顾一下第一个安装了以来CK设置服务器，对吧？第二个我们安装了这个分词的插件，第三个安装了一个模拟外部客户端的工具 postman。

好，那么这里头 es服务器和中文分词插件是必要的，toast man是不必要的，没有它我们也可以访问，通过命令行也可以，或者是我们通过其他的类似的工具也行，这个post不是唯一的，你要知道。

好，那么接下来我给大家演示一下我们怎么去使用 es首先我们演示通过命令行的方式怎么访问它，当然你在访问之前你得把它启动起来，它就好像一个数据库一样，你得启动起来。

好，我打开 EMS安装的目录，然后的话b打开b windows系统，我就是运行 bat当然如果你是Linux或者是 units，系统就是mic os那么你需要透明的行运行命令。

好，我用的batbat的话你通过命令行，访问也可以，直接双击也可以，这里我就省事，我就双击一下。双击以后稍等一会儿，它启首次启动的速度有点慢。

好，这已经起来了，你看当它提示绑定了9200的端口的时候就ok了，那么 es服务器它默认占用的是9200端口，好，启动完以后我把它先最小化一下，我打开面谈工具来访问一下，打开命令行工具作为客户端来访问一下这个服务器好。

那么因为刚才我们配了这个环境变量，所以说我可以直接使用 es的命令去访问它。

首先我们先执行一个命令去查看一下 es集群的健康状况，那么如果你去官网手册，他也是第一个也是建议你执行这样一个命令，看一下这个机器人是怎么样的。

好命令这样写，curl杠x杠get不是杠就是直接get，然后的话写上你要访问的服务器的地址，那么本机有个house的端口9200，好这是我要访问的服务器，然后get表示说我是一个获取 get请求获取，然后获取什么，后面你要接着写cat，然后的话健康状况 health，然后带一个参数v比方说你在显示数据的时候给我显示一个标题出来，好，我写完以后回车，我把它弄的大一点。

好你看它有两行，第一行是标题，提示你下面数据显示的什么内容，第二行是具体的数据，你比如说 time是时间格，拉斯特是集群，status是状态，状态 green表示说很健康没有问题，如果是red就表示有问题，然后这里面有多少个节点，no的，还有多少个分片，没有等等，就这样。

因为我们现在里边还没存数据好了，这是我们查看集群的健康状况。

再来一个，比如说我想看一看这个集群中有什么节点，你可以这样写，curl杠x然后的话还是get获取，然后路口29 200-cat，然后的话我们查看的是节点 no，带个v比方说我也要标题，那么它会显示出其实只有一个节点，它IP是本机127.0.0.1，然后这是堆内存的占用量，然后 CPU占用量，内存占用量等等，还有节点的角色等等，好，总之你只能看到一一条数据，那么就是一个节点。

好，再来，那么刚才我们介绍 es术语的时候，我们介绍过索引，那么6.0以上的版本索引就相当于是一个表。比如说我想看一下我当前的 Es服务器里有多少个索引，怎么看？这样写。

杠x概念还是获取，然后后面跟的是服务器的内容， host9200，然后还是杠cat，那么查看索引这是index它的复数的形式，带上v表示我想看这个标题，事实上它只打印出一行标题，然后没有具体数据，比方说我现在没有索引，因为确实我们新装的里边什么数据都没有，对吧？

好，没有索引，我怎么去建索引呢？

这个也比较容易串联锁也是这样的，curl杠x然后我们采用的是put方式的请求， port表示说推送数据新增数据，然后后面写 local house，冒号9200这个服务器，然后斜线后面跟的是你要建的所有的名字，这里我随便写一个叫test，回车，然后它返回的结果是Jason格式的acknowledge two比如说成功了，超你好的所有名字就叫test，没有问题。

我想确认一下，我再查一下，再执行一下命令，查一下有多少个索引。

好，再执行你看有一个索引，但是索引的健康状况是yellow，它不是green，不是最健康的状态，为什么？因为我们在建索引的时候没有给他指定它分片副本，所以没有备份他没有备份，因此他认为你不是最健康的状态，有可能是有一定的风险，但是能不能用？可以用，只是一个警告而已相当于。

好，如果说索引我不想要了，我删掉那就curl杠x然后执行给力他类型的请求。那么 Http协议它里边包含了各种类型的请求，我们之前常用的是get post，其实还有put delete，那么它们都表示特定的含义，那delete就直观了。如果说你对 HTTP协议各种请求的类型还不太熟悉，那么你去翻阅一下，就像我给你提供的网址，我直接拿网址从里面可以找到相关的介绍，你去看一下好。

那么删除的是local host9200服务器上面的名为test的索引。你看返回的是数，ok删掉了，删掉以后我们再查一下，所以就没了。

好，那么以上是我们通过一些命令的方式来访问 Es服务器，那么如果说我们只是做这个查询，只是创建一个索引还好，当我们要进行复杂的搜索的时候，当我们要进行往一s服务器里添加大量的数据的时候，这个就太麻烦了，就写不出来了。

所以接下来我再给大家演示一下，我们用这个post来代替一个网页，代替一个web，就是用它来代替web客户端去访问 es因为它是web客户端，它也执行的是HTTP协议，看会怎么样，然后我们在多讲几个 es的操作，让你对 es有一个更直观的了解。

好，这样我把刚才我们执行的那几个命令挑几个咱们再用post man再演示一下，比如说现在我要用postman查一下 es里一共有多少个索引，我不是执行命令，我是直接做操作，首先我查询所以get请求这里选get默认就是get，然后这边你要访问的服务器地址，你要写上local house9200，然后你要做查询，后面加上刚看的，你要查询有多少个索引，index、复数加上v就是这样，总之你看比刚才命令稍微精简一点，然后点send或者回车，都可以触发访问点send，那么查到了只有一行数据标题，没有具体的内容，因为我们刚才不是把 test给删了，对吧？

好，下面我们再重建一下，索引重建的话是另外的请求类型，我再加个页签。然后这块选择 put。新建put，然后的话local host9200是吧？那么所以名字还叫test好，然后回车就可以了。反馈结果还是 Jason格式表示成功了。成功以后回到刚才的页签，我看这边能不能关掉，关不掉。就这样我再查一下，你看所以你就有了是吧？这是新建一个索引的方式，如果删除索引我再来个页签，我一般习惯的是一种类型的访问，我就来一个页签，这是得力的。

删除local past9200，然后 Test，这样就行了，然后回车成功再查一下，又没了。好，你看我们使用托斯曼一样可以执行这些命令，只不过它比我们刚才在命令行敲命令略微简洁一点。

好，我们再往下看，我们访问 es服务器最主要的是要往里存数据，然后好搜到这个数据对吧？不只是建索引，接收一下相当于建立一个表里就有数据，我们怎么往里面插入数据，给大家演示插入数据， put提交数据，然后访问的是6个house，9200test索引，当然有人说你刚才不是把test给删了吗？

是我给删了，但你注意如果说我直接向es服务器执行一个命令，要求插入一条插入一个文档就插入一行数据，那么我在命令当中指定了不存在的索引，那么它会自动建索引，然后查数据，所以这个是一个隐含的，它有一个隐含的操作，只要我指定索引的名字它会自动建索引。

好test，然后再写杠dog，这个dog其实是文档的类型，那么因为6.0开始这个类型逐渐要废弃，但6.0没有彻底废弃，而是给它一个固定的名字，通常就固定为dog，而test晋升就降级为表明它就是固定就站位，不用管它，然后斜线，你要指定这个数据的ID，我第一条数据ID是一。

好再说一遍提交数据。用post用put请求，这是服务器 IP和端口，这个是索引是哪张表？ Dog占个位而已，不用管它，这是ID。然后你ID有了，你具体要存什么数据，这数据怎么提交？我们是在这儿在整个请求这是请求路径。我们是在请求的body里请求体里带上这一条数据请求体选 Body，然后数据有各种形式，我们选肉，然后这块选Jason，我们用Jason的形式提交数据。

所以可想而知，如果说你还是用命令行的话，我们想就添加用请求体的添加一个杰森格式的数据，那边内行就很难写，但是我们有波斯曼，我们点一点在这写就方便很多了。好，所以这里我写一个Jason格式的数据提交给 es服务器。好，比如说我要提交的数据包含两个字段，一个叫开头，开头就是标题，随便写hello。好，然后再来一个 content，内容，内容随便写，好，还有完了，当然你也可以加更多的字段， Jason的形式，这就写完了。

那么写完以后，下面我就要执行了，我就算了一下算了一下，我要看结果，好你看这个结果treated创建成功了， successful一成功了成功以后我们去查一下，我就查一下这条数据，怎么来查这条数据，查还是get是吧？

怎么查这条数据这样 localhost9200，那么test索引到站位，然后一比方说我要查这个索引之下，ID为一的数据，send你看我们最终查到了一条数据是属于test，索引类型是dog，可以忽略了 ID是一，然后版本是一就没更新过，然后它的内容包括两个字段， title和content这数据就有了，没有问题。

好，那么这是我们增加一个文档，增加一条数据，如果要删这个数据，如果要删，有人说如果要改数据改的话，其实还是用铺的，你把这个值一改再提交它，其实底层会自动的先删再新加，它是这样一个规则。

所以这个改我就不演示了，删怎么删，删肯定是得力的，我演示一下删，然后 Google host 9200test，dog占位删除ID为一的数据，然后 send你看返回说delete的删掉了，确认删掉了吗？我再查一下。Get一下放的force。找不到没有了，删掉了，好，那么到现在我们就知道了我们该怎么去建一个索引，我们怎么往索引中增加数据，修改数据，删除数据查询，数据增删改查，知道了，这只是说我们怎么把数据维护到 es服务器之内，对吧？

用正常改查建索引江的操作。

但你要知道我们一s存在的价值是在于说它里面的数据能够被我们所搜索，搜索不是让我们查数据库 select from加一个条件加两个条件那么搜，而是说我们提供一句话一个句子，这个句子需要有人帮我们分词拆分成几个词条，然后再去库里去匹配，匹配的时候还不是固定的某一个字段，可能是我既想搜title，又想搜content，又想搜某字段，我是一个全文的搜索全文的匹配，那么数据库这一点是做不到的，它不能分词，它默认它也没法去支持全文的这种匹配的方式，对吧？

这数据库做不到，那么搜索引擎很容易就能实现，所以下面我给大家演示一下我们怎么去实现这种搜索，那么我们要实现搜索，肯定你得有点数据，对吧？你一条数据都没有怎么搜，我往里存几条数据存三条，意思一下，好我重新存数据刚才都删掉了，重新存put put然后还是往test里存，然后 ID是一刚才删掉了，重来，ID是一。

好这个数据比如说所以它就两个字段，title content就可以。那么这个title我就要最后搞个中文的，咱们也好好看一下中文的插件好不好用？

互联网求职，然后 content的内容是怎么想寻求一份运营的岗位，当然我们实际的项目环境里这个字比他多得多，我现在守桥意思一下得了，然后三个一条数据就好了，再来一条，第二个ID是二，这个抬头我叫互联网求职，这个叫互联网招聘好内容，再编一个内容，我就要招聘一名资深程序员好，然后 send created成功了第二条数据再来第三条，第三条这个标题我叫实习生推荐内容是吧？

本人在一家互联网公司任职，然后可推荐实习开发岗位这么一句话上的 created ok好。

我再确认一下，我刚刚提交的这三个数据真的存进去了吗？在这搜一下一send。没问题有对吧？互联网求职，然后二互联网招聘没问题。三实习生推荐，你看三条数据都有了以后，接下来我要搜索了，这样我再建一个新的圈，搜索还是盖也是查，只不过它比刚才这个普通的长用ID长要复杂一点，你上哪去了？这好。

那么当然我们访问的还是local house，9200这个服务器，我们要搜的目标还是test索引，那么我可以加一个社区单词下划线社区这个单词，比如说我要从所以你搜索信息，目前我只是说搜索，但是我没有加任何条件，那就全搜出来了， Send。

好你看结果 his就是命中了几条数据三条，然后的话你看这是第一条数据，互联网招聘，第二条数据互联网求职，第三条招聘，第三条就是实习生推荐，这三条数据都搜出来了，这是没有加条件设置搜索我加一个条件，比如说我想搜title，问号你加条件q等于固定的就是q等于，然后以开头为条件来搜索，就开头冒号，后面加上关键词，你想用什么关键词来搜？

比如说我想搜互联网，这个意思就是说我要搜开头当中包含国内互联网这个字的信息三个。好，你看命中两条，其中一个是互联网招聘，一个是互联网求职没问题两条，另外一个没有互联网对吧？好，同样的我也可以去搜 content，比如说我要搜 content当中带有运营实习这个词的关键字的内容。好我send。

好，你看命中还是两条，第一条寻求一份运营的岗位，有人说不对，你这个条件是运营实习，他这里没有实习俩字，你注意这是搜索引擎，当你提交一个条件的时候，他会先对这个条件分词分成若干个词条，你最容易想的它至少要分成运营和实习两个词条，然后分别去匹配。

那么你看这句话是不是能够匹配上运营这个词条，当然是可以的，所以他就被收到了。

然后你看第二条数据，这里边没有运营，但有实习，所以它匹配的是另外一个词条，这是搜索引擎它内置的一个能力，它能够对你提供的关键词进行分词，我们写的是中文，就说明中文的分词插件起了作用，对你注意。

好，还有一种情况，比如说我不只是要搜title，我不只是要搜content，我要搜的是我既要搜title又要搜content，只要包含我这个词条就都会显出来，这个时候就不能简单这样写了，因为我们搜的逻辑有点复杂了，这是多个字段同时匹配，那么通过路径直接搞定了，这个时候怎么办呢？

把路径改成杠设计，那么具体的搜索条件，我们通过请求体去提交复杂的搜索条件，所以你看这就是post慢它的好处，如果是命令行，这个请求体就太复杂了，不好写。好我请求体我用Jason构造，所以选肉，然后这块选 Jason好大括号，然后这里你要写写什么？ Carry，就我要用什么样的形式来搜索，那么后面的话 carry后面这个值是一个符合的值，还是一个Jason，还是个大括号？

换行一下，然后 k冒号， y6还是一个符合的对象，还是一个精神 k要写成什么？ Martin match，Martin就是多个match就是匹配，就是多个字段匹配的意思，然后的话大括号里你还要继续写克，瑞克瑞写什么写的是你想匹配你的关键字，比如说我这个关键字就互联网，关键字互联网，好了，然后再来还要写 Feels就是字段的意思，后面是方括号，这是一个数组，里边可以写多个字段，指定你到底要在哪些字段里去搜互联网。

那我既要搜抬头，又要搜content，这个查询就构造完了，那么es它的搜索其实还有很多规则，远比这个复杂，那么我们了解到这基本上就能够理解他的大概的能力了，后面的那些更复杂的我们就不挨个去演示了，你可以从手册里去自己慢慢去看。

好 body我构造完以后散了一下，然后看结果his命中三条数据，第一条标题中有互联网对吧？第二条标题中有互联网，第三条标题没有，但内容都有互联网，你看那么对于整个索引多个字段我们都能够匹配到，而且如果说你中文是有多个词组成的，它也能够进行分词，那么基本上就能符合我们的实际的业务的需要。

当然了我们现在这种形式只是说我们去安装完了EMS，我们只是去测一下，看看到底好不好用。

然后在测的过程中，我们体会一下 es它到底是有什么样的能力，到底是大概用什么样的形式能够去访问它，能够做什么，有一个直观的印象。

那么下次课我们再去用 spring整合 es然后通过 Java代码的方式，然后去访 es那个是我们日后经常要用到的访问的方式，但这个你最好也要做一个必要的了解。好了，那么这次课我们就把 esn的入门的内容就介绍完了，我们就演示到这里，咱们下次课再见。