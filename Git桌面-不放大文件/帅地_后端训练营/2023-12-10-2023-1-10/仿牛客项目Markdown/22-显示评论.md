22-显示评论.mp4

这节课我们来实现显示评论的功能，就是在这个帖子的详情页面下面，显示出帖子所有的相关的评论，然后下次课我们再去实现增加评论的功能，然后再增加评论的时候再用上我们上次跟他所学的事务管理方面的内容。

这样安排的目的是因为我们在开发增加评论的时候，是基于显示评论会比较方便一点，那么显示评论功能并不复杂，然后我们在开发功能的时候，也不需要用到什么新的知识点，我们还是按照以前老的套路先来开发数据访问层，然后开发业务层，然后开发表现层，那么这里面每一层大概要做什么事，这里我都做了一个大致的这样一个列举。

我们就先从数据访问层开始写起，那么我们在开发数据访问层之前，我想我们先对这个表做一个了解，会比较好，所以下面我给大家介绍一下评论这张表。我已经打开这张表查到了一些数据，然后这个表的第一列 ID没什么可说的组建。

第二列是user ID，用户ID就是说这个评论是谁发布的，那么是对应的用户的ID。

然后第三第四类是itttitititidintit是实体，这代表什么意思呢？是这样的，就是我们发布评论，我可以对帖子发表评论，你看这个页面我可以在最下方对这个帖子发表评论，我也可以针对某一个帖子的评论去发表评论，所以我们评论的目标是有变化的。

当然我们这个项目只是做了牛客网的讨论区的功能，牛客网还有其他的，比如说看课程的功能，你可能还会对课程进行评论，还有题库，你可能会对题进行评论，对吧？你甚至可以对某个用户进行评论，所以评论的目标是有很多种类型的，我们在开发的时候，你不能说我评论帖子写一个代码，对吧？

评论再来一套代码，那样就太low了，而是应该把这些评论的业务我们进行一个抽象，然后的话我们用一套业务解决所有的评论的问题，我们想设计一张表能够解决所有的评论的问题，是这么一个目的。

所以我们这里涉及的是这两个字段，一个是实体类型，其实就是评论的目标的类别，比如说一代表帖子，二代表评论，3代表用户，4代表题，5代表课程，类似的，然后 nttid就是你这一个类型的目标，具体是哪个目标？比如说具体是ID为228的帖子，还是229的帖子是这样的。

然后后面还有一个target，ID是什么情况给大家介绍一下，咱们看页面静态页面，我在评论的时候可能是我对某个评论进行评论，在这进行回复就可以了，或者我也可以这样，比如说我一点这个回复，你看这里提示回复谁谁，所以这里也是评论也是对评论的评论，但是这个评论是有指向性的，它指向某个人，他不是普通的评论，他还要指向某个人。

这个时候我们用target ID来记录指向的人，然后 Content就好理解了，是评论的内容，然后是状态，状态零代表的是正常的，那一代表的是它被删除了，被禁用了不可用的。

然后后面是创建的时间好了，总之只要你理解，其实这三个字段其他的就容易理解。

然后我们评论表里面它已经带了一些数据，这是我之前我在开发的过程中自己造的一些模拟数据，我们就在数据基础上做查询，已经现成数据有了，所以我们是可以去开发查询的功能的。

好，我们要开发查询功能，首先我们得把这个表的实体类型写好，对不对？那么我就打开这个idea，然后我在安推包下新建一个实体类叫comment，然后给它增加一些属性，首先是ID，然后是uzid反正就和字段的一一对应就可以了，这里我就不进行详细的解释了，然后是it太太 mttid target ID然后是内容状态，抓紧时间好，然后我要生成盖特赛的方法，另外再生成一个to stream好。

这个实体类我就写完了，写完以后接下来我就可以开发数据访问组件map了，那么这是一个新的表，我需要新建一个map，那么我就在dao报价创建一个接口，叫做 comment map。好放大一点，那么给它写上一个注解，map。好，我们查询评论它是要支持分页的，你看这要分页查询的，因为某一个帖子可能有很多的评论，对不对？那么分页查询我们需要提供两个方法，一个是我们要查询某一页有多少个数据，另外一个我们还要提供一个方法，查询就是一共有多少条数据，我们好计算总的页数好。

所以我需要声明两个与查询有关的方法，第一个方法返回的是list。Comment有comment。方法名我叫c let。Comments by mtt就是我查询我根据什么来查询，我是根据实体来查询，我要查询帖子的评论还是评论的评论，还是课程的评论，对吧？很显然这个实体是你一个绕不开的条件，所以我声明条件是mttk还有 nttid实体包含两个条件。另外为了分页，我们需要增加分页的条件，一个是offset，另外一个是每页显示的行数的限制。

好，另外我再声明一个方法用来查询这个数据的条目数可以反馈整数， Select can't by under it，而这个条件还是under it，我把这两个条件 copy过来，好，那么 map这两个方法我就声明好了，下面我们逐一的把它们给实现了。

对于数据访问组件我还是利用配置文件 xml来实现，我可以随便找一个配置文件 c CTRL v复制粘贴，然后改一改，这个名字我改成叫comment点x32，它里面的内容我先给它删掉了，我要重写，然后当然 name space里边的值你需要做处理，你要与comment map做匹配好。

然后当我们查询的时候，我先定义一个查询的字段，为了方便以后我们多次查询的时候可以复用，那么 ID我叫select fields，好，这里面我写上我要查询的字段，那就所有的字段，ID，user ID，Entity type Entity ID，然后是target ID，content， standards，create time。

Ok，就这么多字段，然后接下来我就来实现那两个查询的语句。它的ID我copy一下， ID等于它我们查询要声明返回的类型是集合中封装的，是 comment实体类，然后我就来写上。查询语句很简单了，就是select，然后这些字段我可以引入它10万，他们的表加上一个条件， Standards等于0，斯特等等于0表示这个数据是有效的，对不对？

所以你要加一个有效的判定。

然后除此以外，还要加上另外的两个条件，就是与安贴贴有关的安贴贴太以及 Entity idea，最后我们需要分页之前我们给它排个序，我们按照时间正序排列，也就是说你先评论的在前面一楼，后评论在后面二楼以此类推，然后加上一个分页的条件 offset，limit这个查询，某一页的数据我就写完了。

然后接下来我们再实现这个就是查询一共有多少条数据，ID等于它那么这个方法返回的是整数就可以了。那么select com ID条数不让他们然后 where条件其实就是这一部分，这里边因为我们只差一个整数，你就不需要排序分页什么的，对吧？但其他的条件需要保留。

好了，那么这两个查询我就写完了，写完以后这个数据访问层就开发完了，那么接下来我们就来写业务层的话，查询其实没有什么复杂的业务，就是直接调这个方法把它数据查到就行了，比较容易，那么我在12位是包下咱们新建一个业务组件，comment service我需要对它进行声明加上一个注解，然后把我需要的这个内容注入进来，我当然就需要刚才的 map对吧？

他们 map把它注入进来，其他的组件暂时不需要，我就暂时不注入了。

然后这里边我需要提供两个业务方法，一个是查询某一页数据反复集合，他们方法没有叫饭的comment by Andy。那么参数就是an TT type，an ttid还有分页 outset以及里面那么实现了我就直接return调用map的方法，一步就搞定了，这个就不需要什么额外的处理。Undertake under the ID offset limit。

Ok，同理另外一个方法也是非常简单的实现，这个方法我叫饭的comment，那么需要你传入的是anti tat以及mtatid也是我就直接return tonight，点select，count by anti就可以了，把条件传入即可好。

那么很快我们把这个业务层面就实现完了，实现完以后接下来我们就要处理表现层的话，一个是我control要处理对应的请求对吧？

第二个是页面我需要展现数据。好，你看这个页面是帖子详情页面，那么我们访问帖子详情页面的请求是在迪斯卡斯POS的肯抽里写的对吧？所以我们现在要做的事情是对 discourse post control做一个修改，补充一些内容，不用新创建一个control了。

好，所以我就打开之前我们写好的迪斯卡斯普斯克扣了，然后这个是我们查询帖子详情数据的方法，我们就在这里补充一些内容，然后因为我们现在要查询的是这个评论对吧？

所以你需要依赖于评论的service，我们需要把最新的comment service注入进来。

所以我在前面补充一个内容，comment service把它注入进来以后，我们这次查询不单单要查询帖子数据，还要查询评论，而且评论的数据还要支持分页，分页的话我们知道我们之前不是需要传入一个配置，这个配置需要接收整理分页的条件对不对？所以把它生成好。

然后你注意只要是实体类型一个招聘，那么我们声明在这个条件当中作为一个参数的话，那么最终是不是mvc都会把并存到 model里，所以我们在页面上通过model就可以获取配置，大家要记得规则，然后这个方法当中之前我们实现了查帖子以及帖子的作者，对吧？

尽量我们要补充内容就是查评论的信息，首先我们需要把评论的分页信息做一个完善，这个我查评论的分页信息把它补充一下，我现在配着点site里面，我先设置一下，我每页显示5条评论，因为我模拟的测试数据数据不是很多，你要是每页显示10条还不够它显示的，所以我们也没显示5条，能够看到分页的效果。

除此以外再设置配置点site，pass它的路径，路径就是当前的路径，就是这个路径对吧？我就写好 detail之前，还有这部分别忘了，然后得听我的下面还有一个帖子的ID，我们这个是一个动态的条件需要拼上去对吧？

我就拼上帖子ID，帖子ID这个好拼的这参数里有，然后配置点set，rose你要告诉他一共有多少条评论数据，一共有多少条数据，它好能算出来总的页数，评论的数据我们可以从评论表里统计出来，或者我们也可以从帖子表里查出来，你看帖子这里不是有一个字段叫common count，对不对？

这个comment com是我们冗余把每个帖子对应的评论存了一下，为什么这么做？

我之前在讲帖子边表示也说过这样做是为了我们查帖子相关的内容是方便，这样的话他效率比较高，对吧？不然的话你每次查评论，每次查帖子还要查他的评论，效率比较低，然后你看比较新的数据，这个数据都是有的是对的。所以这里我就不去查评论了，我就直接从帖子里取。所以 Set rose是post，get comment，count。好了，那么设置完分页的信息以后，接下来我就可以分页查询了，对不对？我就可以调 Comment service了。

点儿 find commons by anti。

然后首先我要查的是帖子的数据，你要指定帖子的类型，帖子类型比如说是一然后帖子ID是多少，帖子ID就是之前我们查到的帖子的ID，当然后面还有附件条件，比如说 page the get offset，而且错了，get offset，配点get limit当然这样写的，我们把实体类型写成一写死了。

这样不太好，因为将来可能类型会更多，最好把它可以配置或者说让它装成常量，将来好改，这样我把它维护到长城接口里去，我搜一下接口， community constant。

好，我在这个接口里增加两个常量，写上注释，一个是实体类型，具体来说是帖子，int实体类型itt太，帖子它等于一，好再来一个，第二个是实体类型，评论。

好，这个是comment好了，那么这个得等于二了，换一个值，当然可能以后还会有更多的值，但现在我们就先不处理，我们先处理这两两种类型。

好，那么当前的 control为了使用接口常量方面我最好实现接口，实现完以后，那么刚才这个地方我就引用接口中的常量 anti tape，post也是一好，这样分析查询我会得到一个集合集合的名字，我叫common list。

好这个方法有点长，我中间断开一下太长了。

好，这样我就得到了当前帖子的所有的评论。然后评论里我们还需要就这样还不行，我们需要补充一些内容，补充什么内容？你看这个评论数据，评论的数据里它有iduzid对吧？它有uzid像它get ID你像这样的ID你得把它转化为就是优质对象，我们好得到的的优质内码头像等等这个内容对吧？不然你显示ID不太合适，我们还是用老办法去处理我们便利集合，每次遍历我们就构造一个map，然后把 Comment存进去，把我们依赖的数据查到也存进去就好了，对吧？

好这里我就list，然后 might用map对我们要展现的数据做一个统一的封装。这个名字我取名叫comment。Vo list。什么叫vo就是 view object就是显示的对象， Map其实是我们用来显示的一个对象，所以就不叫 vo list。那么让他做一个区分，然后等于new a released。

好，实例化完以后我要遍历刚才的集合，但是我先判断一下，如果说集合非空，我就可以对它进行遍历，每次遍历我会得到一个 comment，我遍历了comment list每次遍历我需要创建一个map对吧？用来封装我要呈现给页面的数据，这个map我取名叫comment，vo等于6巴西map显示对象，然后我这里面存一些存什么，首先把 Comment存进去对吧？那就是comment vo点put，我把comment先存进去，另外我要把评论的作者就是优点存进去，我就comment vo倒容易点put user，那么 user的值我可以调用user service就犯的方法去查，而他的ID就是当前评论的 user ID对吧？

好我们页面来展现评论的时候，它相关的用户的信息也很容易就能得到，这样比较方便。好了，这是关于帖子的评论，你注意，不只是帖子有评论，评论也有评论，每一条评论也可能有多个评论对吧？所以我们在遍历的时候，我们得到每一个评论，还要把他的评论也要查到，也要返回给页面好显示对吧？这里有点绕，就是说你帖子也有评论，评论也有评论，我们给它取个名字，这样的话容易区分，不然的话我们在命名时都很麻烦，我这里写个注释，就是评论普通的评论，评论我们称给帖子的评论我们管它叫评论，然后我们管另外一种评论叫回复，就是给评论的，评论我们叫回复，这样的话好一点，所以刚才我们查到的是什么？

我们查到的是评论的列表，就是给帖子的评论的列表，然后 View历史的这是什么？就是评论的 Vo vo就v object显示对象的列表，然后这里因为这个地方代码比较长，所以说我把这个注释写的稍微详细一点，不然的话课后的话你看就很晕。这个map是什么？ Map就是一个评论的vo这里我们是往 vo里添加了一个评论，然后又往没有里面添加了一个评论的作者。

好，这是我们刚才所做的事情，把它理清楚，接下来我要做的事情是什么呢？我要查询回复就评论的评论来查询回复他，回复也是多个，所以是个列表，这个也好查，我就还是调comment service，然后还是调find comments by and点去查好，为了断个句不断先写，然后再断。

这次我们查的是评论的评论，就是我们查的目标是评论的目标是评论，所以这个地方 anti对tag你要写成这个 comment，然后 ID应该写的是评论的ID，评论的ID不就是comment点get ID是吧？

然后每个评论的评论它通常不会太多，即便是多我们也不做分页了，你在这里做分页就恶心了对吧？

一个页面你套着两层分页就很恶心了，所以这里就不分页了，有多少查多少，但是我们所提供的方法是支持分页的这块怎么办也好办，反正我们从0开始，从第零行开始查，然后这里面我指定一个条件是integer，max value最大值有多少条查多少条是这个意思就不分页了，相当于我们得到但是你给我断一下，我们得到的依然是一个集合 list，comment。

名字取得直观一点，不然一会乱。名字我叫回复 Replay list。

好回复列表有了以后那也是回复列表，这里边也得有user ID，你也要带上user，我们也需要做类似的处理，是吧？所以我们也需要再说明一个回复的vo列表，回复的vo列表，那么这也是一个类似的里边它存的是卖的名字，那叫 replay vo list。You are released。我需要遍历集合去构造 Vo list，对吧？我就还得做一个判断，如果replace list不等于空，我就遍历集合 comment。贝拉门就别叫comment了，别和刚才重复，我叫replay回复，然后 replay list。

好，每次遍历我们得到的数据，我要把它装到 vo里，我得先实例化一个vo也就是一个map，VPN vo=6by released， new的是希麦克搞错了，然后我首先往 map中存的是回复存一个replay， replay vo点put名字我叫replay直观一点。当你数据多的时候最好把这个名字取得很直观，不然的话容易混淆。

然后其次我要存的是回复的作者那就是replay Vo点tote user。那也是需要现查一下you there's service find大ID这个ID应该是回复的优质ID。好了，回复这个数据我也就补充好了，但其实还是有所欠缺的，欠缺什么呢？他盖的ID需要处理，刚才我们帖子的评论为什么没有处理他盖的呢？因为帖子的评论，他没有这种指向型的这种回复，他刚才的指发生在哪呢？只发生在回复里，它不会发生在评论里，明白吧？

所以说我们在这儿需要处理 target，ID就是回复的目标好了，回复的目标首先我需要查到回复的目标的优点，我得判断一下，先判断他有没有这个目标，有可能没有，有可能是你这种普通的回复他没有目标对吧？只要你点这个回复的时候就错了，只要你点回复的时候它才有目标。所以这没有这有两种情况你要判断主要是判断的。

他get ID等于0，这里写个注释就是回复的目标，我就replay点get他是get ID，看一看它等不等于0，有没有值，如果是0那就没有目标，我就不去获取它，如果有目标我要获取有着service点饭的白d这个ID应该是他get idea，对吧？我这样查询得到的就是目标用户是一个优点，他的名字我叫他get。

好，然后我需要在 Vo里把 target也带上，就replay vo点put。Target。Target。好了，到这儿我就终于把回复的数据把它补充好了，补充好以后最后你不要忘了，我们需要把 map vo装到集合里，对不对？装在一个集合里，但是它没有值，对不对？没有。好，这是关于回复的一个处理完以后再跳到循环之外，我们还需要做另外的一项处理。什么处理？

你这个循环结束以后，你是把回复处理完了，然后的话其实就是把整个 com的vo构造好了，你要注意你这个回复应该装到comment vo里，不然的话回复装的没装进去它就丢了对吧？我们 com的vo是返回给这个页面，通过它获取到要展现的一切数据，所以你在 if之外，在遍历之外，你要把集合装进去那就comment vo点put取个名字叫 replace。复数，然后装的是这个东西。

好，到这儿，我已经把 comment每一次的comment vo构造好了，它里边不只是包含了评论，也包含了回复，列表相关的数据。好，那么除此以外，我们其实还要再补充一个内容在这个地方，在 Video里再补充一个内容，补充什么？我们看页面就是我们每一个这个回复，每一个评论它有几个回复，这块有一个数据有两个文字写成二，有一个回复写成一，当然写错了，前面写错了，所以说你这个数量怎么来呢？对吧？

所以说你给它页面返回的不只是回复的列表，还应该包含回复的数量，因此我们应该在这补充一下，往 View里装上一个回复的数量，这个数量我们可以查到，我就查一下，这里写注释，回复数量，调用comment service的 fund，comment com的方法对吧？把 an TD type设置为comment，因为你是回复的回复的数量 comment。

然后 ittid是每一个回复的，ID每一个评论的ID your comment点get，然后我把查询的结果用变量记录下来 replay on，然后把它存到 vo里头去。点put我叫瑞贝卡 replay com。

好，最终也不要忘了 Vo你要把每一个vo应该装到集合里对吧？目前这个技术还没有使用，你看它有波浪线有个提示对吧？

好，我们最终还得再补充一句，就是往集合里添加 vo，看我们的vo好了，到这儿我们终于把这个数据查好了，这块有点绕，大家在开发这段代码的时候，你要怎么说要有点耐心，然后一边对照着静态页面去琢磨这个数据的关系，然后一边慢慢的一步一步把每一步的变量写清楚，把每一步的逻辑理清楚，然后再去写，其实理顺了，还比较清楚的，完成以后，最终我们在整个循环之外，我们得到最终的结果要放到model里，传给这个模板是model点艾特艾特取个名字是叫comments多条评论，那么我们存进去的应该是 comment，没有历史好了，到这儿我们就把啃臭了的逻辑写完了，写完以后接下来我们就需要处理模板了，这个模板首先我们先打开首页，index我记得首页上好像也有一个评论数量，我之前没有处理，这里我们现在开发到功能评论的功能，我们需要把它处理一下。

好，我们先找一下哪个地方有这个评论的数量，其实就在这了，帖子不帖子列表，那么在帖子的列表里，在这个位置有一个点赞的数量，还有一个回帖的数量对吧？

其实就是回帖就是评论这个7目前是写死的，我们需要把它改成一个动态的值，我们只改7，所以我最好能在7外面套一个标签，在标签上写他们语法，来获取的数据，我就外面套一个死蛋。

好，然后 span之上为了取变量我就th test等于这个可以直接从帖子对象中获取，我们怎么去帖子，你看这里map点post去帖子对吧？那就map点post取到了帖子，然后他们的 count就行了。

好，除此以外，剩下的内容主要是去处理帖子详情页面，关于评论的展现，我再打开帖子详情页面这个页面模板。

好，这个页面比较复杂，我们先看一下静态页面，那么静态页面它给我们默认了带了两个评论，一个是一个是很显然我们需要便利评论，然后在遍历中去输出，因此我们只要保留一项内容就可以了，第二项删掉，以第一项为模板去输出就可以了。

所以首先我先把第二个给它删掉。

好，这是回帖，前面是回帖数量，先不管，然后后面是回帖列表，然后是第一条回帖，后面应该还有第二条，就第一个li还有第二个li我们找一下第二条回帖，第二条回帖就不要了。

好，这只是前端的给我们的一个事例，现在把它删掉，删掉以后，基本结构我们调整好了，我们就从上往下去一个去理一下，然后看哪一个需要把它改成动态的值就去改好。

首先是第一个地方是这个地方，一当前的帖子一共有多少条回帖，这个数据你需要改，那就改一下 th冒号txt等于这个数量我们可以直接从帖子里取，当前页面怎么取帖子的数据，帖子详情里应该有。Post post找到哪儿去了，怎么找不着了，在这儿这里就写post.comment，com，ok完成了。

然后再看这是第一个内容，再看第二个内容，往后找。第二个内容在哪里？第二个内容就是处理这个帖子的展现了，这里是第一个帖子，我们这是以此为模板去应该去循环它了，对吧？这里就注释就去掉，就不是第一个帖子了，就是要循环它了。

所以我需要在 Li上写上循环的语句，有th h等于每次循环我们得到一个什么？你看 comments它是comment view list。每次循环我们会得到一个comment view就是一个map是吧？

所以我们得到的是comment，vo变量名直观一点，我叫c vo cvo就不要简单的叫卖，不然一会去不开了，然后我们便利的是他们集合，这是第二个地方，我们需要便利，然后再往后看，这应该是第三个需要改的地方，这个地方是显示的是评论的作者，这个头像你需要动态的来取对吧？那就th冒号，把这个路径改成动态的值。我们需要从 Cvo中取 user，就cvo点user点，either you are就可以了。

好，这是这一个内容，再往下看。

第四个内容应该是这儿，这显示的是用户的名字对吧？我们目前是写死的，我们需要把它改成变量，贴成冒号，改成又txt了，等于 cvo点user，点user name，用户名，好，然后下一项内容其实不太容易发现是什么是这是啥看页面就是一井二井，但是这个写错了，这应该是二井表示一楼二楼，这应该是一个递增的数字，怎么处理呢？

其实我可以这样，我根据这个循环，只要我们知道循环第几次，这就是几就可以了。

然后你还要考虑什么呢？还要考虑我们当前的是分页的，比如第一页它循环5次，第二页也循环5次，第二页的话你就不能是这个数据不能是1~5了，第二页它相当于应该是6~10，因为有第一页数据为基础对吧？

所以这个地方我们得用上一页之前的那一页的具体的多少行，加上当前的循环的次数才可以，重点是循环次数我们怎么获得，其实 timeline给我们提供了获得的方式是一个隐含的方式，这里我直接给大家演示一下，当然我需要改变一的值，而不是井号，我在一外面的套上点标签，套上个 byebye。

好， I标签已经默认倾斜的样式已经去掉了，所以说它就没有任何样式不会有影响的。好th冒号x等于这是一个变量，那么这样我配置点offset配置的offset是什么？是当前页的起始行，我们是自动计算出来的对吧？那么它需要加上什么？加上当前的循环次数，你循环了几就加几，这就是几楼是吧？循环次数是这样的，你这个变量叫什么？我这就写什么，后面还要加上一个state，就是说timeline会给我们提供一个隐含的状态对象，这个状态对象的名字固定的形式就是循环变量名，后面加上state，这是隐含的对象的名字，我们可以通过它获取循环次数，.com循环到了第几次，你这样一加这个楼数就算出来了，是这样。

好，这是这个地方的处理，大家要注意。

然后再往下看，这说这开课是不是有点晚，这是一个评论的具体的内容。我们写th冒号，u text等于cvo.comment点，讨论条件取到了评分的内容。好再往下，这里这不有一个时间，这是一个评论的发布的时间，这个时间我们需要渠道 Th冒号，text等于但是时间你需要格式化，对此点 format，然后 cvo.comment点 crate Thai时间格式喂。好，这是时间，再往下看。

下面这个站目前我们还没有开发站的功能，先不管，然后是回复需要处理，处理回复的就是回复的数量，你要把它取出来显示在这里。

二目前我需要在二外面套上个标签，然后给它写上动态的值，这样我套上一个还是一个I吧，然后 th text等于cvo点什么呢？咱们回到CTRL那里看一下， com的vivo不是放了一个回复的数量对吧？就它了，CV这样复制一下，cvo点。Replay。Count好。然后再往下看，那到这儿其实我们这个屏就普通的对帖子的评论的内容就已经处理好了，以后后面是回复，是对当前评论的一个回复，这是多条回复，这是第一条，后面有第二条，第三条以此类推。

那么同样的处理方式，我们没有必要留这么多个 li我们只要留在这一个基础上循环就可以了，对吧？所以我觉得还是留第一个，然后把第二条删了，它只有两个，后面回复输入框你要保留，把第二条回复给删了，不用了，好，注释也不要了，我们主要是要对 ln做一个处理，那样的循环便利显示 a的内容，我需要在 l之上加上一尺一尺，等于我们这次循环的是什么东西看一下。我们内层循环的其实循环的是里边缝对吧？

我们循环的内容其实是 Replace realist而replay realist的名字叫replace对吧？我们要循环的是replace，所以我这里有取名取变量名叫rvo replay vo然后到了括号，括号里边写成CV o是要从CV中取的，CV o点 replace遍历它，然后遍历的时候我们里边要显示什么东西，再往下看。

这个地方 div上显示的是回复的用户，还有回复的内容，回复的用户以及内容，但是你要注意这个回复的用户其实它有两两种情况，咱们看一下这个页面有两种情况，一种情况就是一个用户名，然后一个内容完了，一种情况是谁回复给谁，有目标的情况，这个地方怎么处理呢？

我们可以这样，就是这个地方的展现我们可以做判断，如果说你大概的有值，我就拼上谁回复谁，如果你target没有值，我就拼上，我就只拼谁怎么样就完了，所以这个地方做需要做判断，这样我可以在space上下判断，th冒号if等于比如说rvo点target等于now它是空的，这个时候表示说没有目标，没有目标我就不用去聘上谁回复谁，我就直接一个名字就完了，那么就在这拼上这个名字就可以了，th冒号text等于等于这个是rvo点用户点用户名，完了然后我们再做一个判断，把拷过来，再做个判断，你得这样写，如果他get不等于闹对不对？

他不等于闹，不等于闹的时候，你要配上某人回复给某人，是吧？

还保留前面，我们需要再加一个东西，一个什么，其实它的结构和下面这个是类似的，我手写 class它有class，class等于它也是txt音符，你可以复制粘贴好，然后 I里边要显示一个人名，当然我们页面上其实他给的例子是显示这名字没法读了，我就先以他为例这个人，然后他进行回复，所以后面你要写回复俩字，他回复给他，然后这个名字得是动态的是吧？

所以我们也需要在这上写上th，冒号，txt，等于rvo点，user点user name，他回复给这个目标地，这个地方要改一改，要改成目标，你应该是rvo点，目标是他get点user内容，某人回复给某个目标，这样还行。好，当然了后面这个地方你要写上回复的内容是吧？Th冒号you text等于rvo点 replay点content好了，这个地方搞定了，然后再来再往后看。

接下来就是这里了，是这个地方就是一个回复的时间，我好取 pH冒号txt等于当然需要格式化，对此这样format，这个时间从lvo获取lvo点 replay点create time，然后给上一个时间的格式。

好，那么这个回复的时间处理完了，再往后是暂这个暂我们不用去处理。

再往后是这个回复，这个回复是需要处理的，回复当然它上面没有显示数量，需要处理什么呢？这个地方你要注意，我给你看一下静态页面，这个回复这个回复当你点我再刷新一下或回复，当你点这个回复链接的时候它会怎么样？

它会展开一个框点，这个会展开这个框，你注意为什么不点点，它不展开这个框就回复链接和框，它俩之间是匹配的，它俩之间是map match的它和它是匹配的，它们之间是通过一个ID进行匹配的，这个地方需要注意。

然后现在我们一般不是写死的，我们是循环输出每一个评论对吧？它和它的匹配关系需要去维护的。

好了，你看我们之前链接上是这样写的，是井号回复01它对应的是谁？是 Div的ID这里是框所在的位置，它和它匹配。然后现在我们是在这个li下循环输出的，你每次这个不就写死了吗？不就写死了吗？你写死的话那就都叫同一个ID，他就没法去一一匹配了对吧？所以我们在匹配的时候 Id你应该动态的生成，然后它匹配动态的ID生成也好办，每次循环后面比如我回复后面加一个序列号，循环的次数不就可以了吗？是吧？

所以这块要额外做一个处理。

好，鉴于 idea我需要动态的生成，我就前面加个thid等于这里属于是变量了，当然它不只是全是变量，是一个前面加一个前缀回复固定的值，后面加一个变量，我这样写双竖线回复，然后加个横线，然后后面变量，这个变量是循环次数，循环次数怎么获得和刚才我们讲的一样，就是你循环变量 rvo是吧？

循环变量rvo然后 state这是它隐含的对象固定的名字，然后.com循环次数得到了，所以我这个ID就变成什么呢？

就变成了恢复-1，恢复-2恢复-3每一个就不一样，这儿就要和他去匹配，所以这个地方也需要去动态的去拼，而不能是写死的。

动态拼怎么拼和刚才这个地方一样，th冒号，href等于竖线，竖线前面不动，我加个横线，然后的话后面怎么取和刚才一样， lvo state.com，好了，回复这个位置我们也处理完了，那么再往下看，下面这个表单我们就框输入框我们先不管，我们下节课开发添加评论的时候再去做处理，先不管。

好，后面还有个分页，分页需要处理，但分页的逻辑我们可以复用，首页的分页的逻辑我们不用重新写了， th冒号，replace等于 index，冒号首页我记得当时取的名字叫kj nation确认一下。

还没有，其实我们首页的分页的逻辑，那么其他的页面是可以复用的，然后我们可以复用逻辑，然后我们要复用的话，我们在这个位置还需要加一行代码，那和 hi的处理方式是一样的，加上th冒号，然后的话 fragment等于相当于给这个区域取个名字，取名我就取这个名字就可以了。

好了，你这儿取好名字以后，那么我们在这儿就可以通过首页这个页面的名字以及这个区域的名字对它进行复用了。最后回帖输入这个地方也不用处理，我们讲增加的时候再做处理。

好了，到这儿我们终于把这个页面的逻辑处理完了，有点费劲挺费劲的，为什么费劲？其实不是他逻辑有多难，主要是我们这个页面本来有很多代码，你要是对这个页面的结构不了解，对这个标签不熟悉的话，是吧？你就没法去拆解去做处理，所以你需要首先对这个页面结构有一个了解，哪些去掉要哪些不要你要搞清楚，然后的话一点一点去找到那些需要改变的地方才比较方便。

好了，处理完以后咱们做一个测试，我把这个应用启动一下，但是启动之前它会自动的去重新编译，好启动以后我就打开浏览器，我再新打开一个页签先访问首页，扫描完以后，那么随便你访问首页以后，你看这个数据就变了，回帖数量就变了，12 13就动态改变，而不是写成一个固定的值了是吧？

然后我随便找一个数据去看，比如说点它去看，前面的内容我们先不看了，这块来看一下回帖期，回帖期这不12，好这个问题我们一会再说，我们先看一看后面的内容。

你看后面这12条规定说明后面这个没问题，但这有问题，这是不是我没处理，咱们回去看一下，可能是我忘处理了这个地方好，我再打开 Detail。

那个地方是在回帖详情里的一个地方，回帖详情里我找找有一个叫回帖在这，在作者里这有个7我刚处理了，好我还得把它补充一下，我需要在7前面套上一个标签，他说I吧，然后它的处理方式和这个地方其实是一样的，你就写th冒号text等于直接从帖子里取就可以了。

Comment com好，这处理完以后， CTRL f九重新编译，然后我打开浏览器刷一下，这就对了。

再看看首页这回就一致了，刚才这个地方有点别扭，然后我们看回帖一共12条回帖，然后一楼2楼、3楼、4楼、5楼，好，每1页显示5条数据，12条回帖。3页先看分页对不对？下一页。6楼7楼到10楼。再下一页。然后11楼12楼。没错，分页没有问题对吧？没问题。然后看数据，你看这第一条回复好吧，你赢了。

然后时间有回复没有回复0，这是2，当然这个数据有点随意，有点随意，好，我们看一看有没有更好的数据，我看一下玄学帖，这个数据比较好，因为他评论是有回复的，你看然后它一共是13条数据，也是3页每页5条，然后你看这个评论先看这个时间还是这个时间，然后这个是对评论的回复，然后你好，这里没有谁回复给谁是吗？没有，然后再找再看一下。

这个帖子是回复量是最多的，37个回帖。

然后的话你看它里面各种形式就有了，然后它有一个自己做评论，然后的话别人回复他顶你，然后的话他又回复谁谢谢，然后他又回复他其实怎么样，然后回复的数量评论一共有三个，回复这里是三没有问题。

那么这个比较复杂的情况，我们看了没有问题，那么其他的应该也是ok的，我们就不挨个去看了。

好了，那么到这儿我们终于把这个显示评论搞定了，其实这个功能并不复杂，主要的时间都花在调这个页面上，然后的话那么大家在开发的时候也是很耐心的把这个页面调好，其实问题就不大。那么这次课我们就先讲到这里，咱们下次课再见。