20-帖子详情.mp4

这次课我们来实现帖子详情的功能，在首页的帖子列表页面上，你可以随便的选一个帖子，然后点它的标题，我们就可以打开一个这样显示帖子详细信息的页面，然后在这里把帖子的详细内容显示完整，这就是帖子详情的功能，那么这个功能开发起来就相对容易一些，因为我们利用之前所学的内容就能把它实现出来，这里就不用再添加什么新的知识点了。

然后我们还是按照之前我们所总结的步骤套路去开发。

那么首先我们开发数据访问层，加一个就是增加帖子的这么一个查看帖子的方法，然后我们在业务层也增加一个查询方法，最后是表现层我们除了在CTRL那里处理查询请求以外，那么我们还需要在首页上在每一个帖子的标题上增加访问详情页的链接就加个链接就而已。

另外我们这个是详情页的模板，那么我们需要在模板上处理静态资源的访问路径，并且我们让黑的区域能够复用。最后在正文上我们要显示标题，作者发布时间正文等等这些内容，这就是我给大家总结的一个这个功能的开发流程，接下来我们就来演示一下这个功能实现的过程。

好我打开了我的开发工具，按照刚才所总结的，首先我们开发数据访问层，我需要在 map里咱们帖子的map已经有了，我需要在这里再增加一个新的方法，这个方法是查询帖子的详情，其实就是根据帖子的 ID，然后查询出一个帖子的详细信息而已。

那么这个方法也很容易声明出来，它返回的是一个帖子，所以返回的是discard post，实体类，方法名我叫做select this cast post by ID。我们根据组件的来查询，所以参数就是ID了。好，这个方法我声明完了，实现它也非常容易，我需要打开对应的配置文件找一下。之前我们已经创建过了这个文件在这也很方便，我只需要在这里再加一个谁来的标签，对吧？他的ID刚才我复制了就是那个方法名，然后他的返回的数据的类型，它的返回的数据类型你需要进行一个声明，那么通过resolve tap进行声明，result type等于discuss post。

好，然后我们就来写查询的语句也非常简单，其实我们可以参考之前来写 select什么from这部分是一样对吧？

把它可以拷过来，然后我们在此基础上需要加一个条件，这个条件是ID，所以说很简单 Where ID等于参数，ID好了，这个方法我就实现完了，这一层的开发就做完了，做完以后下面我们开发就可以开发业务层，我们在业务层中也增加一个查询的方法，那么我就找到业务组件， discuss post service。

在这里面我增加一个方法，也是根据ID查询帖子，然后查询的时候，这里也不需要做什么敏感词的过滤，也没有什么额外的处理，反正基本上就是一步就搞定了，所以非常简单，把它实现一下。 Public discuss。Post。方法名我给它定义成叫find。Discard post，白ID参数，帖子ID。实现起来非常容易，就直接return map的方法就可以了。 Discuss post，map点，select by ID，把ID传入就完了，这里就没有额外的业务的处理好。你看数据访问层也写完了，非常容易，然后最后就可以处理表现层的逻辑。

首先我需要在帖子的 Ctrl那里增加一个方法能够处理查询的请求，这个也容易，这就是一个比较普通的get请求。当然你查询的时候需要根据ID查，你把ID传进来，我们考虑到这一点就可以了。

首先我先通过声明一下这个方法的访问路径，pass等于帖子详情，所以这个路径我叫detail，然后我通常这种根据ID查某数据，我们都习惯于把 Id参数拼到路径里，所以我要求 dq的下一级就是 ID这里我写的更明确一点是discuss post ID。

好，另外我再声明一下，这个方法的请求的方式是request，method点get。

好，然后当然这个方法我们需要返回模板，就是 dq discards dq点html所以说你就不要写response body什么的，然后这个方法是public返回词句模板路径，方法名我叫get this cast post我写错了，this cast post ok，那么在这个方法上我们需要加一个参数，好能够接收到变量对吧？

那么我们在路径当中取一个值一个动态的值，我们需要用到注解叫pass variable对吧？好把 key拿进来，然后我声明这个变量，变量的话你叫什么名字都可以，在这里我也叫discus post ID另外我们需要查询到结果，将这个结果你要发给模板，我可以通过model对象来携带相关的数据对吧？好这个参数就够了。

那么接下来我们就在这个方法之内处理这个请求，处理的逻辑也非常简单，就把帖子查到就可以了。我就查询这个帖子，那我就调用这个discuss post service， Find discuss post by ID然后把 disks post idea传给他，我就得到了我想要的数据，这是帖子的数据，我需要把它传给模板，就model点艾特，然后给参数取个名字，为了在模板上我们引用这个数据方便，我给它取名字简短一点就叫post。

好完了，但是你要注意这里我们还需要做进一步的处理，做啥处理，咱们看一下这个数据看这个表，这里我已经把这个表里的数据查到了，这个表里的数据其他的字段都没有问题，像什么抬头 count那样，你就直接显示就可以了，对吧？然后时间你就格式化一下显示就可以了。

那么用户的ID你要做处理，因为我们在页面上要显示帖子的作者肯定不是希望显示ID对不对？他肯定是希望显示用户的头像用户的名字这样的信息是吧？我这个表里得到的是ID怎么办？那么有两种办法，一种办法我们可以在 Map在这儿实现查询的时候，写一个关联查询，关联到user表，然后把user表里的数据也查到，查到以后，但是这个结果就需要做一个特殊的处理，这个叫关联查询。

那么 my business是支持的，就是说你可以做相关的处理，这是一种方式。

然后另外还有一种方式，我们也可以在这里我先查出了这个帖子的数据，那里里边不是有个ID吗？我根据ID再调user service，把 User查到我通过model再把 user发送给这个模板，那模板得到了，帖子也得到了，user也是ok的。

当然了，那么这两种方式前者我们通过关联查询肯定是效率更高一点，因为一一下我就查到了两张表的数据，但是这样做的坏处或者说有缺点就是说我这个查询方法可能就会怎么说有一些冗余或者有一些偶合，因为可能有的业务当中我并不需要展现用户的这些信息可能不需要有的需要，所以说你可能你要么要提供两个方法，如果是你只提供一个方法的话，它就有一些数据的冗余。

第二种方式没有冗余，比较明确，但是他需要查两次效率稍微低一点，我课上我还会采用第二种方式，因为这样比较简单比较方便，其一其二效率问题我们怎么解决，后面我们会讲radius，我们可以把这种有效率的地方，有效有有效率影响的数据，将来缓存到rides里，我这一步查询就直接通过readiness，通过内存取到了这个值，效率也是非常的高的，几乎就没有什么影响的。

所以说这样的话我们就既能够让代码变得简洁，然后的话又不会溶于一些数据，然后又能解决性能的问题，这是我们通常的一个做法。

所以说我这里现在我先单独的查询一下 user，当然对于说有同学想知道我怎么去做关联查询，这个你可以去买卖这次的手册里去看一看它有好几种办法，你都可以了解一下，好了回到 CTRL了，下一步我要查这个帖子的，其实就是作者这样写错了，作者那也很简单，就通过user service来查，我看这里我还没有注入user service，这里我需要注入一下，好，已经注入进来了，回到刚才的位置，那就user servis的fanned by Dee，然后你把帖子的里边的优质ID传给他，我们就能得到帖子的作者了，然后把作者传给这个模板就可以了。

好，这两份数据就是我们模板上需要的，这两个数据我就已经准备好了。

当然其实从完整的功能角度来说，其实你并并没有完全写完，因为什么？我们帖子的详情页面，我相信你也看过静态页面，它上面不只是有帖子的什么标题正文，它下面还有帖子的回复，对吧？

但我们现在还没有做这个回复的功能，所以这里我们先不去查询这个帖子的回复相关的内容，那么等将来我们把这个帖子回复开发完以后，这个地方还需要做一些补充好，到这我就可以返回模板的路径，我就是return return模板放到了site，目录下它的名字叫discus gun detail点extent，mail， Discourse， detail，好，这样就可以了。

那么这一步完成以后，剩下最后一步就是去处理那个模板，刚才我PPT上也说了，我们p我们那个模板要处理两个地方，一个是首页上的列表，每一个帖子的标题上面要加一个链接，能链到链接能够访问到这个方法，其实我们再去处理详情页面里边的数据的展现，所以接下来我首先在这打开首页，然后我们找到这个帖子的列表就在这了，119行，然后帖子列表里边，我要找到的是帖子的标题，这个就是帖子标题开通对吧？

这是一个超链接，原先我给它写成了井号，现在我需要把它改成一个能够访问到帖子详情页面的路径，涉及到路径，我们通常都是这样去写th hef里边我可能要带一些变量，或者说我要用到 timeless的特殊语法帮我便捷的处理路径，我们通常都是这样写，括号这样写的好处之前我们也讲了，它能够帮我们补充上自动带上项目的访问路径，所以我们那一级就省略了，无论你将来是否改项目名，这个地方都不用动。

好，然后这个路径我们是这样的，是 discus，对吧？ Disk us post control的路径是它，然后详情页下级是detail，detail的下级是帖子的ID，这是一个变量，那么如果你在这个路这里头，你既要包含一段固定的值，又要配上一个变量，你不能直接这样写。怎么写之前我们也说了，你需要前后加竖线，竖线里边可以包含的是一个常量以及变量的组合。好，所以后面下一级我要拼一个变量，这个变量应该是帖子的ID，你看帖子的开头是这么取，他的ID跟这个格式不是一样的，对吧？ Map点post点ID好，这样就可以了。

我们一点这个链接就能链到详情页上去。那么最后一步就是去处理详情页里面的数据的展现，所以我打开详情页。好，这个页面是我们第一次去编辑，所以我们需要从头开始。首先我需要在前面先声明一下，这是一个time leave模板好。

其次我们要把这个项目中的这些静态资源的路径进行一个整理，这个地方我要加上艾特，同理这个也是好当然了，那么在尾部还有一些js，我们也需要做一个处理，这样我把回帖先折叠起来，因为目前我们还不会去关注这个地方，回帖我们还没有实现，尾部也不用把它折叠起来，然后 Gs文件我们需要做路径的处理。

好，那么路径处理完以后，那么hide也需要处理，因为hide是可以复用的，那么这里我就写 th有case index吗？好，hide，好，让 hide得以复用，最后我们就集中精力把帖子的信息把它展现出来。咱们一点一点来看，首先的话这个是帖子内容，里边是帖子详情，而这个详情分为三部分，这里注释都写得很清楚了。

标题一部分，作者一部分，正文一部分对吧？这三部分我们看哪些地方是需要动态的值去替换的，首先标题的部分，这个就是标题对吧？这里目前写死了需要替换，这是第一个地方。

所以我需要在space上写上th冒号，这里最好用utx因为用户在发帖的时候，这个标题当中可能会带有标签，我们用you text可以把这个标签正常的显示成标签的样子。如果你不用u text，因为它那个标签我们存的时候不是转译了，它就会显示转译的字符就不好看了。

好，然后这里标题刚才我 Ctrl这个对象叫post对吧？所以这里面你要写post点，标题开头 ok，后面这三个按钮我们先不管，先不用处理再往后看，然后是作者的这一部分，那么作者首先他有一个头像，这头像目前写死了，我们需要替换，这里我就写pH冒号，c好把它替换成咱们不是传过来作者变量名叫user对吧？对。就是user点 high的URL好，这就行了。

另外很显然这地方是作者的用户名，你也需要做一个替换。 Th，冒号，Utecht，等于user点，user name。然后作者的下面是有一个帖子的赞的数量和回帖的数量，这两个地方我们先不去管不去管，因为什么？我们现在这个点赞回帖还没有实现，等我们实现到这个功能的时候，这个地方我们再来再来处理，还有这地方还有一个发布于某时间，这里要显示的是帖子的发布时间，这里也是要处理，实际上它不可能有标签，所以说就text就可以了。

那么这个时间我们需要进行格式化，显示我们习惯的格式，那么要用到对此对吧？Format，然后 Format当中我们需要获取帖子的发布时间，就创建时间 post create time对吧？另外你要指定这个时间的格式，杠mm杠ddhhmmss好了，这个时间也处理完了，最后就剩正文了。那么正文比较简单，反正一个div里边显示一个大段的文字，那就th冒号又txt等于这是post点，内容框填。

好，关于帖子的信息我们在这就好处理完以后，接下来我们就统一做一个测试，那么我把这个服务启动一下，好启动完毕以后我打开浏览器，我先访问一下首页，翻一下首页，然后我随便找个帖子来看，比如说我看然后你把鼠标放上去的时候，你可以观察一下浏览器的左下角这个地方，能够看到它当前的路径是什么。

首先我们看这个路径的格式没有问题，那个数据应该也对，像 ID是234，你看这个是282281是变化的，应该就没有问题对吧？我就点一个点玄学帖点了以后，那么你看这个是帖子的标题没问题对吧？然后这部分用户的名字就是AAA用户发布于某个时间没问题，当然这俩数据是假的先不管，然后这是帖子的正文没有问题，这是用户的头像也没问题。

下面回帖是假的，我们暂时先不管，以后再处理，这是一个，我们再看另外一个，随便找一个，这个我上次课发了一个帖子瞎写的是吧？那也可以点进去看一下，你看它这个标题也是能正常显示成标签对吧？用户名CC没有问题，发布于某个时间没问题，内容做了敏感词过滤也没有问题。好了，那么这个帖子详情的功能我们就很容易就把它开发完了，那么这次课我们就写到这里，咱们下次课再见。