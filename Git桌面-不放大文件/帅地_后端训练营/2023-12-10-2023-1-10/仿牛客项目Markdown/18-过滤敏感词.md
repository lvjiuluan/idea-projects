18-过滤敏感词.mp4

从这次课开始，我们要学习第三章的内容，这一章的目的其实还是要加强对死人不得的实践。然后经过这一章的学习，我们会把游客社区的主要的核心的功能都开发完，并且我们在开发的过程当中会穿插着去学习过滤敏感词，事务管理，是不是LP等等这样的一些内容。

好，那么这次课我们第一节先来介绍一下如何过滤敏感词。那么过滤敏感词我想大家应该都知道，就是说我们在访问某一个网站的时候，我们在这个网站上发布一些内容的时候，那么这个网站它一定会对我们所发布的内容进行过滤。

那么如果他发现我的内容里包含一些色情暴力等等这些非法的词汇的时候，那么它会把这些词汇隐去，或者说它不显示这些词汇，或者是把词汇打码显示为星号，这种行为就叫过滤敏感词。

那么从技术角度来说，其实过滤敏感词很简单就是说对字符串进行过滤，那么你输入的内容不就是一个大字符串对吧？然后我要调用某些APA去判断这个字符串里它有没有敏感词？比如说我们可以使用 Jdk自带的方法， string里就有一个replace方法，可以直接把字符串中的一个词替换掉，非常简单。

但是网站在实际的运营过程当中敏感词会比较多，有几十个甚至几百个都有可能，然后你输入的字符串也可能会比较长，因为你发布的可能是一个文章，那么在这种情况下，你用刚才所说的那种replace方法去一遍一遍的去替换，性能就太差了。

所以说在实际的工作当中，我们其实不会用这样的比较原生的API，我们通常会采用前追溯这种数据结构，然后来自己实现一个敏感词过滤的算法。所以说我们这次课主要就是讲如何使用这个数据结构来自己实现一个过滤敏感词的算法，讲这样一件事。

然后下节课我们讲发布帖子的时候就能把这个内容用上，那么所谓的前缀数它有几个别名，那么它的英文名叫tree这样写的，这没写错就是这样的，然后它还可以叫做字典数或者叫查找数，那么它的特点就是查找效率是非常的高的，但是它是以空间换时间，它比较消耗内存，但不管怎么说，它通过一定的内存的消耗，能够大大的提高查找的效率还是很有价值很有用的。

然后它的应用的场景主要是这么几个方面，第一个是字符串检索，就像我们过滤敏感词找这个字符串里有没有敏感词。第二个是词频统计，比如说我想统计一篇文章当中哪个词出现的次数最多，它是热点词这样。第三个是这个字符串的排序，比如说你要对一个班级的所有的学生按照名字来排序，其实也可以用这种方式来排，或者你想对某些句子或者是某些文章等等排序也都可以。

好，这就是我们对前追溯的一个简单的介绍。那么这次课我们最终目的是要开发出一个能够适用的工具，这个工具我给它取名字叫敏感词，过滤器其实就是一个工具，然后那么主要是分为三大步，第一步我们得先定义前追述数据结构，第二步我们得根据敏感词，然后把这个数据结构初始化好，然后才能去用。

第三个我们编写出它过滤敏感词的这么一个方法，就是一套算法，大概是三步，那么在实际写代码之前，我想给大家再画个图，详细解释一下前追溯这个数据结构大概是怎么样的，它有什么特点。

然后再一个我们怎么就利用它能够过滤敏感词，它怎么效率就高了，我们去体会一下它的算法执行的过程。

你了解这个过程以后，你直观的了解以后，那么一会我在写代码的时候，你也知道我为什么这个地方出现这个对象，那个地方我是这样去处理，其实和我一会要讲的逻辑是匹配的。

好，下面我给大家画一个图来直观的讲解一下前追述它固定敏感词的算法的逻辑。

好，那么你要固定敏感词，我们得做一个假设，我这个项目当中敏感词有哪些，我得先定义好敏感词对吧？你得先有敏感词。

这里假设就随便写几个，咱们是推演，所以说不能写的太多，假设我的敏感词有ABC这是一个词，比如说bf这是一个词 Be好了，假设我的项目中一共有三个敏感词，当然我们推演就弄得简单一点，实际的工作当中你可以把它配成任意的词，中文的也可以，英文的也行，没有限制。

然后其次你有了敏感词假，我再假设一下，假设我们某一个用户他输入的内容是什么？我们根据这个内容去推演过滤的一个所以说我在写上就是说假设用户他输入的内容换一种形式，假设它输入的是这样的一个字符串， X w你忽略里边的空格，因为我加空格是为了让它稀疏一点，这样我们看起来比较舒服一点，我们可以把空格忽略掉。

好，假设用户输入的是这样的一组，这个字符串是这样的，我摆到这儿，好，那么要想就是利用这个算法去看一看这个字符串里有没有这个敏感词，我们首先需要构造出就利用敏感词构造出一棵树，这棵树就是前缀树。你稍等，我把这个字给它放大一点，有点小。

好，首先我要构造出一棵树，然后这个树我先说一下前缀树它有几个特点，满足这个特点的这个树其实就叫前缀树，它的第一个特点就是这个前缀数的根节点，它不包含任何字符，根节点是空的，然后除了根节点以外的每个节点只包含一个字符，这是它的第一个特点，每一个节点只包含一个字符，但根节点是空的，然后从根节点到某一个节点经过的路径上，每个路径不有一个字符吗？

每个节点都有一个字符吗？

你把这个字符连接起来，那么就是这个节点，当前这个节点的对应的字符串说白了就是把一个单词拆解到这个数里头去了，然后每个节点的所有子节点包含的字符串不同，如果相同的情况你要合并，但我这么说这个不直观，我画一下可能你就明白了。

那么我就根据当前的这三个敏感词来构造出树形结构，首先这个树它得有一个根，我先画一个方块儿代表根叫root， root里是不存任何和敏感词有关的数据的，就是空的。

好了，然后我们看一下这个敏感词，我们树的下一级第一层其实要摆放的是单词的第一个字母，第一个字母是ABB b重复了，我们只画一个b所以root下面就有什么？

有ab两个字符就完了，非常简单，好，我就画一下这是a能不能小一点，有个a然后还有一个b是根据这个词分析出来的，然后他们都是root的孩子，所以我画条这个线就表示这么个意思，把它弄的小一点，像一个线一样，好就这样了。

然后你再看下一层应该这个单词的第二个字母，第二个字母是bfe对吧？Bfe然后你要看 b b属于 a的一个子节点，对吧？

所以 b应该在a之下，就a下面有个b然后 b下面有个f这个b下面有个e就是b下面有个f和e好，我再画两个节点把它挂到b之下，一个是f一个是e总之你按照这个规律去构造任何的给你一种敏感词，你都可以去画出这样的树形结构，当然我这还没有画完，因为你第一个单词还有第三层，有个字符是c但是后两个单词就没有了，所以 b之下还得有个c好，整个根据敏感词我们画构造的前缀数大概是这样的一个结构，这个是c就是这样一个结构，然后还没完，刚才我们再回顾一下刚才我所说的前追述的一个规定，根节点，没有任何字符空的，除了根节点以外，每个节点只有一个字符，确实是这样，这个是e这是f我按顺序来，这是f这个是e好，然后第二点，从根节点开始，然后到某一个节点，比如说到c那么它会途经a和b对吧？

那么它途经的这些字符连起来，其实就是我们对应的这个单词ABC，就这样的。就是第二个特点。

第三个特点是每个节点的所有子节点包含的字符串不相同。你比如说 root项，它本来按理说应该是包含ABB，但是 b重合那就把它合二为一，保留一个就可以了，就这个意思。现在树构造完了，然后还有一个地方需要注意一下，需要处理一下。就是说比如说我从入的开始往下遍历的话，我遍历到这儿，我得到的单词是ab Ab是敏感词吗？其实不是，而ABC才是对吧？我往这边便利，我便利到BB这个字母是敏感词吗？不是，bf才是对吧？

他得到最末级的节点才能算作是一个敏感词，到变成到中部的时候不是，所以我们需要因为ABC我怎么去给它标记一下，哪个不是还要做个标记，不然的话可能你编辑到b你也不知道它是不是敏感词，怎么办？

还得做个标记，我再加一个符号加个叉，这是我画图打个叉，一会我们写代码的时候，我们可以用代码的方式，比如说加个布尔值，标记它是不是末级，或者说它是不是敏感词。

好，就总之我在他有可他构成敏感词的节点上打个叉，表示到这就是敏感词中间没有叉的就不是这样我们程序的在执行的过程中便于一些条件的检测好了，到这这个数就画完了，画完以后，那么我们现在就要利用这个数据结构去检测这个字符串里它到底有没有敏感词。稍等，我把这个空格再稍微大一点。

这样一会好画，你检测的话，我们检测的话其实需要需要的是三个指针，搞错了，需要三个指针，然后第一个指针指向的是这个数，然后它默认指向的是这个根节点，这里我标记一下一第一个指针，当然我们在程序中其实就是一个变量，然后第二个指针指向的是这个字符串，然后默认它指向的是这个字符串中的第一个字符。

然后第三个指针依然是指向这个字符串，默认依然是指向第一个字符，字符串第一个字符有人想你这个字符串为什么要用两个指针来指向？我举个例子，你比如说我要检我们人为能知道说你其实你的这个字符串里有bf对吧？有bf这一部分bf就是个敏感词，你去筛选或者过滤这个单词的时候，需要两个指针才能把它标记出来，因为它标记开头，它标记结尾f对不对？

你这样的话我把从指针到指针之间的字符串认为是一个敏感词，我就把它替换成比如行行不就完了，如果你用一个指针的话，只能指向一个敏感词的开头或结尾对吧？你不能同时指向开头和结尾就不行。

因此我们需要两个指针，这两个指针他们是怎么去协调的，这是我们一会要演示的这么一个过程。所以我们整个算法需要有三个指针，另外我们在筛选的过程中可能是有些字符它不是敏感词，我们就会把它保留下来对吧？

如果是敏感词我们把它替换成星号，把它打码，那么我们最终一定要有一个地方存一下这个结果，所以这样我底下再画一个方块，这里比如说我有一个变量专门用来存放这个结果，我们程序中可能会用一个使用标准，这里写上使用标准，然后 String builder它等于什么？你检测到这个检测到的结果就存放到死病标的里，它应该存放我们检测的结果。

好了，到这儿我就把要准备的事情都准备好了。

接下来我们就开始让算法的运转起来。那么整个运转的过程当中，其实主要是这两个指针从前往后走，那么其中第二个指针大致他是不回头的，他是一直从前往后走，它标记的是什么？就当前你检测到了第几个字符，第一个字符x是不是敏感词？不是，第二个是不是又以w开头的是不是敏感词，以a开头是不是敏感词，它是不断的往后走。

那么它在走的过程中，它标记的是敏感词的一个起始的位置，但比如它标记到 b的时候，指针三要配合他判断你 B我指向b从b开始到b结尾，就一个字符是不是敏感词？不是，我再往下走 bf是不是？是从这到这是敏感词。

所以说其实它标记的是开头，它标记的是结尾，然后一旦标记成功以后，可能我们下一个就会就把打微信以后就会往下再往下执行，再往下走，他就往下走，他也往下走。

然后如果说你发现不是他还回来再重新进入下一个环节再去匹配，大概是这么一个过程，就总之第二个指针是永远是不回头从前往后走。

但第三个指针它是要去结尾的，如果发现这个是不是我再回来再从另外一个下一个字母开始再回来，它有一个不断怎么说不断抖动的这么一个过程，但是小范围的不是大范围的，所以这是这两个指针的一个特点，我们大概先了解一下到底是不是敏感词，我们主要是看这个数。

我们从这个书里找，就是将当前指针指向的字符和这个数据比较整个过程是二走一遍，三在微小范围内可能稍微有点往复，那么总体来说基本上就是一大遍搞定，所以说效率还是比较高的，下面我给大家完整的演示一下这个过程。

首先2和3都指向第一个字符对吧？然后我们的算法要去看树形结构，问他说你的第一级有没有x字母，树形结构他去检查，你看我第一级没有x没有x它可以不动，没有就表示什么？以x开头的，这个单词不可能是敏感词，对吧？X是安全的，所以说你可以把 X就记录下来。既然x是安全的，你就可以往下接着走了，对吧？看下一个字母，对吧？这两个指针就往下移就可以了。

同理，那么再看说这个字符是w那么你这个树形结构里有没有下一级有没有w没有。说明w也是安全的，于是 W记不起来，没有问题。

好，然后再来，w没问题再往下走，走到了a它同时走到a从a开始检测，这个时候再去询问这个数说你这里有没有a很显然有，这个时候这个数的指针就动了，它就指向a找到了有个a那有个a但a是不是打个叉有没有标记？没有，对吧？说明a它不是到这儿为止不是敏感词，所以我们还需要接着往下去看，二就定在这不动了，他定在疑似敏感词的开头不动了，然后三往下接着走。

看b询问树形结构你下面有没有b A项刚好有b对吧？但b没有差，没有这个判断的条件，所以ab到这不是敏感词，但是他疑似因此怎么办？再往下再看再走一步，f再去询问这个数，你下面有没有f没有，那就说明什么？说明从a到这儿它不是敏感词。

所以说或者说以从这儿以a开头往下，这部分不是敏感词，这个时候我们就归位了，因为这一轮以a开头的字符检测完了没有问题，那就归位它回到原位。

然后的话 a没问题，我们往下走一步，看下一个字符，所以说他往后挪了一位，这个时候三指针也要指向b指向下一个字符，从b开始检测，那就重复刚才的过程。

那么先询问这个树有没有b有b指向b但b不是敏感词，疑似，我们再三再往下走看， B的下级是f b下有f吗？有。

而且 eph有标记，说明bf是敏感词，我们找到了一个敏感词，刚才我忘了一步就是a如果不是敏感词，我们得把它记录下来对吧？忘记录了。补充一下，然后这回我找到了从b到f这是一个敏感词怎么办？要替换成星，于是我会在这里记录成星星，比如我们打三个星把它替换了，替换完以后，首先我把这个数回到原位，然后我们接下来要检测的就是说跳过这个敏感词对吧？

因为它已经是敏感词了，跳过它跳过它以后那去哪呢？去指针三的下一个位置，同理二也去指针三的下一个位置。好，你感受到了吗？二是一直往前走，但三可能小范围会回调一下。是这样，好。

同样的道理，我们再去检测这回又是以a为开头的单词，有没有可能是敏感词，也会询问这个数下级有a疑似，但a不是，那三的时候我再往下走一步，再走一步是b下面我们的b有疑似，但不是这样往下走，看是不是下面是c那树说我下面有个c这个c而且是有标记的，就证明什么？

从这儿到这儿这个单词是敏感词要替换对吧？所以下面还得加星星。好了，既然这个单词是敏感词，我们就得跳过它，不记住它而记住了星对吧？所以指针再往下移一位二指针就直接移到这个位置就ok了。同理这个数还得回味。同理我们再去判断以字母开头的是不是敏感词，一看这里没有f不是对吧？不是就往下移，移到这一看还是f这里没有f不是那就移到头了就完了，当然你这两个f不是敏感词，你得把它记录下来。

最终的算法经过这么一轮这么一轮的执行以后，那么我们记录的结果是这样一个结果，就是exo wa然后其中的bf被替换了，ABC被替换了，其他的保留了，就变成这样一个词，这里边你这是我演示的是字母，你画的换成汉字，甚至其他国家的文字其实都是一样的道理，都是可以的。

然后我们整个算法的检测的目标是以字符为单位的，不是以字节为单位的，所以说你是一个字母也好，还是一个汉字也罢，没有关系都一样。

好，过滤敏感词大概的工作的流程我就给大家介绍完了，下面我给大家通过代码把这个过程给你实现出来。然后的话我们看一下用代码来实现是怎么样一种感觉，好。

那么我就打开我的 Idea，然后我们要开发的是一个能够复用的工具，因为我们不止在一个很多功能都要用，你发帖子也好，发评论也好，其实都要用到，那么我就要写一个工具，但我在写这个工具之前，我先把敏感词给它定义好，这个敏感词我们可以把它定义在数据库里，也可以把它定义到一个文件里，我们这个项目中我就把它定义到文件里，这样我在 resource之下新建一个用来存放敏感词的文件，叫三ctf敏感words，敏感词点txt，然后我在这里随便写几个词，我就不写的那么多了，写几个是那么个意思就可以了，比如说赌博是敏感词，嫖娼是敏感词，吸毒是假设就开票也是，完了我就写4个，反正他每1个词独占一行，你可以无限的写下去，那么这就是我们敏感词的来源，我们就要判断我们的一段文字里有没有这些词当中任意一个，如果有就要替换成星，这是我们这个算法的要求。

好了，接下来我就写一个工具，然后把刚才的算法给它实现了，那么这个工具我把它写到 YouTube包下，新建一个类，这个类我叫三CT built就敏感词过滤器，三c点q的 build，然后这个工具为了复印方便，我给它托管的容器由容器来管理，然后或者加一个component。因为其实在各个层次你都可以用，它不只是说是某一层专用的，是一个通用的这么工具。

然后刚才我PPT上也说了，我们要开发这个算法怎么办？大概是三步，第一步你得先把这个数据结构定义好，对吧？得把这个数据结构定义好。第二步你要把它初始化，这个数据初始化出来。其实就是刚才画的图，我们根据我们既有的敏感词的文件，把这个数初始化好在内存里，然后第三步就是做这个动作做这个过程。好咱们一步一步来实现。

首先我要把前缀数的结构定义好，这里我们可以写一个独立的类，或者我们也可以写一个内部类，因为这个结构只是在这个工具里用，其他的地方基本上不会用到比较特殊，所以我定一个内部类就不允许外界访问了private class，然后我们定义前缀是我们定义树形结构，其实主要是定义这个节点与节点的关系，所以说这个类型是 trie是前缀数的意思， Tree no就前缀数的节点，所以我当前定义的数据的结构其实是描述前缀数的某一个节点的，然后这个节点我们需要描述什么？需要描述它是不是敏感词，它有没有标记差对吧？这是一个要描述的方面。这里我写不出是吧？我们要描述的是关键词结束的标识。我给他一个布尔值，因为你要么是要么就否，然后布尔值我叫is key work。是不是一个等于默认等于放肆，你是不是一个敏感词，或者说你是不是一个单词的结尾，如果是单词的结尾就是敏感词，就这个意思。

好了，那么当然了外界要访问他，你得给他提供一个盖特赛的方法，我给他生成盖特赛的，除了这个以外，你还要描述什么？树形结构，你要描述某一个节点的孩子对吧？

描述某一个节点的孩子，因为任何节点他都有可能有孩子，但也有可能没有，我们要描述某一个阶段的孩子，这个好描述，就再加一个成员，这里我写个注释，就是我要描述的是子节点，当前节点的子节点，那么一个节点他的孩子可能是多个，所以我用一个map对它进行一个封装，map的key，我用这个character就是字符，你这个子节点对应的是哪个字符，然后的话value区no，就当前前缀数节点的类型，这样的话我就能够通过当前节点找到它，直接点对应的是哪个字符知道，直接点的数据结构。

也知道这个意思。

好属性我给它取名叫 sad not子节点默认的给它初始化，成为一个空的哈希。好了，这里我给它写个注释写完整一点，这个key就是我们 Map的key，它是下级的节点的字符，是下级字符，然后 y6是下级节点，这样便于我们去使用，一会我们用的时候你可能就有体会了。好了。

那么当然了你这个子节点默认是空的，你什么时候往里装数据呢？你什么时候获取它，你得给它提供往里装数据和获取它的办法对吧？所以我这再加两个方法，这就不是生成了，因为它不是简单的site，我需要提供一个添加子节点的方法，当然这个方法得是公有的对吧？Public然后爱的。

3note你添加一个子节点，这个t cat是一个字符，然后 Value是 tree，node就叫node，你要加到哪里去，加到 sup no这里去对吧？所以说也很简单，就是 some knows点put，然后 k是c value是no的，这就可以了，很方便，然后再来一个，那么你加完以后将来肯定是要获取要用的对吧？

所以再提供一个获取，使节点的办法也是有的。获取指点，通过key取外流，那么取到的是y的是去no的，那方法名我就要get300，no的，然后t character我就直接的return map点get key好，这就可以了，这就行了。就是说这个前缀数其实它的结构并不复杂，我们主要是做好标志，并且维护好上下级的关系就可以了。这个写个注释说这个是什么？前追溯我们所有的算法，基于这么一个简单的树形的结构。

好了，那么这一步完成以后，我们下一个环节就是我们要根据敏感词就是文件，然后来初始化前缀数中的数据，下面我把初始化的代码接着写一下。

好前置数我把它放到后面去了，我在前面写这个结果放到后面去，然后首先我在组件当中先实例化一个logo，因为我们在做处理过程中，如果说有的地方需要打日志，我好提前准备好 Private时代里边山东 lover sensitive filter their class。

好，另外我在定义一个常量，这个常量一会要用到，就是说当我们检测到这个字符串中有一个敏感词以后，我们需要把敏感词替换成什么样的符号？我把它做成一个常量，将来如果说好改的话，要改的话，我好在这个地方统一改，这个叫产量一般都大写， replace问题替换成什么？简单点三个星，完了就是写注释，这是我们要替换符号。

接下来因为我们要初始化这个数对吧？肯定得先从根开始初始化的初始化起对吧？所以我首先先把根节点初始化好，根据点比较简单，它是空的什么都没有，只要你有这个对象就可以，所以我先初始化一个根节点，吹no的名字叫root，no根节点的意思等于no，是no的。

好，就这样。

那么接下来我就要根据刚才的配置文件，就这个文件，根据它里面的数据去构造这个树形，那显然不是说一个属性能搞定的，我们得需要写一套逻辑，得有一个方法，这个方法显然应该是在程序启动的时候，或者说在你初次调这个工具的时候，它自动就把它初始化好比较好，它也不需要初始化多次，只要一次就可以了，所以说你只要首次访问它时初始化一次就可以了。

因此这样我在这个方法里写加一个他盈利我给类加一个初始化的方法，然后在盈利的方法之前加上 Post，construct不知道大家还记不记得注解，那么这个注解表示说这是一个初始化方法，那么当容器实例化这个病以后，在调用它的构造器之后，这个方法就会被自动的调用，那么这个并什么时候被初始化，在服务启动的时候就初始化了，所以在服务启动的时候，这个方法就被调用，这个树形结构就构造好了。

启动完以后用户去访问的时候，我们就可以拿它用来去对敏感词做筛选了，所以这个时机是比较合理的在这里写。

好，那么我们想初始化这个数，首先你得把这个文件里的字符给它读出来，对吧？你要读读的方式有很多，我可以用这样的方式叫diss点get class，任意对象点get class，loader，我要获取类加载器，那么类加载器它是从类路径下去加载资源，所谓的类路径指的就是这个克拉克类克拉斯目录之下，我们的程序一编译，所有的代码都会编译到classic之下，包括配置文件，所以我就从这里边去读这个配置文件。

好，get class loader，然后点get，它有一个方法get results as使用。那么只要你写上这个文件在 class下存放的路径就可以了，当然你看我编译一下 CTRL f9，编译完之后你看他说get classic下他还没有，他有的时候就是这样的，你简单的CTRL f9他没有因为他没有怎么说，它是一个txt，所以说有的时候它这个快件它不会默认编译这个东西，那么这种情况我可以把编译代码口令一下，然后我再重新编译一下，然后点微文插件重新的编译一下，然后再看这个to，get这回就有了。

好，所以这个小问题你要注意一下，我们直接CTRL f9它这种非class文件有的时候你新建的它不会变异，如果已经有了的没有问题好了，那么 get resource as stream就是 class下读那个文件，我们刚才也看到了，文件编以后就在classes之下，所以它没有附目录，你直接写文件名在这就可以了。

所以我写 sensitive words点儿txt，我们这句话所加载到的是一个字节流 input，string。好，这是一个资金流，当然了你资金流将来肯定是要关闭，所以什么时候关闭应该在find类当中关闭对吧？所以我最好给它加上try，catch我可以这样写 try。

那么我在try里边去开启或者是创建某一个对象，那么它会自动的编译时自动的给我加上finally，然后把它关闭掉，这样我就省点事，当然你出来完以后你还得 catch一下， catch我就catch，因为这是io操作，ioxip好，那么如果开头异常，我应该记个日志 log点l说加载敏感词文件失败，然后带上异常的信息就完了。

好，我们得到的是一个字节流，我们从字节当中去读文字不太方便，最好把它转成字符流也好转，你把一个字节流转成字符流，你可以拗一个input，席俊瑞德这是一个转化流对吧？

你把 input dream传进去，它会给你转成一个reader，然后我们直接使用 reader也不是很方便，最好我们用的是一个缓冲流，它读取数据来的话会效率比较高，所以我们再把这个字符流转化为缓冲流，再转一层你就可以8分的reader叫reader等于new8幅的reader，然后把刚才的字符流传给他，最终我们得到的是一个缓冲流，这样效率高一点。

当然我也把它写在try里，最终的话自动在find当中关掉。

在try的内部我就需要通过 reader去读取每一个敏感词。

读的也比较简单，首先首先定一个变量叫key word，每次读取到的词我都存到这个变量里，然后我就用在while循环中去读 while key word它等于 reader点read，因为刚才我们看了配置文件里是一行一个敏感词，你读一行读一行复制给key word，如果说它不等于闹，就表示我读到了，读到以后怎么办？

我应该把敏感词添加到前缀数对象中去，那这个逻辑就比较复杂一点，我需要我最好能把它封装为一个独立的方法去调用这里，我先这样，我先写第四点。At key word，我先把这个方法规定好，叫这个名字，然后我需要把 key word传给他，他把 key word帮我挂到树中去就可以了。

好，下面我就来写这个方法，把一个敏感词添加到前缀数对象当中去，写注释，将一个敏感词添加到前缀数当中去，那么这个方法是内部使用的，也不需要工友，private就可以，方法名刚才我规定的叫爱的key word，他的参数就是梯位，那么实际上实现的逻辑就是比如说我这个ABC，你要把它搞成这个样子，把它做成竖的上下级的这样一个关系就可以了。

当然我们目前有的节点只是一个 root节点对吧？那么我要根据这个单词去创建它的一个逐级创建，它的下级节点，那就创建。首先我先创建一个吹no的取名叫time，no，它是一个临时节点，然后相当于一个指针，默认的就指向根。

然后的话我们根据这个单词拆解每一个字符不断的指向下一个字符，那就不断的去构造树的下一级，就这个意思。好，我默认它指向根就是root，node默认它等于根，然后那么我们要往根下挂节点，得看这个单词里有什么对吧？你得遍历，你得遍历这个单词中的字符也好，遍历I等于0，I小于key word，但是佳佳。

好，那么每次遍历我们能得到很容易得到一个字符 k word点叉at，对吧？很容易得到一个字符，那么得到一个字符以后，我们就需要把这个字符挂到当前节点的下面，因为你默认是根变了的，第一个字符就挂到它下面，你再变一个字符就挂到a的下面，对吧？以此类推。

好，那么你把一个字符挂到一个节点的下面怎么办？其实我们就调刚才我们写的方法，就当前节点是temp node点get some node。我们试图去找一下它有没有子节点，因为可能是之前挂过同样的字符了，我们找一下有没有，如果有就不用新建，如果没有我们就需要新建一个节点，就这个意思，所以我试图去获取一个子节点，那么判断一下 Sup node它是不是空的，那么如果三不弄的是空的怎么办？你要初始化在这里，你要初始化子节点，如果不是空的你就直接用就可以了。

那么这里初始化子节点就是sub node等于new train node。另外你得把这个子节点挂到他的父亲之下，挂到当前节点之下，当前节点是谁？不就是temp node对吧？它相当于是一个指针， Temp node，点I的三个note，然后当前的字符是c对吧？然后当前的子节点是三个note把它挂好。

好，到这儿的话，我们要么找到了一个已存在的子节点，要么就新建了一个子节点，反正到这儿这个子节点已经有了，而且这个子节点对应的就是 c就这个字符当前这个字符，那么这个阶段处理好，我们再进入下一个循环，再进行下一层节点的处理对吧？你怎么处理你可以这样，我们让指针指向子节点，调整指针就可以了。

指向子节点，然后进入下一轮循环就可以了。我就可以写time，node就当前节点它等于子节点，下次循环的话不就进入下一层了，很容易。

好，最后你还得当某一个单词它循环完以后，它循环到最后一个字符以后，最后一个字符你要打个标记，所以这里你要设置结束的标识得判断一下，不是每次都设置，如果你的I走到了最后一个位置， Key word点last减一，你找到最后一个位置，这个时候你就要给它打一个标志，标志就是time。

Node，点，sat，keyword。And结束了。结束。表示这是一个敏感词。好，这就可以了，经过这套逻辑我们就把提味挂到了树里。好了，二这是第二步。我们根据敏感词去初始化这个前缀数也就这个图。好了，那么最后一步就是实现了检索的过程，主要是利用这么三个指针的这么一个对应关系去检索字符串里有没有敏感词，当然这一步是最关键的，我们接下来再把最后一步给它实现了。

方法就应该是公有的了，因为这个方法是被外界调用去解决它的问题的，对吧？它应该是个公有的方法。 Public这个方法我返回死菌，返回的是谁呢？就这个结果你记录的结果你传给他的是一个可能含有敏感词的字符串，它返回的是替换掉以后的字符串，所以返回的是死菌，然后方法名我叫filter过滤。

这个方法的参数是一个文本txt，这样我把注释写得详尽一点，因为毕竟它是为被外界所调用的过滤敏感词参数是待过滤，不对待过滤的文本返回来的是过滤后的文本，要写得清楚一点。

好，然后首先我们得怀疑一下这个参数你有没有值，你万一传个空值进来，我就没有必要去判断了，对吧？所以我就看空一下子俊you tells点儿意思 block参数，那么如果参数是空的，我就直接return now不管了。

好，那么如果参数不为空表示确实是一个字符串，这时候我就要去过滤了，我过滤的时候依赖三个指针对吧？我需要声明三个变量，指针一指向的是树指向树指向树的节点，这个比较特殊，我需要声明一个去弄，还叫time node，因为这个节点它会不断的向下移，它默认应该是指向根的。一开始它指向这个根的，然后我们随着检测它会指向下级，下级对吧？是这么一个过程。

所以默认指向根指针一，接下来指针二，指针二和指针三它指向的是字符串的首位第零个位置对吧？指针二我取名叫应该是个整数，它是一个索引， Begin when是0。好，再来一个指针三也是一个整数，索引我叫production，等于也是0。还有我们还要有一个变量记录最终的结果，对吧？这个变量因为它要不断的追加这个字符，所以你最好用变成字符串，你不要用死菌效率低，我们通常把这个叫这结果就注释，通常我们都用使用build把它初始化好，使用build可以了，下面我就要开始去运行这个算法了。

这个算法整个的过程，你去检测这个字符串从头到尾的检测，我们可以以指针二为目标，从0到尾，其实也可以以指针三为目标，从0到尾，而且指针三它会优先到位，比如说你检测到比如说指针二检测到这个位置的时候，发现比如说检查这个位置，假设这个是a他疑似敏感词可能指令三就再往下移一步，可能会出现这种情况，所以指令三会先结束。

所以我们利用指针三去做循环的话，可能是它会效率会更高一点，否则用质量二的话可能会多循环几次。

好，我这样写我们要做一个遍历，就是当production指针三小于test点nice的时候，那么指针三没到结尾的时候，就意味着只要它在中途，我们就需要继续遍历，直到它到结尾，我们就停止遍历，就这个意思对吧？

因为它比指针二有可能优先到达结尾，所以利用它去作为一个判断的终止条件，效率更高一点，好。

所以就这样写了，写完以后每次遍历我们肯定是能得到这里面的一一个字符还是叉c等于text点叉at，我们通过这个project就能得到当前的某一个字符，它不就指向某一个字符就得到这个字符对吧？

得到这个字符以后就要对这个字符做判断，当然我们可以先不着急判断它是不是敏感词，或者说是不是疑似敏感词，我们先做另外一件事，刚才我画图是没说，这里要补充一下，什么事我们要跳过符号，什么叫符号？

就是说现在上网的人也多了，他也变得越来越聪明了，他也知道这个网站会对敏感词做过滤，所以他为了规避过滤的机制，他可能不去直接发什么开票这样的词，比如你直接发开票很容易就被识别，这是敏感词，他可能会这样在这个字当中穿插一些特殊的符号，我觉得打出特殊的符号，表情符号再加个五角星就加一个得了，你看我在开票中间穿插着加上五角星，那么如果你写的算法不严谨的话，你可能会连续因为连续的开票俩字是敏感词，但中间隔了一个符号，你可能不认为它是敏感词，可能会绕开一些不严谨的算法。

所以这种情况我们也要考虑怎么考虑。这个还得再多说两句，我再简单的再画个图，那么针对刚才的情况，像这种情况你像开票，如果说我们要去构造就开票这俩字，我们要去构造授信结构的话会是什么样？

我简单化，大概是这样，开票是我们的敏感词，我把它竖起来，就表示一个树形结构，默认的话指针是指向根结点指向这俩字之上，对不对？

好，然后我们实际用户输入的这个词是这样的，中间带符号的，它是这样，比如说我们用这样的敏感词，这样的树形结构去判断这里边是不是包含敏感词，要规避特殊符号的情况，那得怎么规避？

但是首先你注意，比如说我二指向正，三也指向正，就有一种情况我们指向了这个特殊符号，并且同时这个树形结构它刚好是指向的是根，这个时候怎么处理，其实我们就把它略过就行了。对吧？因为我们当前树形结构指向的是根，就是说它不在疑似的怀疑的范围之内，我们把它略过就可以了，保留它就可以了。不用去把它删掉怎么着，就留着它进入下一个环节，到这个字就可以了。

好，然后你到开的时候，你一检测说这个顺序会宽的，我这里有个开疑似敏感词，因为它不是结尾，这个时候我们只能再往下移，它移到了星这个位置对吧？移到星这个位置这时候怎么办？这时候因为开是疑似敏感词，你星过掉再看下一个，忽略它过掉再看下一个，但二保持不动，因为它可能出现在敏感词之中，我们是再往下走，三往下走它不动，这时候你看这个票有没有票？

有发现敏感词，所以说特殊符号在一开头的情况这边处于根的位置是一种处理方式，就它俩都往前走，否则它处于它在中间的情况，然后它不载入的这个位置，那么只有三往下走，大概是这个意思。

好了，我们再回到这个程序里，我们所谓的跳过符号就是跳过五角星这样的符号，避免它干扰我们正确的判断。

当然你要跳过符号的话，我们最好把跳过符号的逻辑稍微给它封装一下，我得再单独写一个小方法，我在底下加一个判断是否为符号，私有的就可以，就这个类自己用，然后账号名叫is symbol。条件或者说参数就是一个字符，就判断这个字符是不是符号。好，我就直接这样写了，就很简单。

我利用叉YouTube工具点is ask，然后阿尔法number c这个方法是判断这个字符是不是合法的字符，是不是普通的字符，如果你ABC123普通字符它返回数，如果你是特殊字符符号它就返回false，所以我加一个取个反，如果它是特殊符号，返回符号取个反就变成数就是特殊符号这样另外的话还要再写再写一句话，我写完再解释就 C还得小于0x2180或者 c还要大于0x 9fsf好，这两个数是什么？其实0x2180到就是02180到9fff这个范围其实是东亚的文字范围，东亚的文字东亚文字范围，我们是不认为它是符号的，你你这个c在东亚的文字范围之外，我们才认为它是特殊符号，因为东亚的文字其实也是正常的文字，只不过它和西方的文字就是区别比较大而已。

这里我写个注释从这儿到这儿是东亚文字范围，包括中文、日文、韩文，可能在西方人眼里文字也挺特殊的，其实但不是特殊符号是正常的，所以你得在文字范围之外才有可能是特殊符号，大概是这个意思。

好，我们再回到刚才的逻辑当中去，我说了这里我第一步要跳过那个符号，我判断一下首先你是不是特殊符号，如果是的话，我还得看一下我这个时候我那个数，我指针是指向了是根还是不是根，因为它否则的处理方式不一样，对吧？那么弱指针一处于根节点，这个时候刚才的这种情况，这种情况糟了，重画一个把擦了就这种情况。

它此时它是处于根的，这种情况指针三也是要指向这儿，这时候我们不就说了，把它略过就可以了，对吧？若指针一处于根节点，那么我们就将此符号计入结果，这个符号我留着我不把它过滤掉，因为它不是特殊符号，然后让指针二向下走一步，因为它过去了，指针二向下走一步，但指针它也会走。

好，我就这里我得判断一下，因为是指针一组为根节点，那就得它得等于root，no，这个时候就是它处于根节点，这个时候我要把它计入结果使用，点判断c另外的话只能二往下走，就是begin佳佳就可以了，而指针三我在外面加，为什么在外面加？

因为刚才我们也推演了，如果是另外一种情况，就是指针二在这儿，指针三在这儿，发现了特殊符号，这个时候指针二不动，指针三往下走，你会发现指针二有的时候走有时候不走，但指针三一定会走，对吧？指针二什么时候不走？

什么时候走这个时候其他时候他不走，然后只能这样无论如何都要走，所以他在外面写这个逻辑有点绕，你自己课后自己画一画，自己推一下，把这个情况都考虑到就好了。好，那么这里写上注释，无论符号在开头或中间，那么指针三都向下走一步。

好了，这个逻辑就处理完了，处理完以后，因为我们这一步是跳过符号，跳过符号以后后续的业务就不用执行了，到此为止，所以我这里写一个continue进入下一轮循环，这个符号就处理完了。

好，那么符号处理完以后，我们这回那就如果走到这能就说明了这个字符不是符号，你就要对它进行检测了。

好，检测就是检测检查下级节点，因为我们默认处于根节点，我们第一个检测就是根的下级，然后在下级的下级对吧？所以检查下级节点，你要检查下级节点，你得取下级节点对吧？Time no的点，get356的c取到下级节点，然后再把它付给time node，当前节点就变成了下级节点，我们就检测它了。检测它有几种情况，一种是他们弄的等于no，什么意思，就下级没有节点，我下级没有节点。

刚才的在此之前的他们弄的，我们没有看到他是敏感词，然后他又没有下级，那就证明当前这种情况不存在敏感词，对吧？当年是什么情况？就是以begin为开头的字符字符串不是敏感词，以begin开头的字符串不是敏感词，这个时候我就可以把 Begin所指向的字符看一下图，就可以把begin指向的字符记录下来。

好，我就记录了使用build判的，然后 text点叉，艾特北根，把北根的位置记录下来对吧？怎么记录下来，然后就进入下一个位置，进入下一个位置你就得给你得加，对吧？Begin处理完了，他下一个位置是不是还不知道？加一下，然后这个时候position得和begin保持一致对吧？Position等于 begin。我一句话就把它搞定了，当然这两句话也可以对吧？好，然后再把树形结构的指针归位，指针山重新指向根节点，我们再进入下一轮的判断，我们就谈奋斗的，就等于如果听到了好，这是一种情况，然后再来还有一种情况也有可能是这样的，就是temper no的。

第二意思 p word and这个是最好教这个方法 Is key word and比方说我当前取到的下级的点，它已经是有标志了，就说明我找到了一个敏感词。我发现了敏感词，这个敏感词是比更开头或者是结尾对吧？所以我需要将 begin到production这一段的字符串，这一段的字符串替换掉。

好替换掉我往死忠哥这里存的是常量，对吧？Replacement就三个星就完了。然后与此同时我需要让这个值进入下一个位置，这回不是北给你进入下一个位置，因为从 begin到production是敏感词，应该是让production进入下一个位置对吧？所以你应该是加production，那begin得和它重合，此时所以说begin等于加proceed。

好，然后此时在重新指向根节点，跟这句话是一样的。

好，这是一种情况，还有一种情况，否则否则就是什么？我指针比如说指针二指向它，指针三指向它，然后指向的是b我在检测的途中没有发现没有检测完，也没有发现这个符号，我需要继续往下执行继续检查，那就只能再往下移动一下就可以了，别的都不用动。

所以那就是检查下一个字符，继续检查下一个字符就行了。

好，那么经过这个循环以后，我们基本上能走一轮，但不是严格走一轮，这块要注意，不是严格走一轮，因为有这种情况，指针二指向他，然后发现疑似，然后指针三往下走一步，指针三就到头了，发现不是，这个时候指针二和指针三两，这两个字母需要把它记不起来，它不是敏感词，有这种情况出现，所以这个时候你循环结束了，我们在循环内部还没有把它记录起来，对吧？

我们没有考虑这种情况怎么办？你在循环之外补一句话，我们就将最后一批字符计入结果，三提前到终点，二没到终点的时候，这个时候你像那几个字母又不是敏感词的时候，把它单独记一下，那就时间标点点儿判的txt。第二，杀不死菌，这不是一个我从begin截取到最后记不起来。好，最终把使用标准透视卷进入结果返回就可以了。

好了，那么反正就根据刚才我们所推演的流程，我们用代码把它给实现了，实现完以后这个程序能不能正常运行，我们得进行一个仔细的测试。

所以下面我就在测试的包下新建一个测试类，新的测试类我叫 sensitive tests，那么它里面的注解我copy随便找一个类copy，好，然后我想测的是 Filter对吧？

所以我把 filter把它注入进来，三c还有filter注入进来，这样以后我写一个测试方法测一下，方法名我就叫test sensitivity。

好，首先我得写一个带有敏感词的字符串，咱们看一下，看看能不能把它过滤好，先写个字符串，这个里我就瞎编了，我就瞎写了，说这里面可以赌博，可以嫖娼，可以吸毒，可以开票，说白了我就把那几个敏感词都写到这句话里了，然后完了接下来我就用这个工具去过滤它三c to filter点，filter把text存入它会返回过滤后的文本，我们把这个文本打印看一下，看它对不对？这个逻辑很简单了，那就执行。

看一下执行结果。对了，你看4个敏感词都被换成了星，但这是1种情况，这种情况的话帖子的人还比较初级的，它里面还不知道放特殊符号。

我再来一个，我把这句话里边放上特殊符号，还是星我还得点这块，但是你不放五角星，你放什么都行。好，我用这个芯把它分割开来，看你这回这个算法能行不？当然这一类好了，我们再对它过滤一下，然后再打印一下，看一下能不能执行，看结果这也可以。

你会发现敏感词的开头和结尾的符号被保留了，但它中间的符号被pass掉了，那么我们认为这赌博就是一个敏感词，就把它变成一个行星，这是ok的合理的好了，那么这样的话我们就把过滤敏感词的组件就开发完了，那么下次课我们去开发发布帖子的功能的时候，这个就可以用得上了。

好，那么我想这个代码其实并没有那么难，并不没有那么复杂，其实主要的是你要能够明白算法它背后的一些逻辑，这个逻辑有了以后，那么这个代码就比较容易能够写得出来，因为有这个逻辑去指导，所以大家课后我觉得你我建议你不只是写代码，你也自己画一画，自己把它推演明白，然后的话再去写就会轻松很多了。好，这次课我们就演示到这里，我们下次课再见。