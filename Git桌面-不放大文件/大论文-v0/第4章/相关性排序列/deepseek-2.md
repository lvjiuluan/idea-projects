### 计算跨方特征相关性

在纵向联邦学习框架中，为有效利用对齐样本的特征信息，需量化跨参与方特征间的统计关联性。本节提出基于隐私保护的Spearman秩相关分析方法，构建跨方特征相关性排序体系。设协调方C作为可信第三方生成同态加密密钥对$\{\text{pk}, \text{sk}\}$，并向Party A、Party B分发公钥pk。具体计算流程如下：

**定义1（特征列秩向量）**：令$\mathcal{F}^A = \{f^A_1,...,f^A_{m_A}\}$表示Party A对其部分的特征空间，$m_A$表示A方的特征维数，其中$f^A_p \in \mathbb{R}^{n_{al}}$为第$p$个特征在对齐样本集$\mathcal{D}^A_{al}$上的观测向量（$p=1,...,m_A$）。同理，Party B对齐部分的特征空间为$\mathcal{F}^B = \{f^B_1,...,f^B_{m_B}\}$，$m_B$表示B方的特征维数，$f^B_q \in \mathbb{R}^{n_{al}}$（$q=1,...,m_B$）。对任意特征列$f^A_p$，计算其秩向量$R^A_p = [r^A_{p1},...,r^A_{pn_{al}}]$，其中$r^A_{pi}(i = 1, \ldots ,{n_{al}})$，为第$i$个特征值在$f^A_p$上的秩次（采用平均秩处理同值情况）。

**步骤1（加密秩传输）**：Party A使用公钥pk对秩向量进行同态加密，生成$[R^A_p] = \{\text{Enc}(r^A_{p1}),...,\text{Enc}(r^A_{pn_{al}})\}$并发送至Party B。类似地，Party B生成加密秩向量$[R^B_q]$。

**步骤2（秩差计算）**：对于特征对$(f^A_p, f^B_q)$，Party B计算加密秩差向量：
$$
[D_{pq}] = \left[ \text{Enc}(r^A_{p1} - r^B_{q1}),...,\text{Enc}(r^A_{pn_{al}} - r^B_{qn_{al}}) \right]
$$

**步骤3（Spearman相关性计算）**：协调方C解密$[D_{pq}]$得到$d_{pq}^i = r^A_{pi} - r^B_{qi}$，计算特征对间的Spearman相关系数：
$$
\rho_{pq} = 1 - \frac{6\sum_{i=1}^{n_{al}} (d_{pq}^i)^2}{n_{al}(n_{al}^2 - 1)}
$$
其中$n_{al}$为对齐样本量。由此构建跨方相关性矩阵$\mathbf{M} \in \mathbb{R}^{m_A \times m_B}$，元素$\mathbf{M}(p,q) = \rho_{pq}$。$\rho_{pq}$表示A方第$p$个特征列与B方第$q$个特征列之间的Spearman相关系数。

**定义2（特征关联强度）**：对Party B的每个特征$f^B_q$，计算其与Party A特征集的平均关联强度：
$$
\mu_q = \frac{1}{m_A} \sum_{p=1}^{m_A} \rho_{pq}, \quad q=1,...,m_B
$$
$\mu_q$表示B方$f^B_q$的跨方关联强度  ，该指标量化了$f^B_q$对A方特征空间的综合依赖程度。

**步骤4（生成排序列表）**：构建特征重要性序列$\mathcal{L}_B = \{(\mu_q, f^B_q)\}_{q=1}^{m_B}$，按$\mu_q$降序排列得到$\mathcal{L}_B^{sorted}$，$\mathcal{L}_B^{sorted}$表示按相关性强度排序的特征列表  。此列表将指导后续的非对齐样本特征生成，优先使用联邦半半监督方法补充与对方特征关联性强的维度。  该方法通过加密秩运算保护原始特征分布，利用统计相关性识别跨方特征依赖模式，为异构数据补全提供量化依据。排序机制可有效筛选出对方特征信息增益最大的维度进行优先生成，提升联邦学习效率。